import{c as $i,r as Li,g as Fy,a as ie,b as Dy,w as vl,d as yl,f as ic,t as sa,e as $y,h as Ly,I as gi,A as jy,U as My,i as X,j as zy,k as Jo,l as qy,_ as Uy,P as ky,V as vh,m as Hy,D as Ky,C as Vy,Z as yh,$ as By,n as Gy,o as ea,q as Wy,p as ml,s as Nr,y as Jy,u as Yy,X as ns,v as Dt,x as er,z as di,B as or,E as Zy,F as as,G as _l,H as Xy,J as Qy,K as e1,L as wl,M as t1,N as bl,Y as El,O as cs,Q as Yo,R as Zn,S as us,T as r1,W as Xn,a0 as i1,a1 as s1,a2 as n1,a3 as a1,a4 as o1,a5 as Fo,a6 as mh,a7 as c1,a8 as u1,a9 as h1,aa as _h,ab as l1,ac as f1,ad as p1,ae as d1,af as g1,ag as v1,ah as y1,ai as Qn,aj as xl,ak as Do,al as m1,am as _1}from"./index-ccf0d2f7.js";import{e as kr,s as sc,i as wh,c as w1,a as b1,b as Il,f as nc,p as E1,J as yi,d as ac,g as oc,h as cc,E as uc,j as pi,k as ti,l as hc,m as Sl,H as ji}from"./http-c9453ba0.js";var na={},Us={};Object.defineProperty(Us,"__esModule",{value:!0});function x1(h){if(typeof h!="string")throw new Error(`Cannot safe json parse value of type ${typeof h}`);try{return JSON.parse(h)}catch{return h}}Us.safeJsonParse=x1;function I1(h){return typeof h=="string"?h:JSON.stringify(h,(i,r)=>typeof r>"u"?null:r)}Us.safeJsonStringify=I1;var Ts={exports:{}},bh;function S1(){return bh||(bh=1,function(){let h;function i(){}h=i,h.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},h.prototype.setItem=function(r,n){this[r]=String(n)},h.prototype.removeItem=function(r){delete this[r]},h.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},h.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},h.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof $i<"u"&&$i.localStorage?Ts.exports=$i.localStorage:typeof window<"u"&&window.localStorage?Ts.exports=window.localStorage:Ts.exports=new i}()),Ts.exports}var $o={},Rs={},Eh;function P1(){if(Eh)return Rs;Eh=1,Object.defineProperty(Rs,"__esModule",{value:!0}),Rs.IKeyValueStorage=void 0;class h{}return Rs.IKeyValueStorage=h,Rs}var Ns={},xh;function C1(){if(xh)return Ns;xh=1,Object.defineProperty(Ns,"__esModule",{value:!0}),Ns.parseEntry=void 0;const h=Us;function i(r){var n;return[r[0],h.safeJsonParse((n=r[1])!==null&&n!==void 0?n:"")]}return Ns.parseEntry=i,Ns}var Ih;function A1(){return Ih||(Ih=1,function(h){Object.defineProperty(h,"__esModule",{value:!0});const i=Li;i.__exportStar(P1(),h),i.__exportStar(C1(),h)}($o)),$o}Object.defineProperty(na,"__esModule",{value:!0});na.KeyValueStorage=void 0;const os=Li,Sh=Us,O1=os.__importDefault(S1()),T1=A1();class Pl{constructor(){this.localStorage=O1.default}getKeys(){return os.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return os.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(T1.parseEntry)})}getItem(i){return os.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(i);if(r!==null)return Sh.safeJsonParse(r)})}setItem(i,r){return os.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(i,Sh.safeJsonStringify(r))})}removeItem(i){return os.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(i)})}}na.KeyValueStorage=Pl;var R1=na.default=Pl,hs={},Fs={},Lo={},Ds={};class Mi{}const N1=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Mi},Symbol.toStringTag,{value:"Module"})),F1=Fy(N1);var Ph;function D1(){if(Ph)return Ds;Ph=1,Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.IHeartBeat=void 0;const h=F1;class i extends h.IEvents{constructor(n){super()}}return Ds.IHeartBeat=i,Ds}var Ch;function Cl(){return Ch||(Ch=1,function(h){Object.defineProperty(h,"__esModule",{value:!0}),Li.__exportStar(D1(),h)}(Lo)),Lo}var jo={},Fi={},Ah;function $1(){if(Ah)return Fi;Ah=1,Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.HEARTBEAT_EVENTS=Fi.HEARTBEAT_INTERVAL=void 0;const h=ie;return Fi.HEARTBEAT_INTERVAL=h.FIVE_SECONDS,Fi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Fi}var Oh;function Al(){return Oh||(Oh=1,function(h){Object.defineProperty(h,"__esModule",{value:!0}),Li.__exportStar($1(),h)}(jo)),jo}var Th;function L1(){if(Th)return Fs;Th=1,Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.HeartBeat=void 0;const h=Li,i=kr,r=ie,n=Cl(),a=Al();class l extends n.IHeartBeat{constructor(y){super(y),this.events=new i.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(y==null?void 0:y.interval)||a.HEARTBEAT_INTERVAL}static init(y){return h.__awaiter(this,void 0,void 0,function*(){const _=new l(y);return yield _.init(),_})}init(){return h.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(y,_){this.events.on(y,_)}once(y,_){this.events.once(y,_)}off(y,_){this.events.off(y,_)}removeListener(y,_){this.events.removeListener(y,_)}initialize(){return h.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return Fs.HeartBeat=l,Fs}(function(h){Object.defineProperty(h,"__esModule",{value:!0});const i=Li;i.__exportStar(L1(),h),i.__exportStar(Cl(),h),i.__exportStar(Al(),h)})(hs);var Ae={},Mo,Rh;function j1(){if(Rh)return Mo;Rh=1;function h(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Mo=i;function i(r,n,a){var l=a&&a.stringify||h,g=1;if(typeof r=="object"&&r!==null){var y=n.length+g;if(y===1)return r;var _=new Array(y);_[0]=l(r);for(var S=1;S<y;S++)_[S]=l(n[S]);return _.join(" ")}if(typeof r!="string")return r;var $=n.length;if($===0)return r;for(var G="",W=1-g,V=-1,q=r&&r.length||0,K=0;K<q;){if(r.charCodeAt(K)===37&&K+1<q){switch(V=V>-1?V:0,r.charCodeAt(K+1)){case 100:case 102:if(W>=$||n[W]==null)break;V<K&&(G+=r.slice(V,K)),G+=Number(n[W]),V=K+2,K++;break;case 105:if(W>=$||n[W]==null)break;V<K&&(G+=r.slice(V,K)),G+=Math.floor(Number(n[W])),V=K+2,K++;break;case 79:case 111:case 106:if(W>=$||n[W]===void 0)break;V<K&&(G+=r.slice(V,K));var ae=typeof n[W];if(ae==="string"){G+="'"+n[W]+"'",V=K+2,K++;break}if(ae==="function"){G+=n[W].name||"<anonymous>",V=K+2,K++;break}G+=l(n[W]),V=K+2,K++;break;case 115:if(W>=$)break;V<K&&(G+=r.slice(V,K)),G+=String(n[W]),V=K+2,K++;break;case 37:V<K&&(G+=r.slice(V,K)),G+="%",V=K+2,K++,W--;break}++W}++K}return V===-1?r:(V<q&&(G+=r.slice(V)),G)}return Mo}var zo,Nh;function M1(){if(Nh)return zo;Nh=1;const h=j1();zo=a;const i=he().console||{},r={mapHttpRequest:q,mapHttpResponse:q,wrapRequestSerializer:K,wrapResponseSerializer:K,wrapErrorSerializer:K,req:q,res:q,err:W};function n(T,M){return Array.isArray(T)?T.filter(function(ge){return ge!=="!stdSerializers.err"}):T===!0?Object.keys(M):!1}function a(T){T=T||{},T.browser=T.browser||{};const M=T.browser.transmit;if(M&&typeof M.send!="function")throw Error("pino: transmit option must have a send function");const B=T.browser.write||i;T.browser.write&&(T.browser.asObject=!0);const ge=T.serializers||{},te=n(T.browser.serialize,ge);let Ee=T.browser.serialize;Array.isArray(T.browser.serialize)&&T.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Oe=["error","fatal","warn","info","debug","trace"];typeof B=="function"&&(B.error=B.fatal=B.warn=B.info=B.debug=B.trace=B),T.enabled===!1&&(T.level="silent");const et=T.level||"info",C=Object.create(B);C.log||(C.log=ae),Object.defineProperty(C,"levelVal",{get:ze}),Object.defineProperty(C,"level",{get:Te,set:J});const D={transmit:M,serialize:te,asObject:T.browser.asObject,levels:Oe,timestamp:V(T)};C.levels=a.levels,C.level=et,C.setMaxListeners=C.getMaxListeners=C.emit=C.addListener=C.on=C.prependListener=C.once=C.prependOnceListener=C.removeListener=C.removeAllListeners=C.listeners=C.listenerCount=C.eventNames=C.write=C.flush=ae,C.serializers=ge,C._serialize=te,C._stdErrSerialize=Ee,C.child=U,M&&(C._logEvent=G());function ze(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Te(){return this._level}function J(z){if(z!=="silent"&&!this.levels.values[z])throw Error("unknown level "+z);this._level=z,l(D,C,"error","log"),l(D,C,"fatal","error"),l(D,C,"warn","error"),l(D,C,"info","log"),l(D,C,"debug","log"),l(D,C,"trace","log")}function U(z,k){if(!z)throw new Error("missing bindings for child Pino");k=k||{},te&&z.serializers&&(k.serializers=z.serializers);const ct=k.serializers;if(te&&ct){var ke=Object.assign({},ge,ct),Fr=T.browser.serialize===!0?Object.keys(ke):te;delete z.serializers,_([z],Fr,ke,this._stdErrSerialize)}function _e(It){this._childLevel=(It._childLevel|0)+1,this.error=S(It,z,"error"),this.fatal=S(It,z,"fatal"),this.warn=S(It,z,"warn"),this.info=S(It,z,"info"),this.debug=S(It,z,"debug"),this.trace=S(It,z,"trace"),ke&&(this.serializers=ke,this._serialize=Fr),M&&(this._logEvent=G([].concat(It._logEvent.bindings,z)))}return _e.prototype=this,new _e(this)}return C}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=r,a.stdTimeFunctions=Object.assign({},{nullTime:be,epochTime:de,unixTime:pe,isoTime:ue});function l(T,M,B,ge){const te=Object.getPrototypeOf(M);M[B]=M.levelVal>M.levels.values[B]?ae:te[B]?te[B]:i[B]||i[ge]||ae,g(T,M,B)}function g(T,M,B){!T.transmit&&M[B]===ae||(M[B]=function(ge){return function(){const Ee=T.timestamp(),Oe=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var C=0;C<Oe.length;C++)Oe[C]=arguments[C];if(T.serialize&&!T.asObject&&_(Oe,this._serialize,this.serializers,this._stdErrSerialize),T.asObject?ge.call(et,y(this,B,Oe,Ee)):ge.apply(et,Oe),T.transmit){const D=T.transmit.level||M.level,ze=a.levels.values[D],Te=a.levels.values[B];if(Te<ze)return;$(this,{ts:Ee,methodLevel:B,methodValue:Te,transmitLevel:D,transmitValue:a.levels.values[T.transmit.level||M.level],send:T.transmit.send,val:M.levelVal},Oe)}}}(M[B]))}function y(T,M,B,ge){T._serialize&&_(B,T._serialize,T.serializers,T._stdErrSerialize);const te=B.slice();let Ee=te[0];const Oe={};ge&&(Oe.time=ge),Oe.level=a.levels.values[M];let et=(T._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof te[0]=="object";)Object.assign(Oe,te.shift());Ee=te.length?h(te.shift(),te):void 0}else typeof Ee=="string"&&(Ee=h(te.shift(),te));return Ee!==void 0&&(Oe.msg=Ee),Oe}function _(T,M,B,ge){for(const te in T)if(ge&&T[te]instanceof Error)T[te]=a.stdSerializers.err(T[te]);else if(typeof T[te]=="object"&&!Array.isArray(T[te]))for(const Ee in T[te])M&&M.indexOf(Ee)>-1&&Ee in B&&(T[te][Ee]=B[Ee](T[te][Ee]))}function S(T,M,B){return function(){const ge=new Array(1+arguments.length);ge[0]=M;for(var te=1;te<ge.length;te++)ge[te]=arguments[te-1];return T[B].apply(this,ge)}}function $(T,M,B){const ge=M.send,te=M.ts,Ee=M.methodLevel,Oe=M.methodValue,et=M.val,C=T._logEvent.bindings;_(B,T._serialize||Object.keys(T.serializers),T.serializers,T._stdErrSerialize===void 0?!0:T._stdErrSerialize),T._logEvent.ts=te,T._logEvent.messages=B.filter(function(D){return C.indexOf(D)===-1}),T._logEvent.level.label=Ee,T._logEvent.level.value=Oe,ge(Ee,T._logEvent,et),T._logEvent=G(C)}function G(T){return{ts:0,messages:[],bindings:T||[],level:{label:"",value:0}}}function W(T){const M={type:T.constructor.name,msg:T.message,stack:T.stack};for(const B in T)M[B]===void 0&&(M[B]=T[B]);return M}function V(T){return typeof T.timestamp=="function"?T.timestamp:T.timestamp===!1?be:de}function q(){return{}}function K(T){return T}function ae(){}function be(){return!1}function de(){return Date.now()}function pe(){return Math.round(Date.now()/1e3)}function ue(){return new Date(Date.now()).toISOString()}function he(){function T(M){return typeof M<"u"&&M}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return T(self)||T(window)||T(this)||{}}}return zo}var Di={},Fh;function Ol(){return Fh||(Fh=1,Object.defineProperty(Di,"__esModule",{value:!0}),Di.PINO_CUSTOM_CONTEXT_KEY=Di.PINO_LOGGER_DEFAULTS=void 0,Di.PINO_LOGGER_DEFAULTS={level:"info"},Di.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Di}var Qt={},Dh;function z1(){if(Dh)return Qt;Dh=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.generateChildLogger=Qt.formatChildLoggerContext=Qt.getLoggerContext=Qt.setBrowserLoggerContext=Qt.getBrowserLoggerContext=Qt.getDefaultLoggerOptions=void 0;const h=Ol();function i(y){return Object.assign(Object.assign({},y),{level:(y==null?void 0:y.level)||h.PINO_LOGGER_DEFAULTS.level})}Qt.getDefaultLoggerOptions=i;function r(y,_=h.PINO_CUSTOM_CONTEXT_KEY){return y[_]||""}Qt.getBrowserLoggerContext=r;function n(y,_,S=h.PINO_CUSTOM_CONTEXT_KEY){return y[S]=_,y}Qt.setBrowserLoggerContext=n;function a(y,_=h.PINO_CUSTOM_CONTEXT_KEY){let S="";return typeof y.bindings>"u"?S=r(y,_):S=y.bindings().context||"",S}Qt.getLoggerContext=a;function l(y,_,S=h.PINO_CUSTOM_CONTEXT_KEY){const $=a(y,S);return $.trim()?`${$}/${_}`:_}Qt.formatChildLoggerContext=l;function g(y,_,S=h.PINO_CUSTOM_CONTEXT_KEY){const $=l(y,_,S),G=y.child({context:$});return n(G,$,S)}return Qt.generateChildLogger=g,Qt}(function(h){Object.defineProperty(h,"__esModule",{value:!0}),h.pino=void 0;const i=Li,r=i.__importDefault(M1());Object.defineProperty(h,"pino",{enumerable:!0,get:function(){return r.default}}),i.__exportStar(Ol(),h),i.__exportStar(z1(),h)})(Ae);class q1 extends Mi{constructor(i){super(),this.opts=i,this.protocol="wc",this.version=2}}class U1 extends Mi{constructor(i,r){super(),this.core=i,this.logger=r,this.records=new Map}}class k1{constructor(i,r){this.logger=i,this.core=r}}let H1=class extends Mi{constructor(i,r){super(),this.relayer=i,this.logger=r}},K1=class extends Mi{constructor(i){super()}},V1=class{constructor(i,r,n,a){this.core=i,this.logger=r,this.name=n}};class B1 extends Mi{constructor(i,r){super(),this.relayer=i,this.logger=r}}let G1=class extends Mi{constructor(i,r){super(),this.core=i,this.logger=r}},W1=class{constructor(i,r){this.projectId=i,this.logger=r}},J1=class{constructor(i){this.opts=i,this.protocol="wc",this.version=2}},Y1=class{constructor(i){this.client=i}};var lc={},Tl={};(function(h){Object.defineProperty(h,"__esModule",{value:!0});var i=Dy,r=vl;h.DIGEST_LENGTH=64,h.BLOCK_SIZE=128;var n=function(){function y(){this.digestLength=h.DIGEST_LENGTH,this.blockSize=h.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return y.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},y.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},y.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},y.prototype.update=function(_,S){if(S===void 0&&(S=_.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var $=0;if(this._bytesHashed+=S,this._bufferLength>0){for(;this._bufferLength<h.BLOCK_SIZE&&S>0;)this._buffer[this._bufferLength++]=_[$++],S--;this._bufferLength===this.blockSize&&(l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(S>=this.blockSize&&($=l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,_,$,S),S%=this.blockSize);S>0;)this._buffer[this._bufferLength++]=_[$++],S--;return this},y.prototype.finish=function(_){if(!this._finished){var S=this._bytesHashed,$=this._bufferLength,G=S/536870912|0,W=S<<3,V=S%128<112?128:256;this._buffer[$]=128;for(var q=$+1;q<V-8;q++)this._buffer[q]=0;i.writeUint32BE(G,this._buffer,V-8),i.writeUint32BE(W,this._buffer,V-4),l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,V),this._finished=!0}for(var q=0;q<this.digestLength/8;q++)i.writeUint32BE(this._stateHi[q],_,q*8),i.writeUint32BE(this._stateLo[q],_,q*8+4);return this},y.prototype.digest=function(){var _=new Uint8Array(this.digestLength);return this.finish(_),_},y.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},y.prototype.restoreState=function(_){return this._stateHi.set(_.stateHi),this._stateLo.set(_.stateLo),this._bufferLength=_.bufferLength,_.buffer&&this._buffer.set(_.buffer),this._bytesHashed=_.bytesHashed,this._finished=!1,this},y.prototype.cleanSavedState=function(_){r.wipe(_.stateHi),r.wipe(_.stateLo),_.buffer&&r.wipe(_.buffer),_.bufferLength=0,_.bytesHashed=0},y}();h.SHA512=n;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function l(y,_,S,$,G,W,V){for(var q=S[0],K=S[1],ae=S[2],be=S[3],de=S[4],pe=S[5],ue=S[6],he=S[7],T=$[0],M=$[1],B=$[2],ge=$[3],te=$[4],Ee=$[5],Oe=$[6],et=$[7],C,D,ze,Te,J,U,z,k;V>=128;){for(var ct=0;ct<16;ct++){var ke=8*ct+W;y[ct]=i.readUint32BE(G,ke),_[ct]=i.readUint32BE(G,ke+4)}for(var ct=0;ct<80;ct++){var Fr=q,_e=K,It=ae,O=be,A=de,I=pe,c=ue,w=he,Q=T,oe=M,ye=B,Re=ge,Fe=te,Ie=Ee,St=Oe,mt=et;if(C=he,D=et,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=(de>>>14|te<<32-14)^(de>>>18|te<<32-18)^(te>>>41-32|de<<32-(41-32)),D=(te>>>14|de<<32-14)^(te>>>18|de<<32-18)^(de>>>41-32|te<<32-(41-32)),J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,C=de&pe^~de&ue,D=te&Ee^~te&Oe,J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,C=a[ct*2],D=a[ct*2+1],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,C=y[ct%16],D=_[ct%16],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,ze=z&65535|k<<16,Te=J&65535|U<<16,C=ze,D=Te,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=(q>>>28|T<<32-28)^(T>>>34-32|q<<32-(34-32))^(T>>>39-32|q<<32-(39-32)),D=(T>>>28|q<<32-28)^(q>>>34-32|T<<32-(34-32))^(q>>>39-32|T<<32-(39-32)),J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,C=q&K^q&ae^K&ae,D=T&M^T&B^M&B,J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,w=z&65535|k<<16,mt=J&65535|U<<16,C=O,D=Re,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=ze,D=Te,J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,O=z&65535|k<<16,Re=J&65535|U<<16,K=Fr,ae=_e,be=It,de=O,pe=A,ue=I,he=c,q=w,M=Q,B=oe,ge=ye,te=Re,Ee=Fe,Oe=Ie,et=St,T=mt,ct%16===15)for(var ke=0;ke<16;ke++)C=y[ke],D=_[ke],J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=y[(ke+9)%16],D=_[(ke+9)%16],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,ze=y[(ke+1)%16],Te=_[(ke+1)%16],C=(ze>>>1|Te<<32-1)^(ze>>>8|Te<<32-8)^ze>>>7,D=(Te>>>1|ze<<32-1)^(Te>>>8|ze<<32-8)^(Te>>>7|ze<<32-7),J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,ze=y[(ke+14)%16],Te=_[(ke+14)%16],C=(ze>>>19|Te<<32-19)^(Te>>>61-32|ze<<32-(61-32))^ze>>>6,D=(Te>>>19|ze<<32-19)^(ze>>>61-32|Te<<32-(61-32))^(Te>>>6|ze<<32-6),J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,y[ke]=z&65535|k<<16,_[ke]=J&65535|U<<16}C=q,D=T,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=S[0],D=$[0],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,S[0]=q=z&65535|k<<16,$[0]=T=J&65535|U<<16,C=K,D=M,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=S[1],D=$[1],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,S[1]=K=z&65535|k<<16,$[1]=M=J&65535|U<<16,C=ae,D=B,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=S[2],D=$[2],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,S[2]=ae=z&65535|k<<16,$[2]=B=J&65535|U<<16,C=be,D=ge,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=S[3],D=$[3],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,S[3]=be=z&65535|k<<16,$[3]=ge=J&65535|U<<16,C=de,D=te,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=S[4],D=$[4],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,S[4]=de=z&65535|k<<16,$[4]=te=J&65535|U<<16,C=pe,D=Ee,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=S[5],D=$[5],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,S[5]=pe=z&65535|k<<16,$[5]=Ee=J&65535|U<<16,C=ue,D=Oe,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=S[6],D=$[6],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,S[6]=ue=z&65535|k<<16,$[6]=Oe=J&65535|U<<16,C=he,D=et,J=D&65535,U=D>>>16,z=C&65535,k=C>>>16,C=S[7],D=$[7],J+=D&65535,U+=D>>>16,z+=C&65535,k+=C>>>16,U+=J>>>16,z+=U>>>16,k+=z>>>16,S[7]=he=z&65535|k<<16,$[7]=et=J&65535|U<<16,W+=128,V-=128}return W}function g(y){var _=new n;_.update(y);var S=_.digest();return _.clean(),S}h.hash=g})(Tl);(function(h){Object.defineProperty(h,"__esModule",{value:!0}),h.convertSecretKeyToX25519=h.convertPublicKeyToX25519=h.verify=h.sign=h.extractPublicKeyFromSecretKey=h.generateKeyPair=h.generateKeyPairFromSeed=h.SEED_LENGTH=h.SECRET_KEY_LENGTH=h.PUBLIC_KEY_LENGTH=h.SIGNATURE_LENGTH=void 0;const i=yl,r=Tl,n=vl;h.SIGNATURE_LENGTH=64,h.PUBLIC_KEY_LENGTH=32,h.SECRET_KEY_LENGTH=64,h.SEED_LENGTH=32;function a(O){const A=new Float64Array(16);if(O)for(let I=0;I<O.length;I++)A[I]=O[I];return A}const l=new Uint8Array(32);l[0]=9;const g=a(),y=a([1]),_=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),S=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),$=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),G=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),W=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function V(O,A){for(let I=0;I<16;I++)O[I]=A[I]|0}function q(O){let A=1;for(let I=0;I<16;I++){let c=O[I]+A+65535;A=Math.floor(c/65536),O[I]=c-A*65536}O[0]+=A-1+37*(A-1)}function K(O,A,I){const c=~(I-1);for(let w=0;w<16;w++){const Q=c&(O[w]^A[w]);O[w]^=Q,A[w]^=Q}}function ae(O,A){const I=a(),c=a();for(let w=0;w<16;w++)c[w]=A[w];q(c),q(c),q(c);for(let w=0;w<2;w++){I[0]=c[0]-65517;for(let oe=1;oe<15;oe++)I[oe]=c[oe]-65535-(I[oe-1]>>16&1),I[oe-1]&=65535;I[15]=c[15]-32767-(I[14]>>16&1);const Q=I[15]>>16&1;I[14]&=65535,K(c,I,1-Q)}for(let w=0;w<16;w++)O[2*w]=c[w]&255,O[2*w+1]=c[w]>>8}function be(O,A){let I=0;for(let c=0;c<32;c++)I|=O[c]^A[c];return(1&I-1>>>8)-1}function de(O,A){const I=new Uint8Array(32),c=new Uint8Array(32);return ae(I,O),ae(c,A),be(I,c)}function pe(O){const A=new Uint8Array(32);return ae(A,O),A[0]&1}function ue(O,A){for(let I=0;I<16;I++)O[I]=A[2*I]+(A[2*I+1]<<8);O[15]&=32767}function he(O,A,I){for(let c=0;c<16;c++)O[c]=A[c]+I[c]}function T(O,A,I){for(let c=0;c<16;c++)O[c]=A[c]-I[c]}function M(O,A,I){let c,w,Q=0,oe=0,ye=0,Re=0,Fe=0,Ie=0,St=0,mt=0,st=0,$e=0,Je=0,Ye=0,nt=0,qe=0,Ze=0,Ne=0,He=0,ut=0,je=0,Pt=0,$t=0,Ut=0,kt=0,Mt=0,Gt=0,tr=0,Dr=0,Wt=0,Hr=0,ri=0,_i=0,ht=I[0],tt=I[1],lt=I[2],ft=I[3],at=I[4],rt=I[5],Ct=I[6],At=I[7],pt=I[8],Ot=I[9],dt=I[10],_t=I[11],gt=I[12],We=I[13],Tt=I[14],Rt=I[15];c=A[0],Q+=c*ht,oe+=c*tt,ye+=c*lt,Re+=c*ft,Fe+=c*at,Ie+=c*rt,St+=c*Ct,mt+=c*At,st+=c*pt,$e+=c*Ot,Je+=c*dt,Ye+=c*_t,nt+=c*gt,qe+=c*We,Ze+=c*Tt,Ne+=c*Rt,c=A[1],oe+=c*ht,ye+=c*tt,Re+=c*lt,Fe+=c*ft,Ie+=c*at,St+=c*rt,mt+=c*Ct,st+=c*At,$e+=c*pt,Je+=c*Ot,Ye+=c*dt,nt+=c*_t,qe+=c*gt,Ze+=c*We,Ne+=c*Tt,He+=c*Rt,c=A[2],ye+=c*ht,Re+=c*tt,Fe+=c*lt,Ie+=c*ft,St+=c*at,mt+=c*rt,st+=c*Ct,$e+=c*At,Je+=c*pt,Ye+=c*Ot,nt+=c*dt,qe+=c*_t,Ze+=c*gt,Ne+=c*We,He+=c*Tt,ut+=c*Rt,c=A[3],Re+=c*ht,Fe+=c*tt,Ie+=c*lt,St+=c*ft,mt+=c*at,st+=c*rt,$e+=c*Ct,Je+=c*At,Ye+=c*pt,nt+=c*Ot,qe+=c*dt,Ze+=c*_t,Ne+=c*gt,He+=c*We,ut+=c*Tt,je+=c*Rt,c=A[4],Fe+=c*ht,Ie+=c*tt,St+=c*lt,mt+=c*ft,st+=c*at,$e+=c*rt,Je+=c*Ct,Ye+=c*At,nt+=c*pt,qe+=c*Ot,Ze+=c*dt,Ne+=c*_t,He+=c*gt,ut+=c*We,je+=c*Tt,Pt+=c*Rt,c=A[5],Ie+=c*ht,St+=c*tt,mt+=c*lt,st+=c*ft,$e+=c*at,Je+=c*rt,Ye+=c*Ct,nt+=c*At,qe+=c*pt,Ze+=c*Ot,Ne+=c*dt,He+=c*_t,ut+=c*gt,je+=c*We,Pt+=c*Tt,$t+=c*Rt,c=A[6],St+=c*ht,mt+=c*tt,st+=c*lt,$e+=c*ft,Je+=c*at,Ye+=c*rt,nt+=c*Ct,qe+=c*At,Ze+=c*pt,Ne+=c*Ot,He+=c*dt,ut+=c*_t,je+=c*gt,Pt+=c*We,$t+=c*Tt,Ut+=c*Rt,c=A[7],mt+=c*ht,st+=c*tt,$e+=c*lt,Je+=c*ft,Ye+=c*at,nt+=c*rt,qe+=c*Ct,Ze+=c*At,Ne+=c*pt,He+=c*Ot,ut+=c*dt,je+=c*_t,Pt+=c*gt,$t+=c*We,Ut+=c*Tt,kt+=c*Rt,c=A[8],st+=c*ht,$e+=c*tt,Je+=c*lt,Ye+=c*ft,nt+=c*at,qe+=c*rt,Ze+=c*Ct,Ne+=c*At,He+=c*pt,ut+=c*Ot,je+=c*dt,Pt+=c*_t,$t+=c*gt,Ut+=c*We,kt+=c*Tt,Mt+=c*Rt,c=A[9],$e+=c*ht,Je+=c*tt,Ye+=c*lt,nt+=c*ft,qe+=c*at,Ze+=c*rt,Ne+=c*Ct,He+=c*At,ut+=c*pt,je+=c*Ot,Pt+=c*dt,$t+=c*_t,Ut+=c*gt,kt+=c*We,Mt+=c*Tt,Gt+=c*Rt,c=A[10],Je+=c*ht,Ye+=c*tt,nt+=c*lt,qe+=c*ft,Ze+=c*at,Ne+=c*rt,He+=c*Ct,ut+=c*At,je+=c*pt,Pt+=c*Ot,$t+=c*dt,Ut+=c*_t,kt+=c*gt,Mt+=c*We,Gt+=c*Tt,tr+=c*Rt,c=A[11],Ye+=c*ht,nt+=c*tt,qe+=c*lt,Ze+=c*ft,Ne+=c*at,He+=c*rt,ut+=c*Ct,je+=c*At,Pt+=c*pt,$t+=c*Ot,Ut+=c*dt,kt+=c*_t,Mt+=c*gt,Gt+=c*We,tr+=c*Tt,Dr+=c*Rt,c=A[12],nt+=c*ht,qe+=c*tt,Ze+=c*lt,Ne+=c*ft,He+=c*at,ut+=c*rt,je+=c*Ct,Pt+=c*At,$t+=c*pt,Ut+=c*Ot,kt+=c*dt,Mt+=c*_t,Gt+=c*gt,tr+=c*We,Dr+=c*Tt,Wt+=c*Rt,c=A[13],qe+=c*ht,Ze+=c*tt,Ne+=c*lt,He+=c*ft,ut+=c*at,je+=c*rt,Pt+=c*Ct,$t+=c*At,Ut+=c*pt,kt+=c*Ot,Mt+=c*dt,Gt+=c*_t,tr+=c*gt,Dr+=c*We,Wt+=c*Tt,Hr+=c*Rt,c=A[14],Ze+=c*ht,Ne+=c*tt,He+=c*lt,ut+=c*ft,je+=c*at,Pt+=c*rt,$t+=c*Ct,Ut+=c*At,kt+=c*pt,Mt+=c*Ot,Gt+=c*dt,tr+=c*_t,Dr+=c*gt,Wt+=c*We,Hr+=c*Tt,ri+=c*Rt,c=A[15],Ne+=c*ht,He+=c*tt,ut+=c*lt,je+=c*ft,Pt+=c*at,$t+=c*rt,Ut+=c*Ct,kt+=c*At,Mt+=c*pt,Gt+=c*Ot,tr+=c*dt,Dr+=c*_t,Wt+=c*gt,Hr+=c*We,ri+=c*Tt,_i+=c*Rt,Q+=38*He,oe+=38*ut,ye+=38*je,Re+=38*Pt,Fe+=38*$t,Ie+=38*Ut,St+=38*kt,mt+=38*Mt,st+=38*Gt,$e+=38*tr,Je+=38*Dr,Ye+=38*Wt,nt+=38*Hr,qe+=38*ri,Ze+=38*_i,w=1,c=Q+w+65535,w=Math.floor(c/65536),Q=c-w*65536,c=oe+w+65535,w=Math.floor(c/65536),oe=c-w*65536,c=ye+w+65535,w=Math.floor(c/65536),ye=c-w*65536,c=Re+w+65535,w=Math.floor(c/65536),Re=c-w*65536,c=Fe+w+65535,w=Math.floor(c/65536),Fe=c-w*65536,c=Ie+w+65535,w=Math.floor(c/65536),Ie=c-w*65536,c=St+w+65535,w=Math.floor(c/65536),St=c-w*65536,c=mt+w+65535,w=Math.floor(c/65536),mt=c-w*65536,c=st+w+65535,w=Math.floor(c/65536),st=c-w*65536,c=$e+w+65535,w=Math.floor(c/65536),$e=c-w*65536,c=Je+w+65535,w=Math.floor(c/65536),Je=c-w*65536,c=Ye+w+65535,w=Math.floor(c/65536),Ye=c-w*65536,c=nt+w+65535,w=Math.floor(c/65536),nt=c-w*65536,c=qe+w+65535,w=Math.floor(c/65536),qe=c-w*65536,c=Ze+w+65535,w=Math.floor(c/65536),Ze=c-w*65536,c=Ne+w+65535,w=Math.floor(c/65536),Ne=c-w*65536,Q+=w-1+37*(w-1),w=1,c=Q+w+65535,w=Math.floor(c/65536),Q=c-w*65536,c=oe+w+65535,w=Math.floor(c/65536),oe=c-w*65536,c=ye+w+65535,w=Math.floor(c/65536),ye=c-w*65536,c=Re+w+65535,w=Math.floor(c/65536),Re=c-w*65536,c=Fe+w+65535,w=Math.floor(c/65536),Fe=c-w*65536,c=Ie+w+65535,w=Math.floor(c/65536),Ie=c-w*65536,c=St+w+65535,w=Math.floor(c/65536),St=c-w*65536,c=mt+w+65535,w=Math.floor(c/65536),mt=c-w*65536,c=st+w+65535,w=Math.floor(c/65536),st=c-w*65536,c=$e+w+65535,w=Math.floor(c/65536),$e=c-w*65536,c=Je+w+65535,w=Math.floor(c/65536),Je=c-w*65536,c=Ye+w+65535,w=Math.floor(c/65536),Ye=c-w*65536,c=nt+w+65535,w=Math.floor(c/65536),nt=c-w*65536,c=qe+w+65535,w=Math.floor(c/65536),qe=c-w*65536,c=Ze+w+65535,w=Math.floor(c/65536),Ze=c-w*65536,c=Ne+w+65535,w=Math.floor(c/65536),Ne=c-w*65536,Q+=w-1+37*(w-1),O[0]=Q,O[1]=oe,O[2]=ye,O[3]=Re,O[4]=Fe,O[5]=Ie,O[6]=St,O[7]=mt,O[8]=st,O[9]=$e,O[10]=Je,O[11]=Ye,O[12]=nt,O[13]=qe,O[14]=Ze,O[15]=Ne}function B(O,A){M(O,A,A)}function ge(O,A){const I=a();let c;for(c=0;c<16;c++)I[c]=A[c];for(c=253;c>=0;c--)B(I,I),c!==2&&c!==4&&M(I,I,A);for(c=0;c<16;c++)O[c]=I[c]}function te(O,A){const I=a();let c;for(c=0;c<16;c++)I[c]=A[c];for(c=250;c>=0;c--)B(I,I),c!==1&&M(I,I,A);for(c=0;c<16;c++)O[c]=I[c]}function Ee(O,A){const I=a(),c=a(),w=a(),Q=a(),oe=a(),ye=a(),Re=a(),Fe=a(),Ie=a();T(I,O[1],O[0]),T(Ie,A[1],A[0]),M(I,I,Ie),he(c,O[0],O[1]),he(Ie,A[0],A[1]),M(c,c,Ie),M(w,O[3],A[3]),M(w,w,S),M(Q,O[2],A[2]),he(Q,Q,Q),T(oe,c,I),T(ye,Q,w),he(Re,Q,w),he(Fe,c,I),M(O[0],oe,ye),M(O[1],Fe,Re),M(O[2],Re,ye),M(O[3],oe,Fe)}function Oe(O,A,I){for(let c=0;c<4;c++)K(O[c],A[c],I)}function et(O,A){const I=a(),c=a(),w=a();ge(w,A[2]),M(I,A[0],w),M(c,A[1],w),ae(O,c),O[31]^=pe(I)<<7}function C(O,A,I){V(O[0],g),V(O[1],y),V(O[2],y),V(O[3],g);for(let c=255;c>=0;--c){const w=I[c/8|0]>>(c&7)&1;Oe(O,A,w),Ee(A,O),Ee(O,O),Oe(O,A,w)}}function D(O,A){const I=[a(),a(),a(),a()];V(I[0],$),V(I[1],G),V(I[2],y),M(I[3],$,G),C(O,I,A)}function ze(O){if(O.length!==h.SEED_LENGTH)throw new Error(`ed25519: seed must be ${h.SEED_LENGTH} bytes`);const A=(0,r.hash)(O);A[0]&=248,A[31]&=127,A[31]|=64;const I=new Uint8Array(32),c=[a(),a(),a(),a()];D(c,A),et(I,c);const w=new Uint8Array(64);return w.set(O),w.set(I,32),{publicKey:I,secretKey:w}}h.generateKeyPairFromSeed=ze;function Te(O){const A=(0,i.randomBytes)(32,O),I=ze(A);return(0,n.wipe)(A),I}h.generateKeyPair=Te;function J(O){if(O.length!==h.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${h.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(O.subarray(32))}h.extractPublicKeyFromSecretKey=J;const U=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function z(O,A){let I,c,w,Q;for(c=63;c>=32;--c){for(I=0,w=c-32,Q=c-12;w<Q;++w)A[w]+=I-16*A[c]*U[w-(c-32)],I=Math.floor((A[w]+128)/256),A[w]-=I*256;A[w]+=I,A[c]=0}for(I=0,w=0;w<32;w++)A[w]+=I-(A[31]>>4)*U[w],I=A[w]>>8,A[w]&=255;for(w=0;w<32;w++)A[w]-=I*U[w];for(c=0;c<32;c++)A[c+1]+=A[c]>>8,O[c]=A[c]&255}function k(O){const A=new Float64Array(64);for(let I=0;I<64;I++)A[I]=O[I];for(let I=0;I<64;I++)O[I]=0;z(O,A)}function ct(O,A){const I=new Float64Array(64),c=[a(),a(),a(),a()],w=(0,r.hash)(O.subarray(0,32));w[0]&=248,w[31]&=127,w[31]|=64;const Q=new Uint8Array(64);Q.set(w.subarray(32),32);const oe=new r.SHA512;oe.update(Q.subarray(32)),oe.update(A);const ye=oe.digest();oe.clean(),k(ye),D(c,ye),et(Q,c),oe.reset(),oe.update(Q.subarray(0,32)),oe.update(O.subarray(32)),oe.update(A);const Re=oe.digest();k(Re);for(let Fe=0;Fe<32;Fe++)I[Fe]=ye[Fe];for(let Fe=0;Fe<32;Fe++)for(let Ie=0;Ie<32;Ie++)I[Fe+Ie]+=Re[Fe]*w[Ie];return z(Q.subarray(32),I),Q}h.sign=ct;function ke(O,A){const I=a(),c=a(),w=a(),Q=a(),oe=a(),ye=a(),Re=a();return V(O[2],y),ue(O[1],A),B(w,O[1]),M(Q,w,_),T(w,w,O[2]),he(Q,O[2],Q),B(oe,Q),B(ye,oe),M(Re,ye,oe),M(I,Re,w),M(I,I,Q),te(I,I),M(I,I,w),M(I,I,Q),M(I,I,Q),M(O[0],I,Q),B(c,O[0]),M(c,c,Q),de(c,w)&&M(O[0],O[0],W),B(c,O[0]),M(c,c,Q),de(c,w)?-1:(pe(O[0])===A[31]>>7&&T(O[0],g,O[0]),M(O[3],O[0],O[1]),0)}function Fr(O,A,I){const c=new Uint8Array(32),w=[a(),a(),a(),a()],Q=[a(),a(),a(),a()];if(I.length!==h.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${h.SIGNATURE_LENGTH} bytes`);if(ke(Q,O))return!1;const oe=new r.SHA512;oe.update(I.subarray(0,32)),oe.update(O),oe.update(A);const ye=oe.digest();return k(ye),C(w,Q,ye),D(Q,I.subarray(32)),Ee(w,Q),et(c,w),!be(I,c)}h.verify=Fr;function _e(O){let A=[a(),a(),a(),a()];if(ke(A,O))throw new Error("Ed25519: invalid public key");let I=a(),c=a(),w=A[1];he(I,y,w),T(c,y,w),ge(c,c),M(I,I,c);let Q=new Uint8Array(32);return ae(Q,I),Q}h.convertPublicKeyToX25519=_e;function It(O){const A=(0,r.hash)(O.subarray(0,32));A[0]&=248,A[31]&=127,A[31]|=64;const I=new Uint8Array(A.subarray(0,32));return(0,n.wipe)(A),I}h.convertSecretKeyToX25519=It})(lc);const Z1="EdDSA",X1="JWT",Rl=".",Nl="base64url",Q1="utf8",em="utf8",tm=":",rm="did",im="key",$h="base58btc",sm="z",nm="K36",am=32;function ta(h){return sa(ic(sc(h),Q1),Nl)}function Fl(h){const i=ic(nm,$h),r=sm+sa($y([i,h]),$h);return[rm,im,r].join(tm)}function om(h){return sa(h,Nl)}function cm(h){return ic([ta(h.header),ta(h.payload)].join(Rl),em)}function um(h){return[ta(h.header),ta(h.payload),om(h.signature)].join(Rl)}function Lh(h=yl.randomBytes(am)){return lc.generateKeyPairFromSeed(h)}async function hm(h,i,r,n,a=ie.fromMiliseconds(Date.now())){const l={alg:Z1,typ:X1},g=Fl(n.publicKey),y=a+r,_={iss:g,sub:h,aud:i,iat:a,exp:y},S=cm({header:l,payload:_}),$=lc.sign(n.secretKey,S);return um({header:l,payload:_,signature:$})}const lm=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),fm=()=>typeof window<"u",jh=h=>h.split("?")[0],Mh=10,pm=lm();class dm{constructor(i){if(this.url=i,this.events=new kr.EventEmitter,this.registering=!1,!wh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);this.url=i}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async open(i=this.url){await this.register(i)}async close(){return new Promise((i,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),i()},this.socket.close()})}async send(i,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(sc(i))}catch(n){this.onError(i.id,n)}}register(i=this.url){if(!wh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,a)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),a(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=i,this.registering=!0,new Promise((r,n)=>{const a=w1.isReactNative()?void 0:{rejectUnauthorized:!b1(i)},l=new pm(i,[],a);fm()?l.onerror=g=>{const y=g;n(this.emitError(y.error))}:l.on("error",g=>{n(this.emitError(g))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(i){i.onmessage=r=>this.onPayload(r),i.onclose=r=>this.onClose(r),this.socket=i,this.registering=!1,this.events.emit("open")}onClose(i){this.socket=void 0,this.registering=!1,this.events.emit("close",i)}onPayload(i){if(typeof i.data>"u")return;const r=typeof i.data=="string"?Il(i.data):i.data;this.events.emit("payload",r)}onError(i,r){const n=this.parseError(r),a=n.message||n.toString(),l=nc(i,a);this.events.emit("payload",l)}parseError(i,r=this.url){return E1(i,jh(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Mh&&this.events.setMaxListeners(Mh)}emitError(i){const r=this.parseError(new Error((i==null?void 0:i.message)||`WebSocket connection failed for host: ${jh(this.url)}`));return this.events.emit("register_error",r),r}}var ra={exports:{}};ra.exports;(function(h,i){var r=200,n="__lodash_hash_undefined__",a=1,l=2,g=9007199254740991,y="[object Arguments]",_="[object Array]",S="[object AsyncFunction]",$="[object Boolean]",G="[object Date]",W="[object Error]",V="[object Function]",q="[object GeneratorFunction]",K="[object Map]",ae="[object Number]",be="[object Null]",de="[object Object]",pe="[object Promise]",ue="[object Proxy]",he="[object RegExp]",T="[object Set]",M="[object String]",B="[object Symbol]",ge="[object Undefined]",te="[object WeakMap]",Ee="[object ArrayBuffer]",Oe="[object DataView]",et="[object Float32Array]",C="[object Float64Array]",D="[object Int8Array]",ze="[object Int16Array]",Te="[object Int32Array]",J="[object Uint8Array]",U="[object Uint8ClampedArray]",z="[object Uint16Array]",k="[object Uint32Array]",ct=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,Fr=/^(?:0|[1-9]\d*)$/,_e={};_e[et]=_e[C]=_e[D]=_e[ze]=_e[Te]=_e[J]=_e[U]=_e[z]=_e[k]=!0,_e[y]=_e[_]=_e[Ee]=_e[$]=_e[Oe]=_e[G]=_e[W]=_e[V]=_e[K]=_e[ae]=_e[de]=_e[he]=_e[T]=_e[M]=_e[te]=!1;var It=typeof $i=="object"&&$i&&$i.Object===Object&&$i,O=typeof self=="object"&&self&&self.Object===Object&&self,A=It||O||Function("return this")(),I=i&&!i.nodeType&&i,c=I&&!0&&h&&!h.nodeType&&h,w=c&&c.exports===I,Q=w&&It.process,oe=function(){try{return Q&&Q.binding&&Q.binding("util")}catch{}}(),ye=oe&&oe.isTypedArray;function Re(d,b){for(var L=-1,Y=d==null?0:d.length,Ve=0,le=[];++L<Y;){var Xe=d[L];b(Xe,L,d)&&(le[Ve++]=Xe)}return le}function Fe(d,b){for(var L=-1,Y=b.length,Ve=d.length;++L<Y;)d[Ve+L]=b[L];return d}function Ie(d,b){for(var L=-1,Y=d==null?0:d.length;++L<Y;)if(b(d[L],L,d))return!0;return!1}function St(d,b){for(var L=-1,Y=Array(d);++L<d;)Y[L]=b(L);return Y}function mt(d){return function(b){return d(b)}}function st(d,b){return d.has(b)}function $e(d,b){return d==null?void 0:d[b]}function Je(d){var b=-1,L=Array(d.size);return d.forEach(function(Y,Ve){L[++b]=[Ve,Y]}),L}function Ye(d,b){return function(L){return d(b(L))}}function nt(d){var b=-1,L=Array(d.size);return d.forEach(function(Y){L[++b]=Y}),L}var qe=Array.prototype,Ze=Function.prototype,Ne=Object.prototype,He=A["__core-js_shared__"],ut=Ze.toString,je=Ne.hasOwnProperty,Pt=function(){var d=/[^.]+$/.exec(He&&He.keys&&He.keys.IE_PROTO||"");return d?"Symbol(src)_1."+d:""}(),$t=Ne.toString,Ut=RegExp("^"+ut.call(je).replace(ct,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kt=w?A.Buffer:void 0,Mt=A.Symbol,Gt=A.Uint8Array,tr=Ne.propertyIsEnumerable,Dr=qe.splice,Wt=Mt?Mt.toStringTag:void 0,Hr=Object.getOwnPropertySymbols,ri=kt?kt.isBuffer:void 0,_i=Ye(Object.keys,Object),ht=cr(A,"DataView"),tt=cr(A,"Map"),lt=cr(A,"Promise"),ft=cr(A,"Set"),at=cr(A,"WeakMap"),rt=cr(Object,"create"),Ct=Vr(ht),At=Vr(tt),pt=Vr(lt),Ot=Vr(ft),dt=Vr(at),_t=Mt?Mt.prototype:void 0,gt=_t?_t.valueOf:void 0;function We(d){var b=-1,L=d==null?0:d.length;for(this.clear();++b<L;){var Y=d[b];this.set(Y[0],Y[1])}}function Tt(){this.__data__=rt?rt(null):{},this.size=0}function Rt(d){var b=this.has(d)&&delete this.__data__[d];return this.size-=b?1:0,b}function ca(d){var b=this.__data__;if(rt){var L=b[d];return L===n?void 0:L}return je.call(b,d)?b[d]:void 0}function ua(d){var b=this.__data__;return rt?b[d]!==void 0:je.call(b,d)}function ha(d,b){var L=this.__data__;return this.size+=this.has(d)?0:1,L[d]=rt&&b===void 0?n:b,this}We.prototype.clear=Tt,We.prototype.delete=Rt,We.prototype.get=ca,We.prototype.has=ua,We.prototype.set=ha;function dr(d){var b=-1,L=d==null?0:d.length;for(this.clear();++b<L;){var Y=d[b];this.set(Y[0],Y[1])}}function la(){this.__data__=[],this.size=0}function fa(d){var b=this.__data__,L=wi(b,d);if(L<0)return!1;var Y=b.length-1;return L==Y?b.pop():Dr.call(b,L,1),--this.size,!0}function pa(d){var b=this.__data__,L=wi(b,d);return L<0?void 0:b[L][1]}function da(d){return wi(this.__data__,d)>-1}function ga(d,b){var L=this.__data__,Y=wi(L,d);return Y<0?(++this.size,L.push([d,b])):L[Y][1]=b,this}dr.prototype.clear=la,dr.prototype.delete=fa,dr.prototype.get=pa,dr.prototype.has=da,dr.prototype.set=ga;function Kr(d){var b=-1,L=d==null?0:d.length;for(this.clear();++b<L;){var Y=d[b];this.set(Y[0],Y[1])}}function zi(){this.size=0,this.__data__={hash:new We,map:new(tt||dr),string:new We}}function va(d){var b=ii(this,d).delete(d);return this.size-=b?1:0,b}function qi(d){return ii(this,d).get(d)}function ya(d){return ii(this,d).has(d)}function ma(d,b){var L=ii(this,d),Y=L.size;return L.set(d,b),this.size+=L.size==Y?0:1,this}Kr.prototype.clear=zi,Kr.prototype.delete=va,Kr.prototype.get=qi,Kr.prototype.has=ya,Kr.prototype.set=ma;function Ui(d){var b=-1,L=d==null?0:d.length;for(this.__data__=new Kr;++b<L;)this.add(d[b])}function Hs(d){return this.__data__.set(d,n),this}function Ks(d){return this.__data__.has(d)}Ui.prototype.add=Ui.prototype.push=Hs,Ui.prototype.has=Ks;function Pr(d){var b=this.__data__=new dr(d);this.size=b.size}function _a(){this.__data__=new dr,this.size=0}function wa(d){var b=this.__data__,L=b.delete(d);return this.size=b.size,L}function ba(d){return this.__data__.get(d)}function Ea(d){return this.__data__.has(d)}function Vs(d,b){var L=this.__data__;if(L instanceof dr){var Y=L.__data__;if(!tt||Y.length<r-1)return Y.push([d,b]),this.size=++L.size,this;L=this.__data__=new Kr(Y)}return L.set(d,b),this.size=L.size,this}Pr.prototype.clear=_a,Pr.prototype.delete=wa,Pr.prototype.get=ba,Pr.prototype.has=Ea,Pr.prototype.set=Vs;function Bs(d,b){var L=Ki(d),Y=!L&&nn(d),Ve=!L&&!Y&&ps(d),le=!L&&!Y&&!Ve&&cn(d),Xe=L||Y||Ve||le,Nt=Xe?St(d.length,String):[],Pe=Nt.length;for(var Be in d)(b||je.call(d,Be))&&!(Xe&&(Be=="length"||Ve&&(Be=="offset"||Be=="parent")||le&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||Qs(Be,Pe)))&&Nt.push(Be);return Nt}function wi(d,b){for(var L=d.length;L--;)if(sn(d[L][0],b))return L;return-1}function ls(d,b,L){var Y=b(d);return Ki(d)?Y:Fe(Y,L(d))}function bi(d){return d==null?d===void 0?ge:be:Wt&&Wt in Object(d)?Zs(d):Sa(d)}function fs(d){return xi(d)&&bi(d)==y}function Ei(d,b,L,Y,Ve){return d===b?!0:d==null||b==null||!xi(d)&&!xi(b)?d!==d&&b!==b:Gs(d,b,L,Y,Ei,Ve)}function Gs(d,b,L,Y,Ve,le){var Xe=Ki(d),Nt=Ki(b),Pe=Xe?_:$r(d),Be=Nt?_:$r(b);Pe=Pe==y?de:Pe,Be=Be==y?de:Be;var wt=Pe==de,rr=Be==de,Ft=Pe==Be;if(Ft&&ps(d)){if(!ps(b))return!1;Xe=!0,wt=!1}if(Ft&&!wt)return le||(le=new Pr),Xe||cn(d)?ki(d,b,L,Y,Ve,le):Ia(d,b,Pe,L,Y,Ve,le);if(!(L&a)){var Qe=wt&&je.call(d,"__wrapped__"),Jt=rr&&je.call(b,"__wrapped__");if(Qe||Jt){var Cr=Qe?d.value():d,gr=Jt?b.value():b;return le||(le=new Pr),Ve(Cr,gr,L,Y,le)}}return Ft?(le||(le=new Pr),Ys(d,b,L,Y,Ve,le)):!1}function xa(d){if(!on(d)||tn(d))return!1;var b=Vi(d)?Ut:ke;return b.test(Vr(d))}function Ws(d){return xi(d)&&an(d.length)&&!!_e[bi(d)]}function Js(d){if(!rn(d))return _i(d);var b=[];for(var L in Object(d))je.call(d,L)&&L!="constructor"&&b.push(L);return b}function ki(d,b,L,Y,Ve,le){var Xe=L&a,Nt=d.length,Pe=b.length;if(Nt!=Pe&&!(Xe&&Pe>Nt))return!1;var Be=le.get(d);if(Be&&le.get(b))return Be==b;var wt=-1,rr=!0,Ft=L&l?new Ui:void 0;for(le.set(d,b),le.set(b,d);++wt<Nt;){var Qe=d[wt],Jt=b[wt];if(Y)var Cr=Xe?Y(Jt,Qe,wt,b,d,le):Y(Qe,Jt,wt,d,b,le);if(Cr!==void 0){if(Cr)continue;rr=!1;break}if(Ft){if(!Ie(b,function(gr,Lr){if(!st(Ft,Lr)&&(Qe===gr||Ve(Qe,gr,L,Y,le)))return Ft.push(Lr)})){rr=!1;break}}else if(!(Qe===Jt||Ve(Qe,Jt,L,Y,le))){rr=!1;break}}return le.delete(d),le.delete(b),rr}function Ia(d,b,L,Y,Ve,le,Xe){switch(L){case Oe:if(d.byteLength!=b.byteLength||d.byteOffset!=b.byteOffset)return!1;d=d.buffer,b=b.buffer;case Ee:return!(d.byteLength!=b.byteLength||!le(new Gt(d),new Gt(b)));case $:case G:case ae:return sn(+d,+b);case W:return d.name==b.name&&d.message==b.message;case he:case M:return d==b+"";case K:var Nt=Je;case T:var Pe=Y&a;if(Nt||(Nt=nt),d.size!=b.size&&!Pe)return!1;var Be=Xe.get(d);if(Be)return Be==b;Y|=l,Xe.set(d,b);var wt=ki(Nt(d),Nt(b),Y,Ve,le,Xe);return Xe.delete(d),wt;case B:if(gt)return gt.call(d)==gt.call(b)}return!1}function Ys(d,b,L,Y,Ve,le){var Xe=L&a,Nt=Hi(d),Pe=Nt.length,Be=Hi(b),wt=Be.length;if(Pe!=wt&&!Xe)return!1;for(var rr=Pe;rr--;){var Ft=Nt[rr];if(!(Xe?Ft in b:je.call(b,Ft)))return!1}var Qe=le.get(d);if(Qe&&le.get(b))return Qe==b;var Jt=!0;le.set(d,b),le.set(b,d);for(var Cr=Xe;++rr<Pe;){Ft=Nt[rr];var gr=d[Ft],Lr=b[Ft];if(Y)var ds=Xe?Y(Lr,gr,Ft,b,d,le):Y(gr,Lr,Ft,d,b,le);if(!(ds===void 0?gr===Lr||Ve(gr,Lr,L,Y,le):ds)){Jt=!1;break}Cr||(Cr=Ft=="constructor")}if(Jt&&!Cr){var Ii=d.constructor,zt=b.constructor;Ii!=zt&&"constructor"in d&&"constructor"in b&&!(typeof Ii=="function"&&Ii instanceof Ii&&typeof zt=="function"&&zt instanceof zt)&&(Jt=!1)}return le.delete(d),le.delete(b),Jt}function Hi(d){return ls(d,Aa,Xs)}function ii(d,b){var L=d.__data__;return en(b)?L[typeof b=="string"?"string":"hash"]:L.map}function cr(d,b){var L=$e(d,b);return xa(L)?L:void 0}function Zs(d){var b=je.call(d,Wt),L=d[Wt];try{d[Wt]=void 0;var Y=!0}catch{}var Ve=$t.call(d);return Y&&(b?d[Wt]=L:delete d[Wt]),Ve}var Xs=Hr?function(d){return d==null?[]:(d=Object(d),Re(Hr(d),function(b){return tr.call(d,b)}))}:Ke,$r=bi;(ht&&$r(new ht(new ArrayBuffer(1)))!=Oe||tt&&$r(new tt)!=K||lt&&$r(lt.resolve())!=pe||ft&&$r(new ft)!=T||at&&$r(new at)!=te)&&($r=function(d){var b=bi(d),L=b==de?d.constructor:void 0,Y=L?Vr(L):"";if(Y)switch(Y){case Ct:return Oe;case At:return K;case pt:return pe;case Ot:return T;case dt:return te}return b});function Qs(d,b){return b=b??g,!!b&&(typeof d=="number"||Fr.test(d))&&d>-1&&d%1==0&&d<b}function en(d){var b=typeof d;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?d!=="__proto__":d===null}function tn(d){return!!Pt&&Pt in d}function rn(d){var b=d&&d.constructor,L=typeof b=="function"&&b.prototype||Ne;return d===L}function Sa(d){return $t.call(d)}function Vr(d){if(d!=null){try{return ut.call(d)}catch{}try{return d+""}catch{}}return""}function sn(d,b){return d===b||d!==d&&b!==b}var nn=fs(function(){return arguments}())?fs:function(d){return xi(d)&&je.call(d,"callee")&&!tr.call(d,"callee")},Ki=Array.isArray;function Pa(d){return d!=null&&an(d.length)&&!Vi(d)}var ps=ri||Ue;function Ca(d,b){return Ei(d,b)}function Vi(d){if(!on(d))return!1;var b=bi(d);return b==V||b==q||b==S||b==ue}function an(d){return typeof d=="number"&&d>-1&&d%1==0&&d<=g}function on(d){var b=typeof d;return d!=null&&(b=="object"||b=="function")}function xi(d){return d!=null&&typeof d=="object"}var cn=ye?mt(ye):Ws;function Aa(d){return Pa(d)?Bs(d):Js(d)}function Ke(){return[]}function Ue(){return!1}h.exports=Ca})(ra,ra.exports);var gm=ra.exports;const vm=Ly(gm);function ym(h,i){if(h.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var a=0;a<h.length;a++){var l=h.charAt(a),g=l.charCodeAt(0);if(r[g]!==255)throw new TypeError(l+" is ambiguous");r[g]=a}var y=h.length,_=h.charAt(0),S=Math.log(y)/Math.log(256),$=Math.log(256)/Math.log(y);function G(q){if(q instanceof Uint8Array||(ArrayBuffer.isView(q)?q=new Uint8Array(q.buffer,q.byteOffset,q.byteLength):Array.isArray(q)&&(q=Uint8Array.from(q))),!(q instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(q.length===0)return"";for(var K=0,ae=0,be=0,de=q.length;be!==de&&q[be]===0;)be++,K++;for(var pe=(de-be)*$+1>>>0,ue=new Uint8Array(pe);be!==de;){for(var he=q[be],T=0,M=pe-1;(he!==0||T<ae)&&M!==-1;M--,T++)he+=256*ue[M]>>>0,ue[M]=he%y>>>0,he=he/y>>>0;if(he!==0)throw new Error("Non-zero carry");ae=T,be++}for(var B=pe-ae;B!==pe&&ue[B]===0;)B++;for(var ge=_.repeat(K);B<pe;++B)ge+=h.charAt(ue[B]);return ge}function W(q){if(typeof q!="string")throw new TypeError("Expected String");if(q.length===0)return new Uint8Array;var K=0;if(q[K]!==" "){for(var ae=0,be=0;q[K]===_;)ae++,K++;for(var de=(q.length-K)*S+1>>>0,pe=new Uint8Array(de);q[K];){var ue=r[q.charCodeAt(K)];if(ue===255)return;for(var he=0,T=de-1;(ue!==0||he<be)&&T!==-1;T--,he++)ue+=y*pe[T]>>>0,pe[T]=ue%256>>>0,ue=ue/256>>>0;if(ue!==0)throw new Error("Non-zero carry");be=he,K++}if(q[K]!==" "){for(var M=de-be;M!==de&&pe[M]===0;)M++;for(var B=new Uint8Array(ae+(de-M)),ge=ae;M!==de;)B[ge++]=pe[M++];return B}}}function V(q){var K=W(q);if(K)return K;throw new Error(`Non-${i} character`)}return{encode:G,decodeUnsafe:W,decode:V}}var mm=ym,_m=mm;const Dl=h=>{if(h instanceof Uint8Array&&h.constructor.name==="Uint8Array")return h;if(h instanceof ArrayBuffer)return new Uint8Array(h);if(ArrayBuffer.isView(h))return new Uint8Array(h.buffer,h.byteOffset,h.byteLength);throw new Error("Unknown type, must be binary type")},wm=h=>new TextEncoder().encode(h),bm=h=>new TextDecoder().decode(h);class Em{constructor(i,r,n){this.name=i,this.prefix=r,this.baseEncode=n}encode(i){if(i instanceof Uint8Array)return`${this.prefix}${this.baseEncode(i)}`;throw Error("Unknown type, must be binary type")}}class xm{constructor(i,r,n){if(this.name=i,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(i){if(typeof i=="string"){if(i.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(i)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(i.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(i){return $l(this,i)}}class Im{constructor(i){this.decoders=i}or(i){return $l(this,i)}decode(i){const r=i[0],n=this.decoders[r];if(n)return n.decode(i);throw RangeError(`Unable to decode multibase string ${JSON.stringify(i)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const $l=(h,i)=>new Im({...h.decoders||{[h.prefix]:h},...i.decoders||{[i.prefix]:i}});class Sm{constructor(i,r,n,a){this.name=i,this.prefix=r,this.baseEncode=n,this.baseDecode=a,this.encoder=new Em(i,r,n),this.decoder=new xm(i,r,a)}encode(i){return this.encoder.encode(i)}decode(i){return this.decoder.decode(i)}}const aa=({name:h,prefix:i,encode:r,decode:n})=>new Sm(h,i,r,n),ks=({prefix:h,name:i,alphabet:r})=>{const{encode:n,decode:a}=_m(r,i);return aa({prefix:h,name:i,encode:n,decode:l=>Dl(a(l))})},Pm=(h,i,r,n)=>{const a={};for(let $=0;$<i.length;++$)a[i[$]]=$;let l=h.length;for(;h[l-1]==="=";)--l;const g=new Uint8Array(l*r/8|0);let y=0,_=0,S=0;for(let $=0;$<l;++$){const G=a[h[$]];if(G===void 0)throw new SyntaxError(`Non-${n} character`);_=_<<r|G,y+=r,y>=8&&(y-=8,g[S++]=255&_>>y)}if(y>=r||255&_<<8-y)throw new SyntaxError("Unexpected end of data");return g},Cm=(h,i,r)=>{const n=i[i.length-1]==="=",a=(1<<r)-1;let l="",g=0,y=0;for(let _=0;_<h.length;++_)for(y=y<<8|h[_],g+=8;g>r;)g-=r,l+=i[a&y>>g];if(g&&(l+=i[a&y<<r-g]),n)for(;l.length*r&7;)l+="=";return l},Kt=({name:h,prefix:i,bitsPerChar:r,alphabet:n})=>aa({prefix:i,name:h,encode(a){return Cm(a,n,r)},decode(a){return Pm(a,n,r,h)}}),Am=aa({prefix:"\0",name:"identity",encode:h=>bm(h),decode:h=>wm(h)});var Om=Object.freeze({__proto__:null,identity:Am});const Tm=Kt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Rm=Object.freeze({__proto__:null,base2:Tm});const Nm=Kt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Fm=Object.freeze({__proto__:null,base8:Nm});const Dm=ks({prefix:"9",name:"base10",alphabet:"0123456789"});var $m=Object.freeze({__proto__:null,base10:Dm});const Lm=Kt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),jm=Kt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Mm=Object.freeze({__proto__:null,base16:Lm,base16upper:jm});const zm=Kt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),qm=Kt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Um=Kt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),km=Kt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Hm=Kt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Km=Kt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Vm=Kt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bm=Kt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Gm=Kt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Wm=Object.freeze({__proto__:null,base32:zm,base32upper:qm,base32pad:Um,base32padupper:km,base32hex:Hm,base32hexupper:Km,base32hexpad:Vm,base32hexpadupper:Bm,base32z:Gm});const Jm=ks({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ym=ks({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Zm=Object.freeze({__proto__:null,base36:Jm,base36upper:Ym});const Xm=ks({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Qm=ks({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var e_=Object.freeze({__proto__:null,base58btc:Xm,base58flickr:Qm});const t_=Kt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),r_=Kt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),i_=Kt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),s_=Kt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var n_=Object.freeze({__proto__:null,base64:t_,base64pad:r_,base64url:i_,base64urlpad:s_});const Ll=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),a_=Ll.reduce((h,i,r)=>(h[r]=i,h),[]),o_=Ll.reduce((h,i,r)=>(h[i.codePointAt(0)]=r,h),[]);function c_(h){return h.reduce((i,r)=>(i+=a_[r],i),"")}function u_(h){const i=[];for(const r of h){const n=o_[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);i.push(n)}return new Uint8Array(i)}const h_=aa({prefix:"🚀",name:"base256emoji",encode:c_,decode:u_});var l_=Object.freeze({__proto__:null,base256emoji:h_}),f_=jl,zh=128,p_=127,d_=~p_,g_=Math.pow(2,31);function jl(h,i,r){i=i||[],r=r||0;for(var n=r;h>=g_;)i[r++]=h&255|zh,h/=128;for(;h&d_;)i[r++]=h&255|zh,h>>>=7;return i[r]=h|0,jl.bytes=r-n+1,i}var v_=Zo,y_=128,qh=127;function Zo(h,n){var r=0,n=n||0,a=0,l=n,g,y=h.length;do{if(l>=y)throw Zo.bytes=0,new RangeError("Could not decode varint");g=h[l++],r+=a<28?(g&qh)<<a:(g&qh)*Math.pow(2,a),a+=7}while(g>=y_);return Zo.bytes=l-n,r}var m_=Math.pow(2,7),__=Math.pow(2,14),w_=Math.pow(2,21),b_=Math.pow(2,28),E_=Math.pow(2,35),x_=Math.pow(2,42),I_=Math.pow(2,49),S_=Math.pow(2,56),P_=Math.pow(2,63),C_=function(h){return h<m_?1:h<__?2:h<w_?3:h<b_?4:h<E_?5:h<x_?6:h<I_?7:h<S_?8:h<P_?9:10},A_={encode:f_,decode:v_,encodingLength:C_},Ml=A_;const Uh=(h,i,r=0)=>(Ml.encode(h,i,r),i),kh=h=>Ml.encodingLength(h),Xo=(h,i)=>{const r=i.byteLength,n=kh(h),a=n+kh(r),l=new Uint8Array(a+r);return Uh(h,l,0),Uh(r,l,n),l.set(i,a),new O_(h,r,i,l)};class O_{constructor(i,r,n,a){this.code=i,this.size=r,this.digest=n,this.bytes=a}}const zl=({name:h,code:i,encode:r})=>new T_(h,i,r);class T_{constructor(i,r,n){this.name=i,this.code=r,this.encode=n}digest(i){if(i instanceof Uint8Array){const r=this.encode(i);return r instanceof Uint8Array?Xo(this.code,r):r.then(n=>Xo(this.code,n))}else throw Error("Unknown type, must be binary type")}}const ql=h=>async i=>new Uint8Array(await crypto.subtle.digest(h,i)),R_=zl({name:"sha2-256",code:18,encode:ql("SHA-256")}),N_=zl({name:"sha2-512",code:19,encode:ql("SHA-512")});var F_=Object.freeze({__proto__:null,sha256:R_,sha512:N_});const Ul=0,D_="identity",kl=Dl,$_=h=>Xo(Ul,kl(h)),L_={code:Ul,name:D_,encode:kl,digest:$_};var j_=Object.freeze({__proto__:null,identity:L_});new TextEncoder,new TextDecoder;const Hh={...Om,...Rm,...Fm,...$m,...Mm,...Wm,...Zm,...e_,...n_,...l_};({...F_,...j_});function Hl(h){return globalThis.Buffer!=null?new Uint8Array(h.buffer,h.byteOffset,h.byteLength):h}function M_(h=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Hl(globalThis.Buffer.allocUnsafe(h)):new Uint8Array(h)}function Kl(h,i,r,n){return{name:h,prefix:i,encoder:{name:h,prefix:i,encode:r},decoder:{decode:n}}}const Kh=Kl("utf8","u",h=>"u"+new TextDecoder("utf8").decode(h),h=>new TextEncoder().encode(h.substring(1))),qo=Kl("ascii","a",h=>{let i="a";for(let r=0;r<h.length;r++)i+=String.fromCharCode(h[r]);return i},h=>{h=h.substring(1);const i=M_(h.length);for(let r=0;r<h.length;r++)i[r]=h.charCodeAt(r);return i}),z_={utf8:Kh,"utf-8":Kh,hex:Hh.base16,latin1:qo,ascii:qo,binary:qo,...Hh};function q_(h,i="utf8"){const r=z_[i];if(!r)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Hl(globalThis.Buffer.from(h,"utf-8")):r.decoder.decode(`${r.prefix}${h}`)}const Vl="wc",U_=2,fc="core",vi=`${Vl}@2:${fc}:`,k_={name:fc,logger:"error"},H_={database:":memory:"},K_="crypto",Vh="client_ed25519_seed",V_=ie.ONE_DAY,B_="keychain",G_="0.3",W_="messages",J_="0.3",Y_=ie.SIX_HOURS,Z_="publisher",Bl="irn",X_="error",Gl="wss://relay.walletconnect.com",Bh="wss://relay.walletconnect.org",Q_="relayer",yt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ew="_subscription",$s={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},tw=ie.ONE_SECOND/2,rw="2.9.0",iw=1e4,sw="0.3",nw="WALLETCONNECT_CLIENT_ID",Ur={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},aw="subscription",ow="0.3",cw=ie.FIVE_SECONDS*1e3,uw="pairing",hw="0.3",Ls={wc_pairingDelete:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:0},res:{ttl:ie.ONE_DAY,prompt:!1,tag:0}}},qr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},lw="history",fw="0.3",pw="expirer",Ir={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},dw="0.3",Uo="verify-api",Gh="https://verify.walletconnect.com";class gw{constructor(i,r){this.core=i,this.logger=r,this.keychain=new Map,this.name=B_,this.version=G_,this.initialized=!1,this.storagePrefix=vi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,a)=>{this.isInitialized(),this.keychain.set(n,a),await this.persist()},this.get=n=>{this.isInitialized();const a=this.keychain.get(n);if(typeof a>"u"){const{message:l}=X("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(l)}return a},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=i,this.logger=Ae.generateChildLogger(r,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(i){await this.core.storage.setItem(this.storageKey,bl(i))}async getKeyChain(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?El(i):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class vw{constructor(i,r,n){this.core=i,this.logger=r,this.name=K_,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),l=Lh(a);return Fl(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=zy();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const l=await this.getClientSeed(),g=Lh(l),y=Jo();return await hm(y,a,V_,g)},this.generateSharedKey=(a,l,g)=>{this.isInitialized();const y=this.getPrivateKey(a),_=qy(y,l);return this.setSymKey(_,g)},this.setSymKey=async(a,l)=>{this.isInitialized();const g=l||Uy(a);return await this.keychain.set(g,a),g},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,l,g)=>{this.isInitialized();const y=ky(g),_=sc(l);if(vh(y)){const W=y.senderPublicKey,V=y.receiverPublicKey;a=await this.generateSharedKey(W,V)}const S=this.getSymKey(a),{type:$,senderPublicKey:G}=y;return Hy({type:$,symKey:S,message:_,senderPublicKey:G})},this.decode=async(a,l,g)=>{this.isInitialized();const y=Ky(l,g);if(vh(y)){const $=y.receiverPublicKey,G=y.senderPublicKey;a=await this.generateSharedKey($,G)}const _=this.getSymKey(a),S=Vy({symKey:_,encoded:l});return Il(S)},this.getPayloadType=a=>{const l=yh(a);return By(l.type)},this.getPayloadSenderPublicKey=a=>{const l=yh(a);return l.senderPublicKey?sa(l.senderPublicKey,Gy):void 0},this.core=i,this.logger=Ae.generateChildLogger(r,this.name),this.keychain=n||new gw(this.core,this.logger)}get context(){return Ae.getLoggerContext(this.logger)}async setPrivateKey(i,r){return await this.keychain.set(i,r),i}getPrivateKey(i){return this.keychain.get(i)}async getClientSeed(){let i="";try{i=this.keychain.get(Vh)}catch{i=Jo(),await this.keychain.set(Vh,i)}return q_(i,"base16")}getSymKey(i){return this.keychain.get(i)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class yw extends k1{constructor(i,r){super(i,r),this.logger=i,this.core=r,this.messages=new Map,this.name=W_,this.version=J_,this.initialized=!1,this.storagePrefix=vi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,a)=>{this.isInitialized();const l=cs(a);let g=this.messages.get(n);return typeof g>"u"&&(g={}),typeof g[l]<"u"||(g[l]=a,this.messages.set(n,g),await this.persist()),l},this.get=n=>{this.isInitialized();let a=this.messages.get(n);return typeof a>"u"&&(a={}),a},this.has=(n,a)=>{this.isInitialized();const l=this.get(n),g=cs(a);return typeof l[g]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Ae.generateChildLogger(i,this.name),this.core=r}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(i){await this.core.storage.setItem(this.storageKey,bl(i))}async getRelayerMessages(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?El(i):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class mw extends H1{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.events=new kr.EventEmitter,this.name=Z_,this.queue=new Map,this.publishTimeout=ie.toMiliseconds(ie.TEN_SECONDS),this.queueTimeout=ie.toMiliseconds(ie.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,a,l)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:l}});try{const g=(l==null?void 0:l.ttl)||Y_,y=Yo(l),_=(l==null?void 0:l.prompt)||!1,S=(l==null?void 0:l.tag)||0,$=(l==null?void 0:l.id)||Sl().toString(),G={topic:n,message:a,opts:{ttl:g,relay:y,prompt:_,tag:S,id:$}},W=setTimeout(()=>this.queue.set($,G),this.queueTimeout);try{await await ea(this.rpcPublish(n,a,g,y,_,S,$),this.publishTimeout),clearTimeout(W),this.relayer.events.emit(yt.publish,G)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:l}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.relayer=i,this.logger=Ae.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ae.getLoggerContext(this.logger)}rpcPublish(i,r,n,a,l,g,y){var _,S,$,G;const W={method:Zn(a.protocol).publish,params:{topic:i,message:r,ttl:n,prompt:l,tag:g},id:y};return gi((_=W.params)==null?void 0:_.prompt)&&((S=W.params)==null||delete S.prompt),gi(($=W.params)==null?void 0:$.tag)&&((G=W.params)==null||delete G.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:W}),this.relayer.request(W)}onPublish(i){this.queue.delete(i)}checkQueue(){this.queue.forEach(async i=>{const{topic:r,message:n,opts:a}=i;await this.publish(r,n,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(hs.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(yt.connection_stalled);return}this.checkQueue()}),this.relayer.on(yt.message_ack,i=>{this.onPublish(i.id.toString())})}}class _w{constructor(){this.map=new Map,this.set=(i,r)=>{const n=this.get(i);this.exists(i,r)||this.map.set(i,[...n,r])},this.get=i=>this.map.get(i)||[],this.exists=(i,r)=>this.get(i).includes(r),this.delete=(i,r)=>{if(typeof r>"u"){this.map.delete(i);return}if(!this.map.has(i))return;const n=this.get(i);if(!this.exists(i,r))return;const a=n.filter(l=>l!==r);if(!a.length){this.map.delete(i);return}this.map.set(i,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var ww=Object.defineProperty,bw=Object.defineProperties,Ew=Object.getOwnPropertyDescriptors,Wh=Object.getOwnPropertySymbols,xw=Object.prototype.hasOwnProperty,Iw=Object.prototype.propertyIsEnumerable,Jh=(h,i,r)=>i in h?ww(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,js=(h,i)=>{for(var r in i||(i={}))xw.call(i,r)&&Jh(h,r,i[r]);if(Wh)for(var r of Wh(i))Iw.call(i,r)&&Jh(h,r,i[r]);return h},ko=(h,i)=>bw(h,Ew(i));class Sw extends B1{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.subscriptions=new Map,this.topicMap=new _w,this.events=new kr.EventEmitter,this.name=aw,this.version=ow,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=vi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}});try{const l=Yo(a),g={topic:n,relay:l};this.pending.set(n,g);const y=await this.rpcSubscribe(n,l);return this.onSubscribe(y,g),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}}),y}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(n,a.id,a):await this.unsubscribeByTopic(n,a)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((a,l)=>{const g=new ie.Watch;g.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(y),g.stop(this.pendingSubscriptionWatchLabel),a(!0)),g.elapsed(this.pendingSubscriptionWatchLabel)>=cw&&(clearInterval(y),g.stop(this.pendingSubscriptionWatchLabel),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=i,this.logger=Ae.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(i,r){let n=!1;try{n=this.getSubscription(i).topic===r}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(i,r){const n=this.topicMap.get(i);await Promise.all(n.map(async a=>await this.unsubscribeById(i,a,r)))}async unsubscribeById(i,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:n}});try{const a=Yo(n);await this.rpcUnsubscribe(i,r,a);const l=er("USER_DISCONNECTED",`${this.name}, ${i}`);await this.onUnsubscribe(i,r,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:n}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(i,r){const n={method:Zn(r.protocol).subscribe,params:{topic:i}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await ea(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(yt.connection_stalled)}return cs(i+this.clientId)}async rpcBatchSubscribe(i){if(!i.length)return;const r=i[0].relay,n={method:Zn(r.protocol).batchSubscribe,params:{topics:i.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await ea(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(yt.connection_stalled)}}rpcUnsubscribe(i,r,n){const a={method:Zn(n.protocol).unsubscribe,params:{topic:i,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(i,r){this.setSubscription(i,ko(js({},r),{id:i})),this.pending.delete(r.topic)}onBatchSubscribe(i){i.length&&i.forEach(r=>{this.setSubscription(r.id,js({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(i,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,i)&&this.deleteSubscription(r,n),await this.relayer.messages.del(i)}async setRelayerSubscriptions(i){await this.relayer.core.storage.setItem(this.storageKey,i)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(i,r){this.subscriptions.has(i)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:i,subscription:r}),this.addSubscription(i,r))}addSubscription(i,r){this.subscriptions.set(i,js({},r)),this.topicMap.set(r.topic,i),this.events.emit(Ur.created,r)}getSubscription(i){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:i});const r=this.subscriptions.get(i);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return r}deleteSubscription(i,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:i,reason:r});const n=this.getSubscription(i);this.subscriptions.delete(i),this.topicMap.delete(n.topic,i),this.events.emit(Ur.deleted,ko(js({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ur.sync)}async reset(){if(this.cached.length){const i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<i;r++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Ur.resubscribed)}async restore(){try{const i=await this.getRelayerSubscriptions();if(typeof i>"u"||!i.length)return;if(this.subscriptions.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(i){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(i)}}async batchSubscribe(i){if(!i.length)return;const r=await this.rpcBatchSubscribe(i);us(r)&&this.onBatchSubscribe(r.map((n,a)=>ko(js({},i[a]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const i=[];this.pending.forEach(r=>{i.push(r)}),await this.batchSubscribe(i)}registerEventListeners(){this.relayer.core.heartbeat.on(hs.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(yt.connect,async()=>{await this.onConnect()}),this.relayer.on(yt.disconnect,()=>{this.onDisconnect()}),this.events.on(Ur.created,async i=>{const r=Ur.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()}),this.events.on(Ur.deleted,async i=>{const r=Ur.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}async restartToComplete(){this.restartInProgress&&await new Promise(i=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),i())},this.pollingInterval)})}}var Pw=Object.defineProperty,Yh=Object.getOwnPropertySymbols,Cw=Object.prototype.hasOwnProperty,Aw=Object.prototype.propertyIsEnumerable,Zh=(h,i,r)=>i in h?Pw(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,Ow=(h,i)=>{for(var r in i||(i={}))Cw.call(i,r)&&Zh(h,r,i[r]);if(Yh)for(var r of Yh(i))Aw.call(i,r)&&Zh(h,r,i[r]);return h};class Tw extends K1{constructor(i){super(i),this.protocol="wc",this.version=2,this.events=new kr.EventEmitter,this.name=Q_,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.core=i.core,this.logger=typeof i.logger<"u"&&typeof i.logger!="string"?Ae.generateChildLogger(i.logger,this.name):Ae.pino(Ae.getDefaultLoggerOptions({level:i.logger||X_})),this.messages=new yw(this.logger,i.core),this.subscriber=new Sw(this,this.logger),this.publisher=new mw(this,this.logger),this.relayUrl=(i==null?void 0:i.relayUrl)||Gl,this.projectId=i.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Bh}...`),await this.restartTransport(Bh)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},iw)}get context(){return Ae.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(i,r,n){this.isInitialized(),await this.publisher.publish(i,r,n),await this.recordMessageEvent({topic:i,message:r,publishedAt:Date.now()})}async subscribe(i,r){var n;this.isInitialized();let a=((n=this.subscriber.topicMap.get(i))==null?void 0:n[0])||"";return a||(await Promise.all([new Promise(l=>{this.subscriber.once(Ur.created,g=>{g.topic===i&&l()})}),new Promise(async l=>{a=await this.subscriber.subscribe(i,r),l()})]),a)}async unsubscribe(i,r){this.isInitialized(),await this.subscriber.unsubscribe(i,r)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(yt.transport_closed))}async transportOpen(i){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=i||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(Ur.resubscribed,()=>{r()})}),await Promise.race([new Promise(async(r,n)=>{await ea(this.provider.connect(),5e3,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>n(a)).then(()=>r()).finally(()=>this.removeListener(yt.transport_closed,this.rejectTransportOpen))}),new Promise(r=>this.once(yt.transport_closed,this.rejectTransportOpen))])])}catch(r){this.logger.error(r);const n=r;if(!this.isConnectionStalled(n.message))throw r;this.events.emit(yt.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(i){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=i||this.relayUrl,this.connected&&await Promise.all([new Promise(r=>{this.provider.once($s.disconnect,()=>{r()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(i){return this.staleConnectionErrors.some(r=>i.includes(r))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const i=await this.core.crypto.signJWT(this.relayUrl);this.provider=new yi(new dm(Wy({sdkVersion:rw,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:i,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(i){const{topic:r,message:n}=i;await this.messages.set(r,n)}async shouldIgnoreMessageEvent(i){const{topic:r,message:n}=i;return await this.subscriber.isSubscribed(r)?this.messages.has(r,n):!0}async onProviderPayload(i){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:i}),ac(i)){if(!i.method.endsWith(ew))return;const r=i.params,{topic:n,message:a,publishedAt:l}=r.data,g={topic:n,message:a,publishedAt:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Ow({type:"event",event:r.id},g)),this.events.emit(r.id,g),await this.acknowledgePayload(i),await this.onMessageEvent(g)}else oc(i)&&this.events.emit(yt.message_ack,i)}async onMessageEvent(i){await this.shouldIgnoreMessageEvent(i)||(this.events.emit(yt.message,i),await this.recordMessageEvent(i))}async acknowledgePayload(i){const r=cc(i.id,!0);await this.provider.connection.send(r)}registerProviderListeners(){this.provider.on($s.payload,i=>this.onProviderPayload(i)),this.provider.on($s.connect,()=>{this.events.emit(yt.connect)}),this.provider.on($s.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on($s.error,i=>{this.logger.error(i),this.events.emit(yt.error,i)})}registerEventListeners(){this.events.on(yt.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(yt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},ie.toMiliseconds(tw))}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(i=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),i())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Rw=Object.defineProperty,Xh=Object.getOwnPropertySymbols,Nw=Object.prototype.hasOwnProperty,Fw=Object.prototype.propertyIsEnumerable,Qh=(h,i,r)=>i in h?Rw(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,el=(h,i)=>{for(var r in i||(i={}))Nw.call(i,r)&&Qh(h,r,i[r]);if(Xh)for(var r of Xh(i))Fw.call(i,r)&&Qh(h,r,i[r]);return h};class oa extends V1{constructor(i,r,n,a=vi,l=void 0){super(i,r,n,a),this.core=i,this.logger=r,this.name=n,this.map=new Map,this.version=sw,this.cached=[],this.initialized=!1,this.storagePrefix=vi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(g=>{this.getKey&&g!==null&&!gi(g)?this.map.set(this.getKey(g),g):jy(g)?this.map.set(g.id,g):My(g)&&this.map.set(g.topic,g)}),this.cached=[],this.initialized=!0)},this.set=async(g,y)=>{this.isInitialized(),this.map.has(g)?await this.update(g,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:g,value:y}),this.map.set(g,y),await this.persist())},this.get=g=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:g}),this.getData(g)),this.getAll=g=>(this.isInitialized(),g?this.values.filter(y=>Object.keys(g).every(_=>vm(y[_],g[_]))):this.values),this.update=async(g,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:g,update:y});const _=el(el({},this.getData(g)),y);this.map.set(g,_),await this.persist()},this.delete=async(g,y)=>{this.isInitialized(),this.map.has(g)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:g,reason:y}),this.map.delete(g),await this.persist())},this.logger=Ae.generateChildLogger(r,this.name),this.storagePrefix=a,this.getKey=l}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(i){await this.core.storage.setItem(this.storageKey,i)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(i){const r=this.map.get(i);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const i=await this.getDataStore();if(typeof i>"u"||!i.length)return;if(this.map.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(i){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(i)}}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Dw{constructor(i,r){this.core=i,this.logger=r,this.name=uw,this.version=hw,this.events=new uc,this.initialized=!1,this.storagePrefix=vi,this.ignoredPayloadTypes=[ml],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=Jo(),a=await this.core.crypto.setSymKey(n),l=Nr(ie.FIVE_MINUTES),g={protocol:Bl},y={topic:a,expiry:l,relay:g,active:!1},_=Jy({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:n,relay:g});return await this.pairings.set(a,y),await this.core.relayer.subscribe(a),this.core.expirer.set(a,l),{topic:a,uri:_}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:a,symKey:l,relay:g}=Yy(n.uri);if(this.pairings.keys.includes(a))throw new Error(`Pairing already exists: ${a}`);if(this.core.crypto.hasKeys(a))throw new Error(`Keychain already exists: ${a}`);const y=Nr(ie.FIVE_MINUTES),_={topic:a,relay:g,expiry:y,active:!1};return await this.pairings.set(a,_),await this.core.crypto.setSymKey(l,a),await this.core.relayer.subscribe(a,{relay:g}),this.core.expirer.set(a,y),n.activatePairing&&await this.activate({topic:a}),_},this.activate=async({topic:n})=>{this.isInitialized();const a=Nr(ie.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:a}),this.core.expirer.set(n,a)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:a}=n;if(this.pairings.keys.includes(a)){const l=await this.sendRequest(a,"wc_pairingPing",{}),{done:g,resolve:y,reject:_}=ns();this.events.once(Dt("pairing_ping",l),({error:S})=>{S?_(S):y()}),await g()}},this.updateExpiry=async({topic:n,expiry:a})=>{this.isInitialized(),await this.pairings.update(n,{expiry:a})},this.updateMetadata=async({topic:n,metadata:a})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:a}=n;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",er("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(n,a,l)=>{const g=hc(a,l),y=await this.core.crypto.encode(n,g),_=Ls[a].req;return this.core.history.set(n,g),this.core.relayer.publish(n,y,_),g.id},this.sendResult=async(n,a,l)=>{const g=cc(n,l),y=await this.core.crypto.encode(a,g),_=await this.core.history.get(a,n),S=Ls[_.request.method].res;await this.core.relayer.publish(a,y,S),await this.core.history.resolve(g)},this.sendError=async(n,a,l)=>{const g=nc(n,l),y=await this.core.crypto.encode(a,g),_=await this.core.history.get(a,n),S=Ls[_.request.method]?Ls[_.request.method].res:Ls.unregistered_method.res;await this.core.relayer.publish(a,y,S),await this.core.history.resolve(g)},this.deletePairing=async(n,a)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,er("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),a?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(a=>di(a.expiry));await Promise.all(n.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=n=>{const{topic:a,payload:l}=n,g=l.method;if(this.pairings.keys.includes(a))switch(g){case"wc_pairingPing":return this.onPairingPingRequest(a,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,l);default:return this.onUnknownRpcMethodRequest(a,l)}},this.onRelayEventResponse=async n=>{const{topic:a,payload:l}=n,g=(await this.core.history.get(a,l.id)).request.method;if(this.pairings.keys.includes(a))switch(g){case"wc_pairingPing":return this.onPairingPingResponse(a,l);default:return this.onUnknownRpcMethodResponse(g)}},this.onPairingPingRequest=async(n,a)=>{const{id:l}=a;try{this.isValidPing({topic:n}),await this.sendResult(l,n,!0),this.events.emit("pairing_ping",{id:l,topic:n})}catch(g){await this.sendError(l,n,g),this.logger.error(g)}},this.onPairingPingResponse=(n,a)=>{const{id:l}=a;setTimeout(()=>{pi(a)?this.events.emit(Dt("pairing_ping",l),{}):ti(a)&&this.events.emit(Dt("pairing_ping",l),{error:a.error})},500)},this.onPairingDeleteRequest=async(n,a)=>{const{id:l}=a;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit("pairing_delete",{id:l,topic:n})}catch(g){await this.sendError(l,n,g),this.logger.error(g)}},this.onUnknownRpcMethodRequest=async(n,a)=>{const{id:l,method:g}=a;try{if(this.registeredMethods.includes(g))return;const y=er("WC_METHOD_UNSUPPORTED",g);await this.sendError(l,n,y),this.logger.error(y)}catch(y){await this.sendError(l,n,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(er("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!or(n)){const{message:a}=X("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(a)}if(!Zy(n.uri)){const{message:a}=X("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(a)}},this.isValidPing=async n=>{if(!or(n)){const{message:l}=X("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(l)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidDisconnect=async n=>{if(!or(n)){const{message:l}=X("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(l)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async n=>{if(!as(n,!1)){const{message:a}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(a)}if(!this.pairings.keys.includes(n)){const{message:a}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(a)}if(di(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:a}=X("EXPIRED",`pairing topic: ${n}`);throw new Error(a)}},this.core=i,this.logger=Ae.generateChildLogger(r,this.name),this.pairings=new oa(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ae.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.core.relayer.on(yt.message,async i=>{const{topic:r,message:n}=i;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const a=await this.core.crypto.decode(r,n);ac(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):oc(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))})}registerExpirerEvents(){this.core.expirer.on(Ir.expired,async i=>{const{topic:r}=_l(i.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class $w extends U1{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.records=new Map,this.events=new kr.EventEmitter,this.name=lw,this.version=fw,this.cached=[],this.initialized=!1,this.storagePrefix=vi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,a,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:a,chainId:l}),this.records.has(a.id))return;const g={id:a.id,topic:n,request:{method:a.method,params:a.params||null},chainId:l,expiry:Nr(ie.THIRTY_DAYS)};this.records.set(g.id,g),this.events.emit(qr.created,g)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const a=await this.getRecord(n.id);typeof a.response>"u"&&(a.response=ti(n)?{error:n.error}:{result:n.result},this.records.set(a.id,a),this.events.emit(qr.updated,a))},this.get=async(n,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:a}),await this.getRecord(a)),this.delete=(n,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(l=>{if(l.topic===n){if(typeof a<"u"&&l.id!==a)return;this.records.delete(l.id),this.events.emit(qr.deleted,l)}})},this.exists=async(n,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===n:!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ae.generateChildLogger(r,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:hc(r.request.method,r.request.params,r.id),chainId:r.chainId};return i.push(n)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const r=this.records.get(i);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(qr.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>"u"||!i.length)return;if(this.records.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(qr.created,i=>{const r=qr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(qr.updated,i=>{const r=qr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(qr.deleted,i=>{const r=qr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.core.heartbeat.on(hs.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(i=>{ie.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.delete(i.topic,i.id))})}catch(i){this.logger.warn(i)}}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class Lw extends G1{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.expirations=new Map,this.events=new kr.EventEmitter,this.name=pw,this.version=dw,this.cached=[],this.initialized=!1,this.storagePrefix=vi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const a=this.formatTarget(n);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(n,a)=>{this.isInitialized();const l=this.formatTarget(n),g={target:l,expiry:a};this.expirations.set(l,g),this.checkExpiry(l,g),this.events.emit(Ir.created,{target:l,expiration:g})},this.get=n=>{this.isInitialized();const a=this.formatTarget(n);return this.getExpiration(a)},this.del=n=>{if(this.isInitialized(),this.has(n)){const a=this.formatTarget(n),l=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Ir.deleted,{target:a,expiration:l})}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=Ae.generateChildLogger(r,this.name)}get context(){return Ae.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i=="string")return Xy(i);if(typeof i=="number")return Qy(i);const{message:r}=X("UNKNOWN_TYPE",`Target type: ${typeof i}`);throw new Error(r)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ir.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>"u"||!i.length)return;if(this.expirations.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const r=this.expirations.get(i);if(!r){const{message:n}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(n),new Error(n)}return r}checkExpiry(i,r){const{expiry:n}=r;ie.toMiliseconds(n)-Date.now()<=0&&this.expire(i,r)}expire(i,r){this.expirations.delete(i),this.events.emit(Ir.expired,{target:i,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((i,r)=>this.checkExpiry(r,i))}registerEventListeners(){this.core.heartbeat.on(hs.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Ir.created,i=>{const r=Ir.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(Ir.expired,i=>{const r=Ir.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(Ir.deleted,i=>{const r=Ir.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class jw extends W1{constructor(i,r){super(i,r),this.projectId=i,this.logger=r,this.name=Uo,this.initialized=!1,this.init=async n=>{e1()||!wl()||(this.verifyUrl=(n==null?void 0:n.verifyUrl)||Gh,await this.createIframe())},this.register=async n=>{var a;if(this.initialized||await this.init(),!!this.iframe)try{(a=this.iframe.contentWindow)==null||a.postMessage(n.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${n.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async n=>{var a;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${n.attestationId}`);const l=this.startAbortTimer(ie.FIVE_SECONDS),g=await fetch(`${this.verifyUrl}/attestation/${n.attestationId}`,{signal:this.abortController.signal});return clearTimeout(l),g.status===200?(a=await g.json())==null?void 0:a.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((n,a)=>{if(document.getElementById(Uo))return n();const l=document.createElement("iframe");l.setAttribute("id",Uo),l.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),l.style.display="none",l.addEventListener("load",()=>{this.initialized=!0,n()}),l.addEventListener("error",g=>{a(g)}),document.body.append(l),this.iframe=l}),new Promise(n=>{setTimeout(()=>n("iframe load timeout"),ie.toMiliseconds(ie.ONE_SECOND/2))})])}catch(n){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(n)}},this.logger=Ae.generateChildLogger(r,this.name),this.verifyUrl=Gh,this.abortController=new AbortController,this.isDevEnv=t1()&&{}.IS_VITEST}get context(){return Ae.getLoggerContext(this.logger)}startAbortTimer(i){return setTimeout(()=>this.abortController.abort(),ie.toMiliseconds(i))}}var Mw=Object.defineProperty,tl=Object.getOwnPropertySymbols,zw=Object.prototype.hasOwnProperty,qw=Object.prototype.propertyIsEnumerable,rl=(h,i,r)=>i in h?Mw(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,il=(h,i)=>{for(var r in i||(i={}))zw.call(i,r)&&rl(h,r,i[r]);if(tl)for(var r of tl(i))qw.call(i,r)&&rl(h,r,i[r]);return h};class pc extends q1{constructor(i){super(i),this.protocol=Vl,this.version=U_,this.name=fc,this.events=new kr.EventEmitter,this.initialized=!1,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.projectId=i==null?void 0:i.projectId,this.relayUrl=(i==null?void 0:i.relayUrl)||Gl;const r=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||k_.logger}));this.logger=Ae.generateChildLogger(r,this.name),this.heartbeat=new hs.HeartBeat,this.crypto=new vw(this,this.logger,i==null?void 0:i.keychain),this.history=new $w(this,this.logger),this.expirer=new Lw(this,this.logger),this.storage=i!=null&&i.storage?i.storage:new R1(il(il({},H_),i==null?void 0:i.storageOptions)),this.relayer=new Tw({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Dw(this,this.logger),this.verify=new jw(this.projectId||"",this.logger)}static async init(i){const r=new pc(i);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(nw,n),r}get context(){return Ae.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(i){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,i),this.logger.error(i.message),i}}}const Uw=pc,Wl="wc",Jl=2,Yl="client",dc=`${Wl}@${Jl}:${Yl}:`,Ho={name:Yl,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},kw="WALLETCONNECT_DEEPLINK_CHOICE",Hw="proposal",Zl="Proposal expired",Kw="session",Wn=ie.SEVEN_DAYS,Vw="engine",Ms={wc_sessionPropose:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ko={min:ie.FIVE_MINUTES,max:ie.SEVEN_DAYS},Bw="request",Gw=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var Ww=Object.defineProperty,Jw=Object.defineProperties,Yw=Object.getOwnPropertyDescriptors,sl=Object.getOwnPropertySymbols,Zw=Object.prototype.hasOwnProperty,Xw=Object.prototype.propertyIsEnumerable,nl=(h,i,r)=>i in h?Ww(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,xr=(h,i)=>{for(var r in i||(i={}))Zw.call(i,r)&&nl(h,r,i[r]);if(sl)for(var r of sl(i))Xw.call(i,r)&&nl(h,r,i[r]);return h},Vo=(h,i)=>Jw(h,Yw(i));class Qw extends Y1{constructor(i){super(i),this.name=Vw,this.events=new uc,this.initialized=!1,this.ignoredPayloadTypes=[ml],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(Ms)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized();const n=Vo(xr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:a,requiredNamespaces:l,optionalNamespaces:g,sessionProperties:y,relays:_}=n;let S=a,$,G=!1;if(S&&(G=this.client.core.pairing.pairings.get(S).active),!S||!G){const{topic:pe,uri:ue}=await this.client.core.pairing.create();S=pe,$=ue}const W=await this.client.core.crypto.generateKeyPair(),V=xr({requiredNamespaces:l,optionalNamespaces:g,relays:_??[{protocol:Bl}],proposer:{publicKey:W,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:q,resolve:K,done:ae}=ns(ie.FIVE_MINUTES,Zl);if(this.events.once(Dt("session_connect"),async({error:pe,session:ue})=>{if(pe)q(pe);else if(ue){ue.self.publicKey=W;const he=Vo(xr({},ue),{requiredNamespaces:ue.requiredNamespaces,optionalNamespaces:ue.optionalNamespaces});await this.client.session.set(ue.topic,he),await this.setExpiry(ue.topic,ue.expiry),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:ue.peer.metadata}),K(he)}}),!S){const{message:pe}=X("NO_MATCHING_KEY",`connect() pairing topic: ${S}`);throw new Error(pe)}const be=await this.sendRequest(S,"wc_sessionPropose",V),de=Nr(ie.FIVE_MINUTES);return await this.setProposal(be,xr({id:be,expiry:de},V)),{uri:$,approval:ae}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:n,relayProtocol:a,namespaces:l,sessionProperties:g}=r,y=this.client.proposal.get(n);let{pairingTopic:_,proposer:S,requiredNamespaces:$,optionalNamespaces:G}=y;_=_||"",Xn($)||($=i1(l,"approve()"));const W=await this.client.core.crypto.generateKeyPair(),V=S.publicKey,q=await this.client.core.crypto.generateSharedKey(W,V);_&&n&&(await this.client.core.pairing.updateMetadata({topic:_,metadata:S.metadata}),await this.sendResult(n,_,{relay:{protocol:a??"irn"},responderPublicKey:W}),await this.client.proposal.delete(n,er("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:_}));const K=xr({relay:{protocol:a??"irn"},namespaces:l,requiredNamespaces:$,optionalNamespaces:G,pairingTopic:_,controller:{publicKey:W,metadata:this.client.metadata},expiry:Nr(Wn)},g&&{sessionProperties:g});await this.client.core.relayer.subscribe(q),await this.sendRequest(q,"wc_sessionSettle",K);const ae=Vo(xr({},K),{topic:q,pairingTopic:_,acknowledged:!1,self:K.controller,peer:{publicKey:S.publicKey,metadata:S.metadata},controller:W});return await this.client.session.set(q,ae),await this.setExpiry(q,Nr(Wn)),{topic:q,acknowledged:()=>new Promise(be=>setTimeout(()=>be(this.client.session.get(q)),500))}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:n,reason:a}=r,{pairingTopic:l}=this.client.proposal.get(n);l&&(await this.sendError(n,l,a),await this.client.proposal.delete(n,er("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:n,namespaces:a}=r,l=await this.sendRequest(n,"wc_sessionUpdate",{namespaces:a}),{done:g,resolve:y,reject:_}=ns();return this.events.once(Dt("session_update",l),({error:S})=>{S?_(S):y()}),await this.client.session.update(n,{namespaces:a}),{acknowledged:g}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:n}=r,a=await this.sendRequest(n,"wc_sessionExtend",{}),{done:l,resolve:g,reject:y}=ns();return this.events.once(Dt("session_extend",a),({error:_})=>{_?y(_):g()}),await this.setExpiry(n,Nr(Wn)),{acknowledged:l}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:n,request:a,topic:l,expiry:g}=r,y=await this.sendRequest(l,"wc_sessionRequest",{request:a,chainId:n},g),{done:_,resolve:S,reject:$}=ns(g);this.events.once(Dt("session_request",y),({error:W,result:V})=>{W?$(W):S(V)}),this.client.events.emit("session_request_sent",{topic:l,request:a,chainId:n,id:y});const G=await this.client.core.storage.getItem(kw);return s1({id:y,topic:l,wcDeepLink:G}),await _()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:n,response:a}=r,{id:l}=a;pi(a)?await this.sendResult(l,n,a.result):ti(a)&&await this.sendError(l,n,a.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const a=await this.sendRequest(n,"wc_sessionPing",{}),{done:l,resolve:g,reject:y}=ns();this.events.once(Dt("session_ping",a),({error:_})=>{_?y(_):g()}),await l()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:n,event:a,chainId:l}=r;await this.sendRequest(n,"wc_sessionEvent",{event:a,chainId:l})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:n}=r;if(this.client.session.keys.includes(n)){const a=Sl().toString();let l;const g=y=>{(y==null?void 0:y.id.toString())===a&&(this.client.core.relayer.events.removeListener(yt.message_ack,g),l())};await Promise.all([new Promise(y=>{l=y,this.client.core.relayer.on(yt.message_ack,g)}),this.sendRequest(n,"wc_sessionDelete",er("USER_DISCONNECTED"),void 0,a)]),await this.deleteSession(n)}else await this.client.core.pairing.disconnect({topic:n})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(n=>n1(n,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const n=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(l=>{var g,y;return((g=l.peerMetadata)==null?void 0:g.url)&&((y=l.peerMetadata)==null?void 0:y.url)===r.peer.metadata.url&&l.topic&&l.topic!==n.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(r,n)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,er("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),n||this.client.core.expirer.del(r)},this.deleteProposal=async(r,n)=>{await Promise.all([this.client.proposal.delete(r,er("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,n,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,n),a?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,n)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:n}),this.client.core.expirer.set(r,n)},this.setProposal=async(r,n)=>{await this.client.proposal.set(r,n),this.client.core.expirer.set(r,n.expiry)},this.setPendingSessionRequest=async r=>{const n=Ms.wc_sessionRequest.req.ttl,{id:a,topic:l,params:g}=r;await this.client.pendingRequest.set(a,{id:a,topic:l,params:g}),n&&this.client.core.expirer.set(a,Nr(n))},this.sendRequest=async(r,n,a,l,g)=>{const y=hc(n,a);if(wl()&&Gw.includes(n)){const $=cs(JSON.stringify(y));await this.client.core.verify.register({attestationId:$})}const _=await this.client.core.crypto.encode(r,y),S=Ms[n].req;return l&&(S.ttl=l),g&&(S.id=g),this.client.core.history.set(r,y),this.client.core.relayer.publish(r,_,S),y.id},this.sendResult=async(r,n,a)=>{const l=cc(r,a),g=await this.client.core.crypto.encode(n,l),y=await this.client.core.history.get(n,r),_=Ms[y.request.method].res;this.client.core.relayer.publish(n,g,_),await this.client.core.history.resolve(l)},this.sendError=async(r,n,a)=>{const l=nc(r,a),g=await this.client.core.crypto.encode(n,l),y=await this.client.core.history.get(n,r),_=Ms[y.request.method].res;this.client.core.relayer.publish(n,g,_),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const r=[],n=[];this.client.session.getAll().forEach(a=>{di(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{di(a.expiry)&&n.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...n.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=r=>{const{topic:n,payload:a}=r,l=a.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(n,a);case"wc_sessionSettle":return this.onSessionSettleRequest(n,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,a);case"wc_sessionExtend":return this.onSessionExtendRequest(n,a);case"wc_sessionPing":return this.onSessionPingRequest(n,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,a);case"wc_sessionRequest":return this.onSessionRequest(n,a);case"wc_sessionEvent":return this.onSessionEventRequest(n,a);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async r=>{const{topic:n,payload:a}=r,l=(await this.client.core.history.get(n,a.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(n,a);case"wc_sessionSettle":return this.onSessionSettleResponse(n,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,a);case"wc_sessionExtend":return this.onSessionExtendResponse(n,a);case"wc_sessionPing":return this.onSessionPingResponse(n,a);case"wc_sessionRequest":return this.onSessionRequestResponse(n,a);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:n}=r,{message:a}=X("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,n)=>{const{params:a,id:l}=n;try{this.isValidConnect(xr({},n.params));const g=Nr(ie.FIVE_MINUTES),y=xr({id:l,pairingTopic:r,expiry:g},a);await this.setProposal(l,y);const _=cs(JSON.stringify(n)),S=await this.getVerifyContext(_,y.proposer.metadata);this.client.events.emit("session_proposal",{id:l,params:y,verifyContext:S})}catch(g){await this.sendError(l,r,g),this.client.logger.error(g)}},this.onSessionProposeResponse=async(r,n)=>{const{id:a}=n;if(pi(n)){const{result:l}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const g=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:g});const y=g.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const _=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:_});const S=await this.client.core.crypto.generateSharedKey(y,_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:S});const $=await this.client.core.relayer.subscribe(S);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:$}),await this.client.core.pairing.activate({topic:r})}else ti(n)&&(await this.client.proposal.delete(a,er("USER_DISCONNECTED")),this.events.emit(Dt("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(r,n)=>{const{id:a,params:l}=n;try{this.isValidSessionSettleRequest(l);const{relay:g,controller:y,expiry:_,namespaces:S,requiredNamespaces:$,optionalNamespaces:G,sessionProperties:W,pairingTopic:V}=n.params,q=xr({topic:r,relay:g,expiry:_,namespaces:S,acknowledged:!0,pairingTopic:V,requiredNamespaces:$,optionalNamespaces:G,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},W&&{sessionProperties:W});await this.sendResult(n.id,r,!0),this.events.emit(Dt("session_connect"),{session:q}),this.cleanupDuplicatePairings(q)}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.onSessionSettleResponse=async(r,n)=>{const{id:a}=n;pi(n)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Dt("session_approve",a),{})):ti(n)&&(await this.client.session.delete(r,er("USER_DISCONNECTED")),this.events.emit(Dt("session_approve",a),{error:n.error}))},this.onSessionUpdateRequest=async(r,n)=>{const{params:a,id:l}=n;try{this.isValidUpdate(xr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult(l,r,!0),this.client.events.emit("session_update",{id:l,topic:r,params:a})}catch(g){await this.sendError(l,r,g),this.client.logger.error(g)}},this.onSessionUpdateResponse=(r,n)=>{const{id:a}=n;pi(n)?this.events.emit(Dt("session_update",a),{}):ti(n)&&this.events.emit(Dt("session_update",a),{error:n.error})},this.onSessionExtendRequest=async(r,n)=>{const{id:a}=n;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Nr(Wn)),await this.sendResult(a,r,!0),this.client.events.emit("session_extend",{id:a,topic:r})}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(r,n)=>{const{id:a}=n;pi(n)?this.events.emit(Dt("session_extend",a),{}):ti(n)&&this.events.emit(Dt("session_extend",a),{error:n.error})},this.onSessionPingRequest=async(r,n)=>{const{id:a}=n;try{this.isValidPing({topic:r}),await this.sendResult(a,r,!0),this.client.events.emit("session_ping",{id:a,topic:r})}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionPingResponse=(r,n)=>{const{id:a}=n;setTimeout(()=>{pi(n)?this.events.emit(Dt("session_ping",a),{}):ti(n)&&this.events.emit(Dt("session_ping",a),{error:n.error})},500)},this.onSessionDeleteRequest=async(r,n)=>{const{id:a}=n;try{this.isValidDisconnect({topic:r,reason:n.params}),await Promise.all([new Promise(l=>{this.client.core.relayer.once(yt.publish,async()=>{l(await this.deleteSession(r))})}),this.sendResult(a,r,!0)]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(l){this.client.logger.error(l)}},this.onSessionRequest=async(r,n)=>{const{id:a,params:l}=n;try{this.isValidRequest(xr({topic:r},l)),await this.setPendingSessionRequest({id:a,topic:r,params:l});const g=cs(JSON.stringify(n)),y=this.client.session.get(r),_=await this.getVerifyContext(g,y.peer.metadata);this.client.events.emit("session_request",{id:a,topic:r,params:l,verifyContext:_})}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.onSessionRequestResponse=(r,n)=>{const{id:a}=n;pi(n)?this.events.emit(Dt("session_request",a),{result:n.result}):ti(n)&&this.events.emit(Dt("session_request",a),{error:n.error})},this.onSessionEventRequest=async(r,n)=>{const{id:a,params:l}=n;try{this.isValidEmit(xr({topic:r},l)),this.client.events.emit("session_event",{id:a,topic:r,params:l})}catch(g){await this.sendError(a,r,g),this.client.logger.error(g)}},this.isValidConnect=async r=>{if(!or(r)){const{message:_}=X("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(_)}const{pairingTopic:n,requiredNamespaces:a,optionalNamespaces:l,sessionProperties:g,relays:y}=r;if(gi(n)||await this.isValidPairingTopic(n),!a1(y,!0)){const{message:_}=X("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(_)}!gi(a)&&Xn(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!gi(l)&&Xn(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),gi(g)||this.validateSessionProps(g,"sessionProperties")},this.validateNamespaces=(r,n)=>{const a=o1(r,"connect()",n);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!or(r))throw new Error(X("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:n,namespaces:a,relayProtocol:l,sessionProperties:g}=r;await this.isValidProposalId(n);const y=this.client.proposal.get(n),_=Fo(a,"approve()");if(_)throw new Error(_.message);const S=mh(y.requiredNamespaces,a,"approve()");if(S)throw new Error(S.message);if(!as(l,!0)){const{message:$}=X("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error($)}gi(g)||this.validateSessionProps(g,"sessionProperties")},this.isValidReject=async r=>{if(!or(r)){const{message:l}=X("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(l)}const{id:n,reason:a}=r;if(await this.isValidProposalId(n),!c1(a)){const{message:l}=X("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidSessionSettleRequest=r=>{if(!or(r)){const{message:S}=X("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(S)}const{relay:n,controller:a,namespaces:l,expiry:g}=r;if(!u1(n)){const{message:S}=X("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(S)}const y=h1(a,"onSessionSettleRequest()");if(y)throw new Error(y.message);const _=Fo(l,"onSessionSettleRequest()");if(_)throw new Error(_.message);if(di(g)){const{message:S}=X("EXPIRED","onSessionSettleRequest()");throw new Error(S)}},this.isValidUpdate=async r=>{if(!or(r)){const{message:_}=X("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(_)}const{topic:n,namespaces:a}=r;await this.isValidSessionTopic(n);const l=this.client.session.get(n),g=Fo(a,"update()");if(g)throw new Error(g.message);const y=mh(l.requiredNamespaces,a,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async r=>{if(!or(r)){const{message:a}=X("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:n}=r;await this.isValidSessionTopic(n)},this.isValidRequest=async r=>{if(!or(r)){const{message:_}=X("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(_)}const{topic:n,request:a,chainId:l,expiry:g}=r;await this.isValidSessionTopic(n);const{namespaces:y}=this.client.session.get(n);if(!_h(y,l)){const{message:_}=X("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(_)}if(!l1(a)){const{message:_}=X("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(_)}if(!f1(y,l,a.method)){const{message:_}=X("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(_)}if(g&&!p1(g,Ko)){const{message:_}=X("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${Ko.min} and ${Ko.max}`);throw new Error(_)}},this.isValidRespond=async r=>{if(!or(r)){const{message:l}=X("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:n,response:a}=r;if(await this.isValidSessionTopic(n),!d1(a)){const{message:l}=X("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!or(r)){const{message:a}=X("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async r=>{if(!or(r)){const{message:y}=X("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(y)}const{topic:n,event:a,chainId:l}=r;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!_h(g,l)){const{message:y}=X("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(y)}if(!g1(a)){const{message:y}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}if(!v1(g,l,a.name)){const{message:y}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}},this.isValidDisconnect=async r=>{if(!or(r)){const{message:a}=X("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:n}=r;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(r,n)=>{const a={verified:{verifyUrl:n.verifyUrl||"",validation:"UNKNOWN",origin:n.url||""}};try{const l=await this.client.core.verify.resolve({attestationId:r,verifyUrl:n.verifyUrl});l&&(a.verified.origin=l,a.verified.validation=l===n.url?"VALID":"INVALID")}catch(l){this.client.logger.error(l)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,n)=>{Object.values(r).forEach(a=>{if(!as(a,!1)){const{message:l}=X("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(l)}})}}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.client.core.relayer.on(yt.message,async i=>{const{topic:r,message:n}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const a=await this.client.core.crypto.decode(r,n);ac(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):oc(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})})}registerExpirerEvents(){this.client.core.expirer.on(Ir.expired,async i=>{const{topic:r,id:n}=_l(i.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,X("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}isValidPairingTopic(i){if(!as(i,!1)){const{message:r}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:r}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(r)}if(di(this.client.core.pairing.pairings.get(i).expiry)){const{message:r}=X("EXPIRED",`pairing topic: ${i}`);throw new Error(r)}}async isValidSessionTopic(i){if(!as(i,!1)){const{message:r}=X("MISSING_OR_INVALID",`session topic should be a string: ${i}`);throw new Error(r)}if(!this.client.session.keys.includes(i)){const{message:r}=X("NO_MATCHING_KEY",`session topic doesn't exist: ${i}`);throw new Error(r)}if(di(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:r}=X("EXPIRED",`session topic: ${i}`);throw new Error(r)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(as(i,!1)){const{message:r}=X("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${i}`);throw new Error(r)}else{const{message:r}=X("MISSING_OR_INVALID",`session or pairing topic should be a string: ${i}`);throw new Error(r)}}async isValidProposalId(i){if(!y1(i)){const{message:r}=X("MISSING_OR_INVALID",`proposal id should be a number: ${i}`);throw new Error(r)}if(!this.client.proposal.keys.includes(i)){const{message:r}=X("NO_MATCHING_KEY",`proposal id doesn't exist: ${i}`);throw new Error(r)}if(di(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:r}=X("EXPIRED",`proposal id: ${i}`);throw new Error(r)}}}class eb extends oa{constructor(i,r){super(i,r,Hw,dc),this.core=i,this.logger=r}}class tb extends oa{constructor(i,r){super(i,r,Kw,dc),this.core=i,this.logger=r}}class rb extends oa{constructor(i,r){super(i,r,Bw,dc,n=>n.id),this.core=i,this.logger=r}}let ib=class Xl extends J1{constructor(i){super(i),this.protocol=Wl,this.version=Jl,this.name=Ho.name,this.events=new kr.EventEmitter,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(a){throw this.logger.error(a.message),a}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(a){throw this.logger.error(a.message),a}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(a){throw this.logger.error(a.message),a}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(a){throw this.logger.error(a.message),a}},this.update=async n=>{try{return await this.engine.update(n)}catch(a){throw this.logger.error(a.message),a}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(a){throw this.logger.error(a.message),a}},this.request=async n=>{try{return await this.engine.request(n)}catch(a){throw this.logger.error(a.message),a}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(a){throw this.logger.error(a.message),a}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(a){throw this.logger.error(a.message),a}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(a){throw this.logger.error(a.message),a}},this.find=n=>{try{return this.engine.find(n)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(i==null?void 0:i.name)||Ho.name,this.metadata=(i==null?void 0:i.metadata)||r1();const r=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||Ho.logger}));this.core=(i==null?void 0:i.core)||new Uw(i),this.logger=Ae.generateChildLogger(r,this.name),this.session=new tb(this.core,this.logger),this.proposal=new eb(this.core,this.logger),this.pendingRequest=new rb(this.core,this.logger),this.engine=new Qw(this)}static async init(i){const r=new Xl(i);return await r.initialize(),r}get context(){return Ae.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(i){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(i.message),i}}};const al="error",sb="wss://relay.walletconnect.com",nb="wc",ab="universal_provider",ol=`${nb}@2:${ab}:`,ob="https://rpc.walletconnect.com/v1",mi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var zs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Qo={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(h,i){(function(){var r,n="4.17.21",a=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",y="Invalid `variable` option passed into `_.template`",_="__lodash_hash_undefined__",S=500,$="__lodash_placeholder__",G=1,W=2,V=4,q=1,K=2,ae=1,be=2,de=4,pe=8,ue=16,he=32,T=64,M=128,B=256,ge=512,te=30,Ee="...",Oe=800,et=16,C=1,D=2,ze=3,Te=1/0,J=9007199254740991,U=17976931348623157e292,z=0/0,k=4294967295,ct=k-1,ke=k>>>1,Fr=[["ary",M],["bind",ae],["bindKey",be],["curry",pe],["curryRight",ue],["flip",ge],["partial",he],["partialRight",T],["rearg",B]],_e="[object Arguments]",It="[object Array]",O="[object AsyncFunction]",A="[object Boolean]",I="[object Date]",c="[object DOMException]",w="[object Error]",Q="[object Function]",oe="[object GeneratorFunction]",ye="[object Map]",Re="[object Number]",Fe="[object Null]",Ie="[object Object]",St="[object Promise]",mt="[object Proxy]",st="[object RegExp]",$e="[object Set]",Je="[object String]",Ye="[object Symbol]",nt="[object Undefined]",qe="[object WeakMap]",Ze="[object WeakSet]",Ne="[object ArrayBuffer]",He="[object DataView]",ut="[object Float32Array]",je="[object Float64Array]",Pt="[object Int8Array]",$t="[object Int16Array]",Ut="[object Int32Array]",kt="[object Uint8Array]",Mt="[object Uint8ClampedArray]",Gt="[object Uint16Array]",tr="[object Uint32Array]",Dr=/\b__p \+= '';/g,Wt=/\b(__p \+=) '' \+/g,Hr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ri=/&(?:amp|lt|gt|quot|#39);/g,_i=/[&<>"']/g,ht=RegExp(ri.source),tt=RegExp(_i.source),lt=/<%-([\s\S]+?)%>/g,ft=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ct=/^\w*$/,At=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pt=/[\\^$.*+?()[\]{}|]/g,Ot=RegExp(pt.source),dt=/^\s+/,_t=/\s/,gt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Tt=/,? & /,Rt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ca=/[()=,{}\[\]\/\s]/,ua=/\\(\\)?/g,ha=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,dr=/\w*$/,la=/^[-+]0x[0-9a-f]+$/i,fa=/^0b[01]+$/i,pa=/^\[object .+?Constructor\]$/,da=/^0o[0-7]+$/i,ga=/^(?:0|[1-9]\d*)$/,Kr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,zi=/($^)/,va=/['\n\r\u2028\u2029\\]/g,qi="\\ud800-\\udfff",ya="\\u0300-\\u036f",ma="\\ufe20-\\ufe2f",Ui="\\u20d0-\\u20ff",Hs=ya+ma+Ui,Ks="\\u2700-\\u27bf",Pr="a-z\\xdf-\\xf6\\xf8-\\xff",_a="\\xac\\xb1\\xd7\\xf7",wa="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ba="\\u2000-\\u206f",Ea=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Vs="A-Z\\xc0-\\xd6\\xd8-\\xde",Bs="\\ufe0e\\ufe0f",wi=_a+wa+ba+Ea,ls="['’]",bi="["+qi+"]",fs="["+wi+"]",Ei="["+Hs+"]",Gs="\\d+",xa="["+Ks+"]",Ws="["+Pr+"]",Js="[^"+qi+wi+Gs+Ks+Pr+Vs+"]",ki="\\ud83c[\\udffb-\\udfff]",Ia="(?:"+Ei+"|"+ki+")",Ys="[^"+qi+"]",Hi="(?:\\ud83c[\\udde6-\\uddff]){2}",ii="[\\ud800-\\udbff][\\udc00-\\udfff]",cr="["+Vs+"]",Zs="\\u200d",Xs="(?:"+Ws+"|"+Js+")",$r="(?:"+cr+"|"+Js+")",Qs="(?:"+ls+"(?:d|ll|m|re|s|t|ve))?",en="(?:"+ls+"(?:D|LL|M|RE|S|T|VE))?",tn=Ia+"?",rn="["+Bs+"]?",Sa="(?:"+Zs+"(?:"+[Ys,Hi,ii].join("|")+")"+rn+tn+")*",Vr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",sn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",nn=rn+tn+Sa,Ki="(?:"+[xa,Hi,ii].join("|")+")"+nn,Pa="(?:"+[Ys+Ei+"?",Ei,Hi,ii,bi].join("|")+")",ps=RegExp(ls,"g"),Ca=RegExp(Ei,"g"),Vi=RegExp(ki+"(?="+ki+")|"+Pa+nn,"g"),an=RegExp([cr+"?"+Ws+"+"+Qs+"(?="+[fs,cr,"$"].join("|")+")",$r+"+"+en+"(?="+[fs,cr+Xs,"$"].join("|")+")",cr+"?"+Xs+"+"+Qs,cr+"+"+en,sn,Vr,Gs,Ki].join("|"),"g"),on=RegExp("["+Zs+qi+Hs+Bs+"]"),xi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,cn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Aa=-1,Ke={};Ke[ut]=Ke[je]=Ke[Pt]=Ke[$t]=Ke[Ut]=Ke[kt]=Ke[Mt]=Ke[Gt]=Ke[tr]=!0,Ke[_e]=Ke[It]=Ke[Ne]=Ke[A]=Ke[He]=Ke[I]=Ke[w]=Ke[Q]=Ke[ye]=Ke[Re]=Ke[Ie]=Ke[st]=Ke[$e]=Ke[Je]=Ke[qe]=!1;var Ue={};Ue[_e]=Ue[It]=Ue[Ne]=Ue[He]=Ue[A]=Ue[I]=Ue[ut]=Ue[je]=Ue[Pt]=Ue[$t]=Ue[Ut]=Ue[ye]=Ue[Re]=Ue[Ie]=Ue[st]=Ue[$e]=Ue[Je]=Ue[Ye]=Ue[kt]=Ue[Mt]=Ue[Gt]=Ue[tr]=!0,Ue[w]=Ue[Q]=Ue[qe]=!1;var d={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},L={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Y={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,le=parseInt,Xe=typeof zs=="object"&&zs&&zs.Object===Object&&zs,Nt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Xe||Nt||Function("return this")(),Be=i&&!i.nodeType&&i,wt=Be&&!0&&h&&!h.nodeType&&h,rr=wt&&wt.exports===Be,Ft=rr&&Xe.process,Qe=function(){try{var E=wt&&wt.require&&wt.require("util").types;return E||Ft&&Ft.binding&&Ft.binding("util")}catch{}}(),Jt=Qe&&Qe.isArrayBuffer,Cr=Qe&&Qe.isDate,gr=Qe&&Qe.isMap,Lr=Qe&&Qe.isRegExp,ds=Qe&&Qe.isSet,Ii=Qe&&Qe.isTypedArray;function zt(E,R,P){switch(P.length){case 0:return E.call(R);case 1:return E.call(R,P[0]);case 2:return E.call(R,P[0],P[1]);case 3:return E.call(R,P[0],P[1],P[2])}return E.apply(R,P)}function tf(E,R,P,Z){for(var ce=-1,De=E==null?0:E.length;++ce<De;){var Lt=E[ce];R(Z,Lt,P(Lt),E)}return Z}function vr(E,R){for(var P=-1,Z=E==null?0:E.length;++P<Z&&R(E[P],P,E)!==!1;);return E}function rf(E,R){for(var P=E==null?0:E.length;P--&&R(E[P],P,E)!==!1;);return E}function yc(E,R){for(var P=-1,Z=E==null?0:E.length;++P<Z;)if(!R(E[P],P,E))return!1;return!0}function si(E,R){for(var P=-1,Z=E==null?0:E.length,ce=0,De=[];++P<Z;){var Lt=E[P];R(Lt,P,E)&&(De[ce++]=Lt)}return De}function un(E,R){var P=E==null?0:E.length;return!!P&&Bi(E,R,0)>-1}function Oa(E,R,P){for(var Z=-1,ce=E==null?0:E.length;++Z<ce;)if(P(R,E[Z]))return!0;return!1}function it(E,R){for(var P=-1,Z=E==null?0:E.length,ce=Array(Z);++P<Z;)ce[P]=R(E[P],P,E);return ce}function ni(E,R){for(var P=-1,Z=R.length,ce=E.length;++P<Z;)E[ce+P]=R[P];return E}function Ta(E,R,P,Z){var ce=-1,De=E==null?0:E.length;for(Z&&De&&(P=E[++ce]);++ce<De;)P=R(P,E[ce],ce,E);return P}function sf(E,R,P,Z){var ce=E==null?0:E.length;for(Z&&ce&&(P=E[--ce]);ce--;)P=R(P,E[ce],ce,E);return P}function Ra(E,R){for(var P=-1,Z=E==null?0:E.length;++P<Z;)if(R(E[P],P,E))return!0;return!1}var nf=Na("length");function af(E){return E.split("")}function of(E){return E.match(Rt)||[]}function mc(E,R,P){var Z;return P(E,function(ce,De,Lt){if(R(ce,De,Lt))return Z=De,!1}),Z}function hn(E,R,P,Z){for(var ce=E.length,De=P+(Z?1:-1);Z?De--:++De<ce;)if(R(E[De],De,E))return De;return-1}function Bi(E,R,P){return R===R?_f(E,R,P):hn(E,_c,P)}function cf(E,R,P,Z){for(var ce=P-1,De=E.length;++ce<De;)if(Z(E[ce],R))return ce;return-1}function _c(E){return E!==E}function wc(E,R){var P=E==null?0:E.length;return P?Da(E,R)/P:z}function Na(E){return function(R){return R==null?r:R[E]}}function Fa(E){return function(R){return E==null?r:E[R]}}function bc(E,R,P,Z,ce){return ce(E,function(De,Lt,Ge){P=Z?(Z=!1,De):R(P,De,Lt,Ge)}),P}function uf(E,R){var P=E.length;for(E.sort(R);P--;)E[P]=E[P].value;return E}function Da(E,R){for(var P,Z=-1,ce=E.length;++Z<ce;){var De=R(E[Z]);De!==r&&(P=P===r?De:P+De)}return P}function $a(E,R){for(var P=-1,Z=Array(E);++P<E;)Z[P]=R(P);return Z}function hf(E,R){return it(R,function(P){return[P,E[P]]})}function Ec(E){return E&&E.slice(0,Pc(E)+1).replace(dt,"")}function ur(E){return function(R){return E(R)}}function La(E,R){return it(R,function(P){return E[P]})}function gs(E,R){return E.has(R)}function xc(E,R){for(var P=-1,Z=E.length;++P<Z&&Bi(R,E[P],0)>-1;);return P}function Ic(E,R){for(var P=E.length;P--&&Bi(R,E[P],0)>-1;);return P}function lf(E,R){for(var P=E.length,Z=0;P--;)E[P]===R&&++Z;return Z}var ff=Fa(d),pf=Fa(b);function df(E){return"\\"+Y[E]}function gf(E,R){return E==null?r:E[R]}function Gi(E){return on.test(E)}function vf(E){return xi.test(E)}function yf(E){for(var R,P=[];!(R=E.next()).done;)P.push(R.value);return P}function ja(E){var R=-1,P=Array(E.size);return E.forEach(function(Z,ce){P[++R]=[ce,Z]}),P}function Sc(E,R){return function(P){return E(R(P))}}function ai(E,R){for(var P=-1,Z=E.length,ce=0,De=[];++P<Z;){var Lt=E[P];(Lt===R||Lt===$)&&(E[P]=$,De[ce++]=P)}return De}function ln(E){var R=-1,P=Array(E.size);return E.forEach(function(Z){P[++R]=Z}),P}function mf(E){var R=-1,P=Array(E.size);return E.forEach(function(Z){P[++R]=[Z,Z]}),P}function _f(E,R,P){for(var Z=P-1,ce=E.length;++Z<ce;)if(E[Z]===R)return Z;return-1}function wf(E,R,P){for(var Z=P+1;Z--;)if(E[Z]===R)return Z;return Z}function Wi(E){return Gi(E)?Ef(E):nf(E)}function Ar(E){return Gi(E)?xf(E):af(E)}function Pc(E){for(var R=E.length;R--&&_t.test(E.charAt(R)););return R}var bf=Fa(L);function Ef(E){for(var R=Vi.lastIndex=0;Vi.test(E);)++R;return R}function xf(E){return E.match(Vi)||[]}function If(E){return E.match(an)||[]}var Sf=function E(R){R=R==null?Pe:Ji.defaults(Pe.Object(),R,Ji.pick(Pe,cn));var P=R.Array,Z=R.Date,ce=R.Error,De=R.Function,Lt=R.Math,Ge=R.Object,Ma=R.RegExp,Pf=R.String,yr=R.TypeError,fn=P.prototype,Cf=De.prototype,Yi=Ge.prototype,pn=R["__core-js_shared__"],dn=Cf.toString,Me=Yi.hasOwnProperty,Af=0,Cc=function(){var e=/[^.]+$/.exec(pn&&pn.keys&&pn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),gn=Yi.toString,Of=dn.call(Ge),Tf=Pe._,Rf=Ma("^"+dn.call(Me).replace(pt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),vn=rr?R.Buffer:r,oi=R.Symbol,yn=R.Uint8Array,Ac=vn?vn.allocUnsafe:r,mn=Sc(Ge.getPrototypeOf,Ge),Oc=Ge.create,Tc=Yi.propertyIsEnumerable,_n=fn.splice,Rc=oi?oi.isConcatSpreadable:r,vs=oi?oi.iterator:r,Si=oi?oi.toStringTag:r,wn=function(){try{var e=Ti(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),Nf=R.clearTimeout!==Pe.clearTimeout&&R.clearTimeout,Ff=Z&&Z.now!==Pe.Date.now&&Z.now,Df=R.setTimeout!==Pe.setTimeout&&R.setTimeout,bn=Lt.ceil,En=Lt.floor,za=Ge.getOwnPropertySymbols,$f=vn?vn.isBuffer:r,Nc=R.isFinite,Lf=fn.join,jf=Sc(Ge.keys,Ge),jt=Lt.max,Vt=Lt.min,Mf=Z.now,zf=R.parseInt,Fc=Lt.random,qf=fn.reverse,qa=Ti(R,"DataView"),ys=Ti(R,"Map"),Ua=Ti(R,"Promise"),Zi=Ti(R,"Set"),ms=Ti(R,"WeakMap"),_s=Ti(Ge,"create"),xn=ms&&new ms,Xi={},Uf=Ri(qa),kf=Ri(ys),Hf=Ri(Ua),Kf=Ri(Zi),Vf=Ri(ms),In=oi?oi.prototype:r,ws=In?In.valueOf:r,Dc=In?In.toString:r;function f(e){if(vt(e)&&!fe(e)&&!(e instanceof Se)){if(e instanceof mr)return e;if(Me.call(e,"__wrapped__"))return $u(e)}return new mr(e)}var Qi=function(){function e(){}return function(t){if(!ot(t))return{};if(Oc)return Oc(t);e.prototype=t;var s=new e;return e.prototype=r,s}}();function Sn(){}function mr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}f.templateSettings={escape:lt,evaluate:ft,interpolate:at,variable:"",imports:{_:f}},f.prototype=Sn.prototype,f.prototype.constructor=f,mr.prototype=Qi(Sn.prototype),mr.prototype.constructor=mr;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=k,this.__views__=[]}function Bf(){var e=new Se(this.__wrapped__);return e.__actions__=ir(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ir(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ir(this.__views__),e}function Gf(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Wf(){var e=this.__wrapped__.value(),t=this.__dir__,s=fe(e),o=t<0,u=s?e.length:0,p=ad(0,u,this.__views__),v=p.start,m=p.end,x=m-v,N=o?m:v-1,F=this.__iteratees__,j=F.length,H=0,ee=Vt(x,this.__takeCount__);if(!s||!o&&u==x&&ee==x)return su(e,this.__actions__);var se=[];e:for(;x--&&H<ee;){N+=t;for(var me=-1,ne=e[N];++me<j;){var xe=F[me],Ce=xe.iteratee,fr=xe.type,Xt=Ce(ne);if(fr==D)ne=Xt;else if(!Xt){if(fr==C)continue e;break e}}se[H++]=ne}return se}Se.prototype=Qi(Sn.prototype),Se.prototype.constructor=Se;function Pi(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var o=e[t];this.set(o[0],o[1])}}function Jf(){this.__data__=_s?_s(null):{},this.size=0}function Yf(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Zf(e){var t=this.__data__;if(_s){var s=t[e];return s===_?r:s}return Me.call(t,e)?t[e]:r}function Xf(e){var t=this.__data__;return _s?t[e]!==r:Me.call(t,e)}function Qf(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=_s&&t===r?_:t,this}Pi.prototype.clear=Jf,Pi.prototype.delete=Yf,Pi.prototype.get=Zf,Pi.prototype.has=Xf,Pi.prototype.set=Qf;function Br(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var o=e[t];this.set(o[0],o[1])}}function ep(){this.__data__=[],this.size=0}function tp(e){var t=this.__data__,s=Pn(t,e);if(s<0)return!1;var o=t.length-1;return s==o?t.pop():_n.call(t,s,1),--this.size,!0}function rp(e){var t=this.__data__,s=Pn(t,e);return s<0?r:t[s][1]}function ip(e){return Pn(this.__data__,e)>-1}function sp(e,t){var s=this.__data__,o=Pn(s,e);return o<0?(++this.size,s.push([e,t])):s[o][1]=t,this}Br.prototype.clear=ep,Br.prototype.delete=tp,Br.prototype.get=rp,Br.prototype.has=ip,Br.prototype.set=sp;function Gr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var o=e[t];this.set(o[0],o[1])}}function np(){this.size=0,this.__data__={hash:new Pi,map:new(ys||Br),string:new Pi}}function ap(e){var t=Mn(this,e).delete(e);return this.size-=t?1:0,t}function op(e){return Mn(this,e).get(e)}function cp(e){return Mn(this,e).has(e)}function up(e,t){var s=Mn(this,e),o=s.size;return s.set(e,t),this.size+=s.size==o?0:1,this}Gr.prototype.clear=np,Gr.prototype.delete=ap,Gr.prototype.get=op,Gr.prototype.has=cp,Gr.prototype.set=up;function Ci(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new Gr;++t<s;)this.add(e[t])}function hp(e){return this.__data__.set(e,_),this}function lp(e){return this.__data__.has(e)}Ci.prototype.add=Ci.prototype.push=hp,Ci.prototype.has=lp;function Or(e){var t=this.__data__=new Br(e);this.size=t.size}function fp(){this.__data__=new Br,this.size=0}function pp(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function dp(e){return this.__data__.get(e)}function gp(e){return this.__data__.has(e)}function vp(e,t){var s=this.__data__;if(s instanceof Br){var o=s.__data__;if(!ys||o.length<a-1)return o.push([e,t]),this.size=++s.size,this;s=this.__data__=new Gr(o)}return s.set(e,t),this.size=s.size,this}Or.prototype.clear=fp,Or.prototype.delete=pp,Or.prototype.get=dp,Or.prototype.has=gp,Or.prototype.set=vp;function $c(e,t){var s=fe(e),o=!s&&Ni(e),u=!s&&!o&&fi(e),p=!s&&!o&&!u&&is(e),v=s||o||u||p,m=v?$a(e.length,Pf):[],x=m.length;for(var N in e)(t||Me.call(e,N))&&!(v&&(N=="length"||u&&(N=="offset"||N=="parent")||p&&(N=="buffer"||N=="byteLength"||N=="byteOffset")||Zr(N,x)))&&m.push(N);return m}function Lc(e){var t=e.length;return t?e[Xa(0,t-1)]:r}function yp(e,t){return zn(ir(e),Ai(t,0,e.length))}function mp(e){return zn(ir(e))}function ka(e,t,s){(s!==r&&!Tr(e[t],s)||s===r&&!(t in e))&&Wr(e,t,s)}function bs(e,t,s){var o=e[t];(!(Me.call(e,t)&&Tr(o,s))||s===r&&!(t in e))&&Wr(e,t,s)}function Pn(e,t){for(var s=e.length;s--;)if(Tr(e[s][0],t))return s;return-1}function _p(e,t,s,o){return ci(e,function(u,p,v){t(o,u,s(u),v)}),o}function jc(e,t){return e&&Mr(t,qt(t),e)}function wp(e,t){return e&&Mr(t,nr(t),e)}function Wr(e,t,s){t=="__proto__"&&wn?wn(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function Ha(e,t){for(var s=-1,o=t.length,u=P(o),p=e==null;++s<o;)u[s]=p?r:Io(e,t[s]);return u}function Ai(e,t,s){return e===e&&(s!==r&&(e=e<=s?e:s),t!==r&&(e=e>=t?e:t)),e}function _r(e,t,s,o,u,p){var v,m=t&G,x=t&W,N=t&V;if(s&&(v=u?s(e,o,u,p):s(e)),v!==r)return v;if(!ot(e))return e;var F=fe(e);if(F){if(v=cd(e),!m)return ir(e,v)}else{var j=Bt(e),H=j==Q||j==oe;if(fi(e))return ou(e,m);if(j==Ie||j==_e||H&&!u){if(v=x||H?{}:Pu(e),!m)return x?Zp(e,wp(v,e)):Yp(e,jc(v,e))}else{if(!Ue[j])return u?e:{};v=ud(e,j,m)}}p||(p=new Or);var ee=p.get(e);if(ee)return ee;p.set(e,v),th(e)?e.forEach(function(ne){v.add(_r(ne,t,s,ne,e,p))}):Qu(e)&&e.forEach(function(ne,xe){v.set(xe,_r(ne,t,s,xe,e,p))});var se=N?x?uo:co:x?nr:qt,me=F?r:se(e);return vr(me||e,function(ne,xe){me&&(xe=ne,ne=e[xe]),bs(v,xe,_r(ne,t,s,xe,e,p))}),v}function bp(e){var t=qt(e);return function(s){return Mc(s,e,t)}}function Mc(e,t,s){var o=s.length;if(e==null)return!o;for(e=Ge(e);o--;){var u=s[o],p=t[u],v=e[u];if(v===r&&!(u in e)||!p(v))return!1}return!0}function zc(e,t,s){if(typeof e!="function")throw new yr(g);return As(function(){e.apply(r,s)},t)}function Es(e,t,s,o){var u=-1,p=un,v=!0,m=e.length,x=[],N=t.length;if(!m)return x;s&&(t=it(t,ur(s))),o?(p=Oa,v=!1):t.length>=a&&(p=gs,v=!1,t=new Ci(t));e:for(;++u<m;){var F=e[u],j=s==null?F:s(F);if(F=o||F!==0?F:0,v&&j===j){for(var H=N;H--;)if(t[H]===j)continue e;x.push(F)}else p(t,j,o)||x.push(F)}return x}var ci=fu(jr),qc=fu(Va,!0);function Ep(e,t){var s=!0;return ci(e,function(o,u,p){return s=!!t(o,u,p),s}),s}function Cn(e,t,s){for(var o=-1,u=e.length;++o<u;){var p=e[o],v=t(p);if(v!=null&&(m===r?v===v&&!lr(v):s(v,m)))var m=v,x=p}return x}function xp(e,t,s,o){var u=e.length;for(s=ve(s),s<0&&(s=-s>u?0:u+s),o=o===r||o>u?u:ve(o),o<0&&(o+=u),o=s>o?0:ih(o);s<o;)e[s++]=t;return e}function Uc(e,t){var s=[];return ci(e,function(o,u,p){t(o,u,p)&&s.push(o)}),s}function Ht(e,t,s,o,u){var p=-1,v=e.length;for(s||(s=ld),u||(u=[]);++p<v;){var m=e[p];t>0&&s(m)?t>1?Ht(m,t-1,s,o,u):ni(u,m):o||(u[u.length]=m)}return u}var Ka=pu(),kc=pu(!0);function jr(e,t){return e&&Ka(e,t,qt)}function Va(e,t){return e&&kc(e,t,qt)}function An(e,t){return si(t,function(s){return Xr(e[s])})}function Oi(e,t){t=hi(t,e);for(var s=0,o=t.length;e!=null&&s<o;)e=e[zr(t[s++])];return s&&s==o?e:r}function Hc(e,t,s){var o=t(e);return fe(e)?o:ni(o,s(e))}function Yt(e){return e==null?e===r?nt:Fe:Si&&Si in Ge(e)?nd(e):md(e)}function Ba(e,t){return e>t}function Ip(e,t){return e!=null&&Me.call(e,t)}function Sp(e,t){return e!=null&&t in Ge(e)}function Pp(e,t,s){return e>=Vt(t,s)&&e<jt(t,s)}function Ga(e,t,s){for(var o=s?Oa:un,u=e[0].length,p=e.length,v=p,m=P(p),x=1/0,N=[];v--;){var F=e[v];v&&t&&(F=it(F,ur(t))),x=Vt(F.length,x),m[v]=!s&&(t||u>=120&&F.length>=120)?new Ci(v&&F):r}F=e[0];var j=-1,H=m[0];e:for(;++j<u&&N.length<x;){var ee=F[j],se=t?t(ee):ee;if(ee=s||ee!==0?ee:0,!(H?gs(H,se):o(N,se,s))){for(v=p;--v;){var me=m[v];if(!(me?gs(me,se):o(e[v],se,s)))continue e}H&&H.push(se),N.push(ee)}}return N}function Cp(e,t,s,o){return jr(e,function(u,p,v){t(o,s(u),p,v)}),o}function xs(e,t,s){t=hi(t,e),e=Tu(e,t);var o=e==null?e:e[zr(br(t))];return o==null?r:zt(o,e,s)}function Kc(e){return vt(e)&&Yt(e)==_e}function Ap(e){return vt(e)&&Yt(e)==Ne}function Op(e){return vt(e)&&Yt(e)==I}function Is(e,t,s,o,u){return e===t?!0:e==null||t==null||!vt(e)&&!vt(t)?e!==e&&t!==t:Tp(e,t,s,o,Is,u)}function Tp(e,t,s,o,u,p){var v=fe(e),m=fe(t),x=v?It:Bt(e),N=m?It:Bt(t);x=x==_e?Ie:x,N=N==_e?Ie:N;var F=x==Ie,j=N==Ie,H=x==N;if(H&&fi(e)){if(!fi(t))return!1;v=!0,F=!1}if(H&&!F)return p||(p=new Or),v||is(e)?xu(e,t,s,o,u,p):id(e,t,x,s,o,u,p);if(!(s&q)){var ee=F&&Me.call(e,"__wrapped__"),se=j&&Me.call(t,"__wrapped__");if(ee||se){var me=ee?e.value():e,ne=se?t.value():t;return p||(p=new Or),u(me,ne,s,o,p)}}return H?(p||(p=new Or),sd(e,t,s,o,u,p)):!1}function Rp(e){return vt(e)&&Bt(e)==ye}function Wa(e,t,s,o){var u=s.length,p=u,v=!o;if(e==null)return!p;for(e=Ge(e);u--;){var m=s[u];if(v&&m[2]?m[1]!==e[m[0]]:!(m[0]in e))return!1}for(;++u<p;){m=s[u];var x=m[0],N=e[x],F=m[1];if(v&&m[2]){if(N===r&&!(x in e))return!1}else{var j=new Or;if(o)var H=o(N,F,x,e,t,j);if(!(H===r?Is(F,N,q|K,o,j):H))return!1}}return!0}function Vc(e){if(!ot(e)||pd(e))return!1;var t=Xr(e)?Rf:pa;return t.test(Ri(e))}function Np(e){return vt(e)&&Yt(e)==st}function Fp(e){return vt(e)&&Bt(e)==$e}function Dp(e){return vt(e)&&Vn(e.length)&&!!Ke[Yt(e)]}function Bc(e){return typeof e=="function"?e:e==null?ar:typeof e=="object"?fe(e)?Jc(e[0],e[1]):Wc(e):dh(e)}function Ja(e){if(!Cs(e))return jf(e);var t=[];for(var s in Ge(e))Me.call(e,s)&&s!="constructor"&&t.push(s);return t}function $p(e){if(!ot(e))return yd(e);var t=Cs(e),s=[];for(var o in e)o=="constructor"&&(t||!Me.call(e,o))||s.push(o);return s}function Ya(e,t){return e<t}function Gc(e,t){var s=-1,o=sr(e)?P(e.length):[];return ci(e,function(u,p,v){o[++s]=t(u,p,v)}),o}function Wc(e){var t=lo(e);return t.length==1&&t[0][2]?Au(t[0][0],t[0][1]):function(s){return s===e||Wa(s,e,t)}}function Jc(e,t){return po(e)&&Cu(t)?Au(zr(e),t):function(s){var o=Io(s,e);return o===r&&o===t?So(s,e):Is(t,o,q|K)}}function On(e,t,s,o,u){e!==t&&Ka(t,function(p,v){if(u||(u=new Or),ot(p))Lp(e,t,v,s,On,o,u);else{var m=o?o(vo(e,v),p,v+"",e,t,u):r;m===r&&(m=p),ka(e,v,m)}},nr)}function Lp(e,t,s,o,u,p,v){var m=vo(e,s),x=vo(t,s),N=v.get(x);if(N){ka(e,s,N);return}var F=p?p(m,x,s+"",e,t,v):r,j=F===r;if(j){var H=fe(x),ee=!H&&fi(x),se=!H&&!ee&&is(x);F=x,H||ee||se?fe(m)?F=m:bt(m)?F=ir(m):ee?(j=!1,F=ou(x,!0)):se?(j=!1,F=cu(x,!0)):F=[]:Os(x)||Ni(x)?(F=m,Ni(m)?F=sh(m):(!ot(m)||Xr(m))&&(F=Pu(x))):j=!1}j&&(v.set(x,F),u(F,x,o,p,v),v.delete(x)),ka(e,s,F)}function Yc(e,t){var s=e.length;if(s)return t+=t<0?s:0,Zr(t,s)?e[t]:r}function Zc(e,t,s){t.length?t=it(t,function(p){return fe(p)?function(v){return Oi(v,p.length===1?p[0]:p)}:p}):t=[ar];var o=-1;t=it(t,ur(re()));var u=Gc(e,function(p,v,m){var x=it(t,function(N){return N(p)});return{criteria:x,index:++o,value:p}});return uf(u,function(p,v){return Jp(p,v,s)})}function jp(e,t){return Xc(e,t,function(s,o){return So(e,o)})}function Xc(e,t,s){for(var o=-1,u=t.length,p={};++o<u;){var v=t[o],m=Oi(e,v);s(m,v)&&Ss(p,hi(v,e),m)}return p}function Mp(e){return function(t){return Oi(t,e)}}function Za(e,t,s,o){var u=o?cf:Bi,p=-1,v=t.length,m=e;for(e===t&&(t=ir(t)),s&&(m=it(e,ur(s)));++p<v;)for(var x=0,N=t[p],F=s?s(N):N;(x=u(m,F,x,o))>-1;)m!==e&&_n.call(m,x,1),_n.call(e,x,1);return e}function Qc(e,t){for(var s=e?t.length:0,o=s-1;s--;){var u=t[s];if(s==o||u!==p){var p=u;Zr(u)?_n.call(e,u,1):to(e,u)}}return e}function Xa(e,t){return e+En(Fc()*(t-e+1))}function zp(e,t,s,o){for(var u=-1,p=jt(bn((t-e)/(s||1)),0),v=P(p);p--;)v[o?p:++u]=e,e+=s;return v}function Qa(e,t){var s="";if(!e||t<1||t>J)return s;do t%2&&(s+=e),t=En(t/2),t&&(e+=e);while(t);return s}function we(e,t){return yo(Ou(e,t,ar),e+"")}function qp(e){return Lc(ss(e))}function Up(e,t){var s=ss(e);return zn(s,Ai(t,0,s.length))}function Ss(e,t,s,o){if(!ot(e))return e;t=hi(t,e);for(var u=-1,p=t.length,v=p-1,m=e;m!=null&&++u<p;){var x=zr(t[u]),N=s;if(x==="__proto__"||x==="constructor"||x==="prototype")return e;if(u!=v){var F=m[x];N=o?o(F,x,m):r,N===r&&(N=ot(F)?F:Zr(t[u+1])?[]:{})}bs(m,x,N),m=m[x]}return e}var eu=xn?function(e,t){return xn.set(e,t),e}:ar,kp=wn?function(e,t){return wn(e,"toString",{configurable:!0,enumerable:!1,value:Co(t),writable:!0})}:ar;function Hp(e){return zn(ss(e))}function wr(e,t,s){var o=-1,u=e.length;t<0&&(t=-t>u?0:u+t),s=s>u?u:s,s<0&&(s+=u),u=t>s?0:s-t>>>0,t>>>=0;for(var p=P(u);++o<u;)p[o]=e[o+t];return p}function Kp(e,t){var s;return ci(e,function(o,u,p){return s=t(o,u,p),!s}),!!s}function Tn(e,t,s){var o=0,u=e==null?o:e.length;if(typeof t=="number"&&t===t&&u<=ke){for(;o<u;){var p=o+u>>>1,v=e[p];v!==null&&!lr(v)&&(s?v<=t:v<t)?o=p+1:u=p}return u}return eo(e,t,ar,s)}function eo(e,t,s,o){var u=0,p=e==null?0:e.length;if(p===0)return 0;t=s(t);for(var v=t!==t,m=t===null,x=lr(t),N=t===r;u<p;){var F=En((u+p)/2),j=s(e[F]),H=j!==r,ee=j===null,se=j===j,me=lr(j);if(v)var ne=o||se;else N?ne=se&&(o||H):m?ne=se&&H&&(o||!ee):x?ne=se&&H&&!ee&&(o||!me):ee||me?ne=!1:ne=o?j<=t:j<t;ne?u=F+1:p=F}return Vt(p,ct)}function tu(e,t){for(var s=-1,o=e.length,u=0,p=[];++s<o;){var v=e[s],m=t?t(v):v;if(!s||!Tr(m,x)){var x=m;p[u++]=v===0?0:v}}return p}function ru(e){return typeof e=="number"?e:lr(e)?z:+e}function hr(e){if(typeof e=="string")return e;if(fe(e))return it(e,hr)+"";if(lr(e))return Dc?Dc.call(e):"";var t=e+"";return t=="0"&&1/e==-Te?"-0":t}function ui(e,t,s){var o=-1,u=un,p=e.length,v=!0,m=[],x=m;if(s)v=!1,u=Oa;else if(p>=a){var N=t?null:td(e);if(N)return ln(N);v=!1,u=gs,x=new Ci}else x=t?[]:m;e:for(;++o<p;){var F=e[o],j=t?t(F):F;if(F=s||F!==0?F:0,v&&j===j){for(var H=x.length;H--;)if(x[H]===j)continue e;t&&x.push(j),m.push(F)}else u(x,j,s)||(x!==m&&x.push(j),m.push(F))}return m}function to(e,t){return t=hi(t,e),e=Tu(e,t),e==null||delete e[zr(br(t))]}function iu(e,t,s,o){return Ss(e,t,s(Oi(e,t)),o)}function Rn(e,t,s,o){for(var u=e.length,p=o?u:-1;(o?p--:++p<u)&&t(e[p],p,e););return s?wr(e,o?0:p,o?p+1:u):wr(e,o?p+1:0,o?u:p)}function su(e,t){var s=e;return s instanceof Se&&(s=s.value()),Ta(t,function(o,u){return u.func.apply(u.thisArg,ni([o],u.args))},s)}function ro(e,t,s){var o=e.length;if(o<2)return o?ui(e[0]):[];for(var u=-1,p=P(o);++u<o;)for(var v=e[u],m=-1;++m<o;)m!=u&&(p[u]=Es(p[u]||v,e[m],t,s));return ui(Ht(p,1),t,s)}function nu(e,t,s){for(var o=-1,u=e.length,p=t.length,v={};++o<u;){var m=o<p?t[o]:r;s(v,e[o],m)}return v}function io(e){return bt(e)?e:[]}function so(e){return typeof e=="function"?e:ar}function hi(e,t){return fe(e)?e:po(e,t)?[e]:Du(Le(e))}var Vp=we;function li(e,t,s){var o=e.length;return s=s===r?o:s,!t&&s>=o?e:wr(e,t,s)}var au=Nf||function(e){return Pe.clearTimeout(e)};function ou(e,t){if(t)return e.slice();var s=e.length,o=Ac?Ac(s):new e.constructor(s);return e.copy(o),o}function no(e){var t=new e.constructor(e.byteLength);return new yn(t).set(new yn(e)),t}function Bp(e,t){var s=t?no(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function Gp(e){var t=new e.constructor(e.source,dr.exec(e));return t.lastIndex=e.lastIndex,t}function Wp(e){return ws?Ge(ws.call(e)):{}}function cu(e,t){var s=t?no(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function uu(e,t){if(e!==t){var s=e!==r,o=e===null,u=e===e,p=lr(e),v=t!==r,m=t===null,x=t===t,N=lr(t);if(!m&&!N&&!p&&e>t||p&&v&&x&&!m&&!N||o&&v&&x||!s&&x||!u)return 1;if(!o&&!p&&!N&&e<t||N&&s&&u&&!o&&!p||m&&s&&u||!v&&u||!x)return-1}return 0}function Jp(e,t,s){for(var o=-1,u=e.criteria,p=t.criteria,v=u.length,m=s.length;++o<v;){var x=uu(u[o],p[o]);if(x){if(o>=m)return x;var N=s[o];return x*(N=="desc"?-1:1)}}return e.index-t.index}function hu(e,t,s,o){for(var u=-1,p=e.length,v=s.length,m=-1,x=t.length,N=jt(p-v,0),F=P(x+N),j=!o;++m<x;)F[m]=t[m];for(;++u<v;)(j||u<p)&&(F[s[u]]=e[u]);for(;N--;)F[m++]=e[u++];return F}function lu(e,t,s,o){for(var u=-1,p=e.length,v=-1,m=s.length,x=-1,N=t.length,F=jt(p-m,0),j=P(F+N),H=!o;++u<F;)j[u]=e[u];for(var ee=u;++x<N;)j[ee+x]=t[x];for(;++v<m;)(H||u<p)&&(j[ee+s[v]]=e[u++]);return j}function ir(e,t){var s=-1,o=e.length;for(t||(t=P(o));++s<o;)t[s]=e[s];return t}function Mr(e,t,s,o){var u=!s;s||(s={});for(var p=-1,v=t.length;++p<v;){var m=t[p],x=o?o(s[m],e[m],m,s,e):r;x===r&&(x=e[m]),u?Wr(s,m,x):bs(s,m,x)}return s}function Yp(e,t){return Mr(e,fo(e),t)}function Zp(e,t){return Mr(e,Iu(e),t)}function Nn(e,t){return function(s,o){var u=fe(s)?tf:_p,p=t?t():{};return u(s,e,re(o,2),p)}}function es(e){return we(function(t,s){var o=-1,u=s.length,p=u>1?s[u-1]:r,v=u>2?s[2]:r;for(p=e.length>3&&typeof p=="function"?(u--,p):r,v&&Zt(s[0],s[1],v)&&(p=u<3?r:p,u=1),t=Ge(t);++o<u;){var m=s[o];m&&e(t,m,o,p)}return t})}function fu(e,t){return function(s,o){if(s==null)return s;if(!sr(s))return e(s,o);for(var u=s.length,p=t?u:-1,v=Ge(s);(t?p--:++p<u)&&o(v[p],p,v)!==!1;);return s}}function pu(e){return function(t,s,o){for(var u=-1,p=Ge(t),v=o(t),m=v.length;m--;){var x=v[e?m:++u];if(s(p[x],x,p)===!1)break}return t}}function Xp(e,t,s){var o=t&ae,u=Ps(e);function p(){var v=this&&this!==Pe&&this instanceof p?u:e;return v.apply(o?s:this,arguments)}return p}function du(e){return function(t){t=Le(t);var s=Gi(t)?Ar(t):r,o=s?s[0]:t.charAt(0),u=s?li(s,1).join(""):t.slice(1);return o[e]()+u}}function ts(e){return function(t){return Ta(fh(lh(t).replace(ps,"")),e,"")}}function Ps(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=Qi(e.prototype),o=e.apply(s,t);return ot(o)?o:s}}function Qp(e,t,s){var o=Ps(e);function u(){for(var p=arguments.length,v=P(p),m=p,x=rs(u);m--;)v[m]=arguments[m];var N=p<3&&v[0]!==x&&v[p-1]!==x?[]:ai(v,x);if(p-=N.length,p<s)return _u(e,t,Fn,u.placeholder,r,v,N,r,r,s-p);var F=this&&this!==Pe&&this instanceof u?o:e;return zt(F,this,v)}return u}function gu(e){return function(t,s,o){var u=Ge(t);if(!sr(t)){var p=re(s,3);t=qt(t),s=function(m){return p(u[m],m,u)}}var v=e(t,s,o);return v>-1?u[p?t[v]:v]:r}}function vu(e){return Yr(function(t){var s=t.length,o=s,u=mr.prototype.thru;for(e&&t.reverse();o--;){var p=t[o];if(typeof p!="function")throw new yr(g);if(u&&!v&&jn(p)=="wrapper")var v=new mr([],!0)}for(o=v?o:s;++o<s;){p=t[o];var m=jn(p),x=m=="wrapper"?ho(p):r;x&&go(x[0])&&x[1]==(M|pe|he|B)&&!x[4].length&&x[9]==1?v=v[jn(x[0])].apply(v,x[3]):v=p.length==1&&go(p)?v[m]():v.thru(p)}return function(){var N=arguments,F=N[0];if(v&&N.length==1&&fe(F))return v.plant(F).value();for(var j=0,H=s?t[j].apply(this,N):F;++j<s;)H=t[j].call(this,H);return H}})}function Fn(e,t,s,o,u,p,v,m,x,N){var F=t&M,j=t&ae,H=t&be,ee=t&(pe|ue),se=t&ge,me=H?r:Ps(e);function ne(){for(var xe=arguments.length,Ce=P(xe),fr=xe;fr--;)Ce[fr]=arguments[fr];if(ee)var Xt=rs(ne),pr=lf(Ce,Xt);if(o&&(Ce=hu(Ce,o,u,ee)),p&&(Ce=lu(Ce,p,v,ee)),xe-=pr,ee&&xe<N){var Et=ai(Ce,Xt);return _u(e,t,Fn,ne.placeholder,s,Ce,Et,m,x,N-xe)}var Rr=j?s:this,ei=H?Rr[e]:e;return xe=Ce.length,m?Ce=_d(Ce,m):se&&xe>1&&Ce.reverse(),F&&x<xe&&(Ce.length=x),this&&this!==Pe&&this instanceof ne&&(ei=me||Ps(ei)),ei.apply(Rr,Ce)}return ne}function yu(e,t){return function(s,o){return Cp(s,e,t(o),{})}}function Dn(e,t){return function(s,o){var u;if(s===r&&o===r)return t;if(s!==r&&(u=s),o!==r){if(u===r)return o;typeof s=="string"||typeof o=="string"?(s=hr(s),o=hr(o)):(s=ru(s),o=ru(o)),u=e(s,o)}return u}}function ao(e){return Yr(function(t){return t=it(t,ur(re())),we(function(s){var o=this;return e(t,function(u){return zt(u,o,s)})})})}function $n(e,t){t=t===r?" ":hr(t);var s=t.length;if(s<2)return s?Qa(t,e):t;var o=Qa(t,bn(e/Wi(t)));return Gi(t)?li(Ar(o),0,e).join(""):o.slice(0,e)}function ed(e,t,s,o){var u=t&ae,p=Ps(e);function v(){for(var m=-1,x=arguments.length,N=-1,F=o.length,j=P(F+x),H=this&&this!==Pe&&this instanceof v?p:e;++N<F;)j[N]=o[N];for(;x--;)j[N++]=arguments[++m];return zt(H,u?s:this,j)}return v}function mu(e){return function(t,s,o){return o&&typeof o!="number"&&Zt(t,s,o)&&(s=o=r),t=Qr(t),s===r?(s=t,t=0):s=Qr(s),o=o===r?t<s?1:-1:Qr(o),zp(t,s,o,e)}}function Ln(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=Er(t),s=Er(s)),e(t,s)}}function _u(e,t,s,o,u,p,v,m,x,N){var F=t&pe,j=F?v:r,H=F?r:v,ee=F?p:r,se=F?r:p;t|=F?he:T,t&=~(F?T:he),t&de||(t&=~(ae|be));var me=[e,t,u,ee,j,se,H,m,x,N],ne=s.apply(r,me);return go(e)&&Ru(ne,me),ne.placeholder=o,Nu(ne,e,t)}function oo(e){var t=Lt[e];return function(s,o){if(s=Er(s),o=o==null?0:Vt(ve(o),292),o&&Nc(s)){var u=(Le(s)+"e").split("e"),p=t(u[0]+"e"+(+u[1]+o));return u=(Le(p)+"e").split("e"),+(u[0]+"e"+(+u[1]-o))}return t(s)}}var td=Zi&&1/ln(new Zi([,-0]))[1]==Te?function(e){return new Zi(e)}:To;function wu(e){return function(t){var s=Bt(t);return s==ye?ja(t):s==$e?mf(t):hf(t,e(t))}}function Jr(e,t,s,o,u,p,v,m){var x=t&be;if(!x&&typeof e!="function")throw new yr(g);var N=o?o.length:0;if(N||(t&=~(he|T),o=u=r),v=v===r?v:jt(ve(v),0),m=m===r?m:ve(m),N-=u?u.length:0,t&T){var F=o,j=u;o=u=r}var H=x?r:ho(e),ee=[e,t,s,o,u,F,j,p,v,m];if(H&&vd(ee,H),e=ee[0],t=ee[1],s=ee[2],o=ee[3],u=ee[4],m=ee[9]=ee[9]===r?x?0:e.length:jt(ee[9]-N,0),!m&&t&(pe|ue)&&(t&=~(pe|ue)),!t||t==ae)var se=Xp(e,t,s);else t==pe||t==ue?se=Qp(e,t,m):(t==he||t==(ae|he))&&!u.length?se=ed(e,t,s,o):se=Fn.apply(r,ee);var me=H?eu:Ru;return Nu(me(se,ee),e,t)}function bu(e,t,s,o){return e===r||Tr(e,Yi[s])&&!Me.call(o,s)?t:e}function Eu(e,t,s,o,u,p){return ot(e)&&ot(t)&&(p.set(t,e),On(e,t,r,Eu,p),p.delete(t)),e}function rd(e){return Os(e)?r:e}function xu(e,t,s,o,u,p){var v=s&q,m=e.length,x=t.length;if(m!=x&&!(v&&x>m))return!1;var N=p.get(e),F=p.get(t);if(N&&F)return N==t&&F==e;var j=-1,H=!0,ee=s&K?new Ci:r;for(p.set(e,t),p.set(t,e);++j<m;){var se=e[j],me=t[j];if(o)var ne=v?o(me,se,j,t,e,p):o(se,me,j,e,t,p);if(ne!==r){if(ne)continue;H=!1;break}if(ee){if(!Ra(t,function(xe,Ce){if(!gs(ee,Ce)&&(se===xe||u(se,xe,s,o,p)))return ee.push(Ce)})){H=!1;break}}else if(!(se===me||u(se,me,s,o,p))){H=!1;break}}return p.delete(e),p.delete(t),H}function id(e,t,s,o,u,p,v){switch(s){case He:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ne:return!(e.byteLength!=t.byteLength||!p(new yn(e),new yn(t)));case A:case I:case Re:return Tr(+e,+t);case w:return e.name==t.name&&e.message==t.message;case st:case Je:return e==t+"";case ye:var m=ja;case $e:var x=o&q;if(m||(m=ln),e.size!=t.size&&!x)return!1;var N=v.get(e);if(N)return N==t;o|=K,v.set(e,t);var F=xu(m(e),m(t),o,u,p,v);return v.delete(e),F;case Ye:if(ws)return ws.call(e)==ws.call(t)}return!1}function sd(e,t,s,o,u,p){var v=s&q,m=co(e),x=m.length,N=co(t),F=N.length;if(x!=F&&!v)return!1;for(var j=x;j--;){var H=m[j];if(!(v?H in t:Me.call(t,H)))return!1}var ee=p.get(e),se=p.get(t);if(ee&&se)return ee==t&&se==e;var me=!0;p.set(e,t),p.set(t,e);for(var ne=v;++j<x;){H=m[j];var xe=e[H],Ce=t[H];if(o)var fr=v?o(Ce,xe,H,t,e,p):o(xe,Ce,H,e,t,p);if(!(fr===r?xe===Ce||u(xe,Ce,s,o,p):fr)){me=!1;break}ne||(ne=H=="constructor")}if(me&&!ne){var Xt=e.constructor,pr=t.constructor;Xt!=pr&&"constructor"in e&&"constructor"in t&&!(typeof Xt=="function"&&Xt instanceof Xt&&typeof pr=="function"&&pr instanceof pr)&&(me=!1)}return p.delete(e),p.delete(t),me}function Yr(e){return yo(Ou(e,r,Mu),e+"")}function co(e){return Hc(e,qt,fo)}function uo(e){return Hc(e,nr,Iu)}var ho=xn?function(e){return xn.get(e)}:To;function jn(e){for(var t=e.name+"",s=Xi[t],o=Me.call(Xi,t)?s.length:0;o--;){var u=s[o],p=u.func;if(p==null||p==e)return u.name}return t}function rs(e){var t=Me.call(f,"placeholder")?f:e;return t.placeholder}function re(){var e=f.iteratee||Ao;return e=e===Ao?Bc:e,arguments.length?e(arguments[0],arguments[1]):e}function Mn(e,t){var s=e.__data__;return fd(t)?s[typeof t=="string"?"string":"hash"]:s.map}function lo(e){for(var t=qt(e),s=t.length;s--;){var o=t[s],u=e[o];t[s]=[o,u,Cu(u)]}return t}function Ti(e,t){var s=gf(e,t);return Vc(s)?s:r}function nd(e){var t=Me.call(e,Si),s=e[Si];try{e[Si]=r;var o=!0}catch{}var u=gn.call(e);return o&&(t?e[Si]=s:delete e[Si]),u}var fo=za?function(e){return e==null?[]:(e=Ge(e),si(za(e),function(t){return Tc.call(e,t)}))}:Ro,Iu=za?function(e){for(var t=[];e;)ni(t,fo(e)),e=mn(e);return t}:Ro,Bt=Yt;(qa&&Bt(new qa(new ArrayBuffer(1)))!=He||ys&&Bt(new ys)!=ye||Ua&&Bt(Ua.resolve())!=St||Zi&&Bt(new Zi)!=$e||ms&&Bt(new ms)!=qe)&&(Bt=function(e){var t=Yt(e),s=t==Ie?e.constructor:r,o=s?Ri(s):"";if(o)switch(o){case Uf:return He;case kf:return ye;case Hf:return St;case Kf:return $e;case Vf:return qe}return t});function ad(e,t,s){for(var o=-1,u=s.length;++o<u;){var p=s[o],v=p.size;switch(p.type){case"drop":e+=v;break;case"dropRight":t-=v;break;case"take":t=Vt(t,e+v);break;case"takeRight":e=jt(e,t-v);break}}return{start:e,end:t}}function od(e){var t=e.match(We);return t?t[1].split(Tt):[]}function Su(e,t,s){t=hi(t,e);for(var o=-1,u=t.length,p=!1;++o<u;){var v=zr(t[o]);if(!(p=e!=null&&s(e,v)))break;e=e[v]}return p||++o!=u?p:(u=e==null?0:e.length,!!u&&Vn(u)&&Zr(v,u)&&(fe(e)||Ni(e)))}function cd(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&Me.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Pu(e){return typeof e.constructor=="function"&&!Cs(e)?Qi(mn(e)):{}}function ud(e,t,s){var o=e.constructor;switch(t){case Ne:return no(e);case A:case I:return new o(+e);case He:return Bp(e,s);case ut:case je:case Pt:case $t:case Ut:case kt:case Mt:case Gt:case tr:return cu(e,s);case ye:return new o;case Re:case Je:return new o(e);case st:return Gp(e);case $e:return new o;case Ye:return Wp(e)}}function hd(e,t){var s=t.length;if(!s)return e;var o=s-1;return t[o]=(s>1?"& ":"")+t[o],t=t.join(s>2?", ":" "),e.replace(gt,`{
/* [wrapped with `+t+`] */
`)}function ld(e){return fe(e)||Ni(e)||!!(Rc&&e&&e[Rc])}function Zr(e,t){var s=typeof e;return t=t??J,!!t&&(s=="number"||s!="symbol"&&ga.test(e))&&e>-1&&e%1==0&&e<t}function Zt(e,t,s){if(!ot(s))return!1;var o=typeof t;return(o=="number"?sr(s)&&Zr(t,s.length):o=="string"&&t in s)?Tr(s[t],e):!1}function po(e,t){if(fe(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||lr(e)?!0:Ct.test(e)||!rt.test(e)||t!=null&&e in Ge(t)}function fd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function go(e){var t=jn(e),s=f[t];if(typeof s!="function"||!(t in Se.prototype))return!1;if(e===s)return!0;var o=ho(s);return!!o&&e===o[0]}function pd(e){return!!Cc&&Cc in e}var dd=pn?Xr:No;function Cs(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||Yi;return e===s}function Cu(e){return e===e&&!ot(e)}function Au(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==r||e in Ge(s))}}function gd(e){var t=Hn(e,function(o){return s.size===S&&s.clear(),o}),s=t.cache;return t}function vd(e,t){var s=e[1],o=t[1],u=s|o,p=u<(ae|be|M),v=o==M&&s==pe||o==M&&s==B&&e[7].length<=t[8]||o==(M|B)&&t[7].length<=t[8]&&s==pe;if(!(p||v))return e;o&ae&&(e[2]=t[2],u|=s&ae?0:de);var m=t[3];if(m){var x=e[3];e[3]=x?hu(x,m,t[4]):m,e[4]=x?ai(e[3],$):t[4]}return m=t[5],m&&(x=e[5],e[5]=x?lu(x,m,t[6]):m,e[6]=x?ai(e[5],$):t[6]),m=t[7],m&&(e[7]=m),o&M&&(e[8]=e[8]==null?t[8]:Vt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=u,e}function yd(e){var t=[];if(e!=null)for(var s in Ge(e))t.push(s);return t}function md(e){return gn.call(e)}function Ou(e,t,s){return t=jt(t===r?e.length-1:t,0),function(){for(var o=arguments,u=-1,p=jt(o.length-t,0),v=P(p);++u<p;)v[u]=o[t+u];u=-1;for(var m=P(t+1);++u<t;)m[u]=o[u];return m[t]=s(v),zt(e,this,m)}}function Tu(e,t){return t.length<2?e:Oi(e,wr(t,0,-1))}function _d(e,t){for(var s=e.length,o=Vt(t.length,s),u=ir(e);o--;){var p=t[o];e[o]=Zr(p,s)?u[p]:r}return e}function vo(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ru=Fu(eu),As=Df||function(e,t){return Pe.setTimeout(e,t)},yo=Fu(kp);function Nu(e,t,s){var o=t+"";return yo(e,hd(o,wd(od(o),s)))}function Fu(e){var t=0,s=0;return function(){var o=Mf(),u=et-(o-s);if(s=o,u>0){if(++t>=Oe)return arguments[0]}else t=0;return e.apply(r,arguments)}}function zn(e,t){var s=-1,o=e.length,u=o-1;for(t=t===r?o:t;++s<t;){var p=Xa(s,u),v=e[p];e[p]=e[s],e[s]=v}return e.length=t,e}var Du=gd(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(At,function(s,o,u,p){t.push(u?p.replace(ua,"$1"):o||s)}),t});function zr(e){if(typeof e=="string"||lr(e))return e;var t=e+"";return t=="0"&&1/e==-Te?"-0":t}function Ri(e){if(e!=null){try{return dn.call(e)}catch{}try{return e+""}catch{}}return""}function wd(e,t){return vr(Fr,function(s){var o="_."+s[0];t&s[1]&&!un(e,o)&&e.push(o)}),e.sort()}function $u(e){if(e instanceof Se)return e.clone();var t=new mr(e.__wrapped__,e.__chain__);return t.__actions__=ir(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function bd(e,t,s){(s?Zt(e,t,s):t===r)?t=1:t=jt(ve(t),0);var o=e==null?0:e.length;if(!o||t<1)return[];for(var u=0,p=0,v=P(bn(o/t));u<o;)v[p++]=wr(e,u,u+=t);return v}function Ed(e){for(var t=-1,s=e==null?0:e.length,o=0,u=[];++t<s;){var p=e[t];p&&(u[o++]=p)}return u}function xd(){var e=arguments.length;if(!e)return[];for(var t=P(e-1),s=arguments[0],o=e;o--;)t[o-1]=arguments[o];return ni(fe(s)?ir(s):[s],Ht(t,1))}var Id=we(function(e,t){return bt(e)?Es(e,Ht(t,1,bt,!0)):[]}),Sd=we(function(e,t){var s=br(t);return bt(s)&&(s=r),bt(e)?Es(e,Ht(t,1,bt,!0),re(s,2)):[]}),Pd=we(function(e,t){var s=br(t);return bt(s)&&(s=r),bt(e)?Es(e,Ht(t,1,bt,!0),r,s):[]});function Cd(e,t,s){var o=e==null?0:e.length;return o?(t=s||t===r?1:ve(t),wr(e,t<0?0:t,o)):[]}function Ad(e,t,s){var o=e==null?0:e.length;return o?(t=s||t===r?1:ve(t),t=o-t,wr(e,0,t<0?0:t)):[]}function Od(e,t){return e&&e.length?Rn(e,re(t,3),!0,!0):[]}function Td(e,t){return e&&e.length?Rn(e,re(t,3),!0):[]}function Rd(e,t,s,o){var u=e==null?0:e.length;return u?(s&&typeof s!="number"&&Zt(e,t,s)&&(s=0,o=u),xp(e,t,s,o)):[]}function Lu(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var u=s==null?0:ve(s);return u<0&&(u=jt(o+u,0)),hn(e,re(t,3),u)}function ju(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var u=o-1;return s!==r&&(u=ve(s),u=s<0?jt(o+u,0):Vt(u,o-1)),hn(e,re(t,3),u,!0)}function Mu(e){var t=e==null?0:e.length;return t?Ht(e,1):[]}function Nd(e){var t=e==null?0:e.length;return t?Ht(e,Te):[]}function Fd(e,t){var s=e==null?0:e.length;return s?(t=t===r?1:ve(t),Ht(e,t)):[]}function Dd(e){for(var t=-1,s=e==null?0:e.length,o={};++t<s;){var u=e[t];o[u[0]]=u[1]}return o}function zu(e){return e&&e.length?e[0]:r}function $d(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var u=s==null?0:ve(s);return u<0&&(u=jt(o+u,0)),Bi(e,t,u)}function Ld(e){var t=e==null?0:e.length;return t?wr(e,0,-1):[]}var jd=we(function(e){var t=it(e,io);return t.length&&t[0]===e[0]?Ga(t):[]}),Md=we(function(e){var t=br(e),s=it(e,io);return t===br(s)?t=r:s.pop(),s.length&&s[0]===e[0]?Ga(s,re(t,2)):[]}),zd=we(function(e){var t=br(e),s=it(e,io);return t=typeof t=="function"?t:r,t&&s.pop(),s.length&&s[0]===e[0]?Ga(s,r,t):[]});function qd(e,t){return e==null?"":Lf.call(e,t)}function br(e){var t=e==null?0:e.length;return t?e[t-1]:r}function Ud(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var u=o;return s!==r&&(u=ve(s),u=u<0?jt(o+u,0):Vt(u,o-1)),t===t?wf(e,t,u):hn(e,_c,u,!0)}function kd(e,t){return e&&e.length?Yc(e,ve(t)):r}var Hd=we(qu);function qu(e,t){return e&&e.length&&t&&t.length?Za(e,t):e}function Kd(e,t,s){return e&&e.length&&t&&t.length?Za(e,t,re(s,2)):e}function Vd(e,t,s){return e&&e.length&&t&&t.length?Za(e,t,r,s):e}var Bd=Yr(function(e,t){var s=e==null?0:e.length,o=Ha(e,t);return Qc(e,it(t,function(u){return Zr(u,s)?+u:u}).sort(uu)),o});function Gd(e,t){var s=[];if(!(e&&e.length))return s;var o=-1,u=[],p=e.length;for(t=re(t,3);++o<p;){var v=e[o];t(v,o,e)&&(s.push(v),u.push(o))}return Qc(e,u),s}function mo(e){return e==null?e:qf.call(e)}function Wd(e,t,s){var o=e==null?0:e.length;return o?(s&&typeof s!="number"&&Zt(e,t,s)?(t=0,s=o):(t=t==null?0:ve(t),s=s===r?o:ve(s)),wr(e,t,s)):[]}function Jd(e,t){return Tn(e,t)}function Yd(e,t,s){return eo(e,t,re(s,2))}function Zd(e,t){var s=e==null?0:e.length;if(s){var o=Tn(e,t);if(o<s&&Tr(e[o],t))return o}return-1}function Xd(e,t){return Tn(e,t,!0)}function Qd(e,t,s){return eo(e,t,re(s,2),!0)}function eg(e,t){var s=e==null?0:e.length;if(s){var o=Tn(e,t,!0)-1;if(Tr(e[o],t))return o}return-1}function tg(e){return e&&e.length?tu(e):[]}function rg(e,t){return e&&e.length?tu(e,re(t,2)):[]}function ig(e){var t=e==null?0:e.length;return t?wr(e,1,t):[]}function sg(e,t,s){return e&&e.length?(t=s||t===r?1:ve(t),wr(e,0,t<0?0:t)):[]}function ng(e,t,s){var o=e==null?0:e.length;return o?(t=s||t===r?1:ve(t),t=o-t,wr(e,t<0?0:t,o)):[]}function ag(e,t){return e&&e.length?Rn(e,re(t,3),!1,!0):[]}function og(e,t){return e&&e.length?Rn(e,re(t,3)):[]}var cg=we(function(e){return ui(Ht(e,1,bt,!0))}),ug=we(function(e){var t=br(e);return bt(t)&&(t=r),ui(Ht(e,1,bt,!0),re(t,2))}),hg=we(function(e){var t=br(e);return t=typeof t=="function"?t:r,ui(Ht(e,1,bt,!0),r,t)});function lg(e){return e&&e.length?ui(e):[]}function fg(e,t){return e&&e.length?ui(e,re(t,2)):[]}function pg(e,t){return t=typeof t=="function"?t:r,e&&e.length?ui(e,r,t):[]}function _o(e){if(!(e&&e.length))return[];var t=0;return e=si(e,function(s){if(bt(s))return t=jt(s.length,t),!0}),$a(t,function(s){return it(e,Na(s))})}function Uu(e,t){if(!(e&&e.length))return[];var s=_o(e);return t==null?s:it(s,function(o){return zt(t,r,o)})}var dg=we(function(e,t){return bt(e)?Es(e,t):[]}),gg=we(function(e){return ro(si(e,bt))}),vg=we(function(e){var t=br(e);return bt(t)&&(t=r),ro(si(e,bt),re(t,2))}),yg=we(function(e){var t=br(e);return t=typeof t=="function"?t:r,ro(si(e,bt),r,t)}),mg=we(_o);function _g(e,t){return nu(e||[],t||[],bs)}function wg(e,t){return nu(e||[],t||[],Ss)}var bg=we(function(e){var t=e.length,s=t>1?e[t-1]:r;return s=typeof s=="function"?(e.pop(),s):r,Uu(e,s)});function ku(e){var t=f(e);return t.__chain__=!0,t}function Eg(e,t){return t(e),e}function qn(e,t){return t(e)}var xg=Yr(function(e){var t=e.length,s=t?e[0]:0,o=this.__wrapped__,u=function(p){return Ha(p,e)};return t>1||this.__actions__.length||!(o instanceof Se)||!Zr(s)?this.thru(u):(o=o.slice(s,+s+(t?1:0)),o.__actions__.push({func:qn,args:[u],thisArg:r}),new mr(o,this.__chain__).thru(function(p){return t&&!p.length&&p.push(r),p}))});function Ig(){return ku(this)}function Sg(){return new mr(this.value(),this.__chain__)}function Pg(){this.__values__===r&&(this.__values__=rh(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Cg(){return this}function Ag(e){for(var t,s=this;s instanceof Sn;){var o=$u(s);o.__index__=0,o.__values__=r,t?u.__wrapped__=o:t=o;var u=o;s=s.__wrapped__}return u.__wrapped__=e,t}function Og(){var e=this.__wrapped__;if(e instanceof Se){var t=e;return this.__actions__.length&&(t=new Se(this)),t=t.reverse(),t.__actions__.push({func:qn,args:[mo],thisArg:r}),new mr(t,this.__chain__)}return this.thru(mo)}function Tg(){return su(this.__wrapped__,this.__actions__)}var Rg=Nn(function(e,t,s){Me.call(e,s)?++e[s]:Wr(e,s,1)});function Ng(e,t,s){var o=fe(e)?yc:Ep;return s&&Zt(e,t,s)&&(t=r),o(e,re(t,3))}function Fg(e,t){var s=fe(e)?si:Uc;return s(e,re(t,3))}var Dg=gu(Lu),$g=gu(ju);function Lg(e,t){return Ht(Un(e,t),1)}function jg(e,t){return Ht(Un(e,t),Te)}function Mg(e,t,s){return s=s===r?1:ve(s),Ht(Un(e,t),s)}function Hu(e,t){var s=fe(e)?vr:ci;return s(e,re(t,3))}function Ku(e,t){var s=fe(e)?rf:qc;return s(e,re(t,3))}var zg=Nn(function(e,t,s){Me.call(e,s)?e[s].push(t):Wr(e,s,[t])});function qg(e,t,s,o){e=sr(e)?e:ss(e),s=s&&!o?ve(s):0;var u=e.length;return s<0&&(s=jt(u+s,0)),Bn(e)?s<=u&&e.indexOf(t,s)>-1:!!u&&Bi(e,t,s)>-1}var Ug=we(function(e,t,s){var o=-1,u=typeof t=="function",p=sr(e)?P(e.length):[];return ci(e,function(v){p[++o]=u?zt(t,v,s):xs(v,t,s)}),p}),kg=Nn(function(e,t,s){Wr(e,s,t)});function Un(e,t){var s=fe(e)?it:Gc;return s(e,re(t,3))}function Hg(e,t,s,o){return e==null?[]:(fe(t)||(t=t==null?[]:[t]),s=o?r:s,fe(s)||(s=s==null?[]:[s]),Zc(e,t,s))}var Kg=Nn(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function Vg(e,t,s){var o=fe(e)?Ta:bc,u=arguments.length<3;return o(e,re(t,4),s,u,ci)}function Bg(e,t,s){var o=fe(e)?sf:bc,u=arguments.length<3;return o(e,re(t,4),s,u,qc)}function Gg(e,t){var s=fe(e)?si:Uc;return s(e,Kn(re(t,3)))}function Wg(e){var t=fe(e)?Lc:qp;return t(e)}function Jg(e,t,s){(s?Zt(e,t,s):t===r)?t=1:t=ve(t);var o=fe(e)?yp:Up;return o(e,t)}function Yg(e){var t=fe(e)?mp:Hp;return t(e)}function Zg(e){if(e==null)return 0;if(sr(e))return Bn(e)?Wi(e):e.length;var t=Bt(e);return t==ye||t==$e?e.size:Ja(e).length}function Xg(e,t,s){var o=fe(e)?Ra:Kp;return s&&Zt(e,t,s)&&(t=r),o(e,re(t,3))}var Qg=we(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Zt(e,t[0],t[1])?t=[]:s>2&&Zt(t[0],t[1],t[2])&&(t=[t[0]]),Zc(e,Ht(t,1),[])}),kn=Ff||function(){return Pe.Date.now()};function e0(e,t){if(typeof t!="function")throw new yr(g);return e=ve(e),function(){if(--e<1)return t.apply(this,arguments)}}function Vu(e,t,s){return t=s?r:t,t=e&&t==null?e.length:t,Jr(e,M,r,r,r,r,t)}function Bu(e,t){var s;if(typeof t!="function")throw new yr(g);return e=ve(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=r),s}}var wo=we(function(e,t,s){var o=ae;if(s.length){var u=ai(s,rs(wo));o|=he}return Jr(e,o,t,s,u)}),Gu=we(function(e,t,s){var o=ae|be;if(s.length){var u=ai(s,rs(Gu));o|=he}return Jr(t,o,e,s,u)});function Wu(e,t,s){t=s?r:t;var o=Jr(e,pe,r,r,r,r,r,t);return o.placeholder=Wu.placeholder,o}function Ju(e,t,s){t=s?r:t;var o=Jr(e,ue,r,r,r,r,r,t);return o.placeholder=Ju.placeholder,o}function Yu(e,t,s){var o,u,p,v,m,x,N=0,F=!1,j=!1,H=!0;if(typeof e!="function")throw new yr(g);t=Er(t)||0,ot(s)&&(F=!!s.leading,j="maxWait"in s,p=j?jt(Er(s.maxWait)||0,t):p,H="trailing"in s?!!s.trailing:H);function ee(Et){var Rr=o,ei=u;return o=u=r,N=Et,v=e.apply(ei,Rr),v}function se(Et){return N=Et,m=As(xe,t),F?ee(Et):v}function me(Et){var Rr=Et-x,ei=Et-N,gh=t-Rr;return j?Vt(gh,p-ei):gh}function ne(Et){var Rr=Et-x,ei=Et-N;return x===r||Rr>=t||Rr<0||j&&ei>=p}function xe(){var Et=kn();if(ne(Et))return Ce(Et);m=As(xe,me(Et))}function Ce(Et){return m=r,H&&o?ee(Et):(o=u=r,v)}function fr(){m!==r&&au(m),N=0,o=x=u=m=r}function Xt(){return m===r?v:Ce(kn())}function pr(){var Et=kn(),Rr=ne(Et);if(o=arguments,u=this,x=Et,Rr){if(m===r)return se(x);if(j)return au(m),m=As(xe,t),ee(x)}return m===r&&(m=As(xe,t)),v}return pr.cancel=fr,pr.flush=Xt,pr}var t0=we(function(e,t){return zc(e,1,t)}),r0=we(function(e,t,s){return zc(e,Er(t)||0,s)});function i0(e){return Jr(e,ge)}function Hn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new yr(g);var s=function(){var o=arguments,u=t?t.apply(this,o):o[0],p=s.cache;if(p.has(u))return p.get(u);var v=e.apply(this,o);return s.cache=p.set(u,v)||p,v};return s.cache=new(Hn.Cache||Gr),s}Hn.Cache=Gr;function Kn(e){if(typeof e!="function")throw new yr(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function s0(e){return Bu(2,e)}var n0=Vp(function(e,t){t=t.length==1&&fe(t[0])?it(t[0],ur(re())):it(Ht(t,1),ur(re()));var s=t.length;return we(function(o){for(var u=-1,p=Vt(o.length,s);++u<p;)o[u]=t[u].call(this,o[u]);return zt(e,this,o)})}),bo=we(function(e,t){var s=ai(t,rs(bo));return Jr(e,he,r,t,s)}),Zu=we(function(e,t){var s=ai(t,rs(Zu));return Jr(e,T,r,t,s)}),a0=Yr(function(e,t){return Jr(e,B,r,r,r,t)});function o0(e,t){if(typeof e!="function")throw new yr(g);return t=t===r?t:ve(t),we(e,t)}function c0(e,t){if(typeof e!="function")throw new yr(g);return t=t==null?0:jt(ve(t),0),we(function(s){var o=s[t],u=li(s,0,t);return o&&ni(u,o),zt(e,this,u)})}function u0(e,t,s){var o=!0,u=!0;if(typeof e!="function")throw new yr(g);return ot(s)&&(o="leading"in s?!!s.leading:o,u="trailing"in s?!!s.trailing:u),Yu(e,t,{leading:o,maxWait:t,trailing:u})}function h0(e){return Vu(e,1)}function l0(e,t){return bo(so(t),e)}function f0(){if(!arguments.length)return[];var e=arguments[0];return fe(e)?e:[e]}function p0(e){return _r(e,V)}function d0(e,t){return t=typeof t=="function"?t:r,_r(e,V,t)}function g0(e){return _r(e,G|V)}function v0(e,t){return t=typeof t=="function"?t:r,_r(e,G|V,t)}function y0(e,t){return t==null||Mc(e,t,qt(t))}function Tr(e,t){return e===t||e!==e&&t!==t}var m0=Ln(Ba),_0=Ln(function(e,t){return e>=t}),Ni=Kc(function(){return arguments}())?Kc:function(e){return vt(e)&&Me.call(e,"callee")&&!Tc.call(e,"callee")},fe=P.isArray,w0=Jt?ur(Jt):Ap;function sr(e){return e!=null&&Vn(e.length)&&!Xr(e)}function bt(e){return vt(e)&&sr(e)}function b0(e){return e===!0||e===!1||vt(e)&&Yt(e)==A}var fi=$f||No,E0=Cr?ur(Cr):Op;function x0(e){return vt(e)&&e.nodeType===1&&!Os(e)}function I0(e){if(e==null)return!0;if(sr(e)&&(fe(e)||typeof e=="string"||typeof e.splice=="function"||fi(e)||is(e)||Ni(e)))return!e.length;var t=Bt(e);if(t==ye||t==$e)return!e.size;if(Cs(e))return!Ja(e).length;for(var s in e)if(Me.call(e,s))return!1;return!0}function S0(e,t){return Is(e,t)}function P0(e,t,s){s=typeof s=="function"?s:r;var o=s?s(e,t):r;return o===r?Is(e,t,r,s):!!o}function Eo(e){if(!vt(e))return!1;var t=Yt(e);return t==w||t==c||typeof e.message=="string"&&typeof e.name=="string"&&!Os(e)}function C0(e){return typeof e=="number"&&Nc(e)}function Xr(e){if(!ot(e))return!1;var t=Yt(e);return t==Q||t==oe||t==O||t==mt}function Xu(e){return typeof e=="number"&&e==ve(e)}function Vn(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function ot(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function vt(e){return e!=null&&typeof e=="object"}var Qu=gr?ur(gr):Rp;function A0(e,t){return e===t||Wa(e,t,lo(t))}function O0(e,t,s){return s=typeof s=="function"?s:r,Wa(e,t,lo(t),s)}function T0(e){return eh(e)&&e!=+e}function R0(e){if(dd(e))throw new ce(l);return Vc(e)}function N0(e){return e===null}function F0(e){return e==null}function eh(e){return typeof e=="number"||vt(e)&&Yt(e)==Re}function Os(e){if(!vt(e)||Yt(e)!=Ie)return!1;var t=mn(e);if(t===null)return!0;var s=Me.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&dn.call(s)==Of}var xo=Lr?ur(Lr):Np;function D0(e){return Xu(e)&&e>=-J&&e<=J}var th=ds?ur(ds):Fp;function Bn(e){return typeof e=="string"||!fe(e)&&vt(e)&&Yt(e)==Je}function lr(e){return typeof e=="symbol"||vt(e)&&Yt(e)==Ye}var is=Ii?ur(Ii):Dp;function $0(e){return e===r}function L0(e){return vt(e)&&Bt(e)==qe}function j0(e){return vt(e)&&Yt(e)==Ze}var M0=Ln(Ya),z0=Ln(function(e,t){return e<=t});function rh(e){if(!e)return[];if(sr(e))return Bn(e)?Ar(e):ir(e);if(vs&&e[vs])return yf(e[vs]());var t=Bt(e),s=t==ye?ja:t==$e?ln:ss;return s(e)}function Qr(e){if(!e)return e===0?e:0;if(e=Er(e),e===Te||e===-Te){var t=e<0?-1:1;return t*U}return e===e?e:0}function ve(e){var t=Qr(e),s=t%1;return t===t?s?t-s:t:0}function ih(e){return e?Ai(ve(e),0,k):0}function Er(e){if(typeof e=="number")return e;if(lr(e))return z;if(ot(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ot(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Ec(e);var s=fa.test(e);return s||da.test(e)?le(e.slice(2),s?2:8):la.test(e)?z:+e}function sh(e){return Mr(e,nr(e))}function q0(e){return e?Ai(ve(e),-J,J):e===0?e:0}function Le(e){return e==null?"":hr(e)}var U0=es(function(e,t){if(Cs(t)||sr(t)){Mr(t,qt(t),e);return}for(var s in t)Me.call(t,s)&&bs(e,s,t[s])}),nh=es(function(e,t){Mr(t,nr(t),e)}),Gn=es(function(e,t,s,o){Mr(t,nr(t),e,o)}),k0=es(function(e,t,s,o){Mr(t,qt(t),e,o)}),H0=Yr(Ha);function K0(e,t){var s=Qi(e);return t==null?s:jc(s,t)}var V0=we(function(e,t){e=Ge(e);var s=-1,o=t.length,u=o>2?t[2]:r;for(u&&Zt(t[0],t[1],u)&&(o=1);++s<o;)for(var p=t[s],v=nr(p),m=-1,x=v.length;++m<x;){var N=v[m],F=e[N];(F===r||Tr(F,Yi[N])&&!Me.call(e,N))&&(e[N]=p[N])}return e}),B0=we(function(e){return e.push(r,Eu),zt(ah,r,e)});function G0(e,t){return mc(e,re(t,3),jr)}function W0(e,t){return mc(e,re(t,3),Va)}function J0(e,t){return e==null?e:Ka(e,re(t,3),nr)}function Y0(e,t){return e==null?e:kc(e,re(t,3),nr)}function Z0(e,t){return e&&jr(e,re(t,3))}function X0(e,t){return e&&Va(e,re(t,3))}function Q0(e){return e==null?[]:An(e,qt(e))}function ev(e){return e==null?[]:An(e,nr(e))}function Io(e,t,s){var o=e==null?r:Oi(e,t);return o===r?s:o}function tv(e,t){return e!=null&&Su(e,t,Ip)}function So(e,t){return e!=null&&Su(e,t,Sp)}var rv=yu(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=gn.call(t)),e[t]=s},Co(ar)),iv=yu(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=gn.call(t)),Me.call(e,t)?e[t].push(s):e[t]=[s]},re),sv=we(xs);function qt(e){return sr(e)?$c(e):Ja(e)}function nr(e){return sr(e)?$c(e,!0):$p(e)}function nv(e,t){var s={};return t=re(t,3),jr(e,function(o,u,p){Wr(s,t(o,u,p),o)}),s}function av(e,t){var s={};return t=re(t,3),jr(e,function(o,u,p){Wr(s,u,t(o,u,p))}),s}var ov=es(function(e,t,s){On(e,t,s)}),ah=es(function(e,t,s,o){On(e,t,s,o)}),cv=Yr(function(e,t){var s={};if(e==null)return s;var o=!1;t=it(t,function(p){return p=hi(p,e),o||(o=p.length>1),p}),Mr(e,uo(e),s),o&&(s=_r(s,G|W|V,rd));for(var u=t.length;u--;)to(s,t[u]);return s});function uv(e,t){return oh(e,Kn(re(t)))}var hv=Yr(function(e,t){return e==null?{}:jp(e,t)});function oh(e,t){if(e==null)return{};var s=it(uo(e),function(o){return[o]});return t=re(t),Xc(e,s,function(o,u){return t(o,u[0])})}function lv(e,t,s){t=hi(t,e);var o=-1,u=t.length;for(u||(u=1,e=r);++o<u;){var p=e==null?r:e[zr(t[o])];p===r&&(o=u,p=s),e=Xr(p)?p.call(e):p}return e}function fv(e,t,s){return e==null?e:Ss(e,t,s)}function pv(e,t,s,o){return o=typeof o=="function"?o:r,e==null?e:Ss(e,t,s,o)}var ch=wu(qt),uh=wu(nr);function dv(e,t,s){var o=fe(e),u=o||fi(e)||is(e);if(t=re(t,4),s==null){var p=e&&e.constructor;u?s=o?new p:[]:ot(e)?s=Xr(p)?Qi(mn(e)):{}:s={}}return(u?vr:jr)(e,function(v,m,x){return t(s,v,m,x)}),s}function gv(e,t){return e==null?!0:to(e,t)}function vv(e,t,s){return e==null?e:iu(e,t,so(s))}function yv(e,t,s,o){return o=typeof o=="function"?o:r,e==null?e:iu(e,t,so(s),o)}function ss(e){return e==null?[]:La(e,qt(e))}function mv(e){return e==null?[]:La(e,nr(e))}function _v(e,t,s){return s===r&&(s=t,t=r),s!==r&&(s=Er(s),s=s===s?s:0),t!==r&&(t=Er(t),t=t===t?t:0),Ai(Er(e),t,s)}function wv(e,t,s){return t=Qr(t),s===r?(s=t,t=0):s=Qr(s),e=Er(e),Pp(e,t,s)}function bv(e,t,s){if(s&&typeof s!="boolean"&&Zt(e,t,s)&&(t=s=r),s===r&&(typeof t=="boolean"?(s=t,t=r):typeof e=="boolean"&&(s=e,e=r)),e===r&&t===r?(e=0,t=1):(e=Qr(e),t===r?(t=e,e=0):t=Qr(t)),e>t){var o=e;e=t,t=o}if(s||e%1||t%1){var u=Fc();return Vt(e+u*(t-e+Ve("1e-"+((u+"").length-1))),t)}return Xa(e,t)}var Ev=ts(function(e,t,s){return t=t.toLowerCase(),e+(s?hh(t):t)});function hh(e){return Po(Le(e).toLowerCase())}function lh(e){return e=Le(e),e&&e.replace(Kr,ff).replace(Ca,"")}function xv(e,t,s){e=Le(e),t=hr(t);var o=e.length;s=s===r?o:Ai(ve(s),0,o);var u=s;return s-=t.length,s>=0&&e.slice(s,u)==t}function Iv(e){return e=Le(e),e&&tt.test(e)?e.replace(_i,pf):e}function Sv(e){return e=Le(e),e&&Ot.test(e)?e.replace(pt,"\\$&"):e}var Pv=ts(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),Cv=ts(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),Av=du("toLowerCase");function Ov(e,t,s){e=Le(e),t=ve(t);var o=t?Wi(e):0;if(!t||o>=t)return e;var u=(t-o)/2;return $n(En(u),s)+e+$n(bn(u),s)}function Tv(e,t,s){e=Le(e),t=ve(t);var o=t?Wi(e):0;return t&&o<t?e+$n(t-o,s):e}function Rv(e,t,s){e=Le(e),t=ve(t);var o=t?Wi(e):0;return t&&o<t?$n(t-o,s)+e:e}function Nv(e,t,s){return s||t==null?t=0:t&&(t=+t),zf(Le(e).replace(dt,""),t||0)}function Fv(e,t,s){return(s?Zt(e,t,s):t===r)?t=1:t=ve(t),Qa(Le(e),t)}function Dv(){var e=arguments,t=Le(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var $v=ts(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function Lv(e,t,s){return s&&typeof s!="number"&&Zt(e,t,s)&&(t=s=r),s=s===r?k:s>>>0,s?(e=Le(e),e&&(typeof t=="string"||t!=null&&!xo(t))&&(t=hr(t),!t&&Gi(e))?li(Ar(e),0,s):e.split(t,s)):[]}var jv=ts(function(e,t,s){return e+(s?" ":"")+Po(t)});function Mv(e,t,s){return e=Le(e),s=s==null?0:Ai(ve(s),0,e.length),t=hr(t),e.slice(s,s+t.length)==t}function zv(e,t,s){var o=f.templateSettings;s&&Zt(e,t,s)&&(t=r),e=Le(e),t=Gn({},t,o,bu);var u=Gn({},t.imports,o.imports,bu),p=qt(u),v=La(u,p),m,x,N=0,F=t.interpolate||zi,j="__p += '",H=Ma((t.escape||zi).source+"|"+F.source+"|"+(F===at?ha:zi).source+"|"+(t.evaluate||zi).source+"|$","g"),ee="//# sourceURL="+(Me.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Aa+"]")+`
`;e.replace(H,function(ne,xe,Ce,fr,Xt,pr){return Ce||(Ce=fr),j+=e.slice(N,pr).replace(va,df),xe&&(m=!0,j+=`' +
__e(`+xe+`) +
'`),Xt&&(x=!0,j+=`';
`+Xt+`;
__p += '`),Ce&&(j+=`' +
((__t = (`+Ce+`)) == null ? '' : __t) +
'`),N=pr+ne.length,ne}),j+=`';
`;var se=Me.call(t,"variable")&&t.variable;if(!se)j=`with (obj) {
`+j+`
}
`;else if(ca.test(se))throw new ce(y);j=(x?j.replace(Dr,""):j).replace(Wt,"$1").replace(Hr,"$1;"),j="function("+(se||"obj")+`) {
`+(se?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(m?", __e = _.escape":"")+(x?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+j+`return __p
}`;var me=ph(function(){return De(p,ee+"return "+j).apply(r,v)});if(me.source=j,Eo(me))throw me;return me}function qv(e){return Le(e).toLowerCase()}function Uv(e){return Le(e).toUpperCase()}function kv(e,t,s){if(e=Le(e),e&&(s||t===r))return Ec(e);if(!e||!(t=hr(t)))return e;var o=Ar(e),u=Ar(t),p=xc(o,u),v=Ic(o,u)+1;return li(o,p,v).join("")}function Hv(e,t,s){if(e=Le(e),e&&(s||t===r))return e.slice(0,Pc(e)+1);if(!e||!(t=hr(t)))return e;var o=Ar(e),u=Ic(o,Ar(t))+1;return li(o,0,u).join("")}function Kv(e,t,s){if(e=Le(e),e&&(s||t===r))return e.replace(dt,"");if(!e||!(t=hr(t)))return e;var o=Ar(e),u=xc(o,Ar(t));return li(o,u).join("")}function Vv(e,t){var s=te,o=Ee;if(ot(t)){var u="separator"in t?t.separator:u;s="length"in t?ve(t.length):s,o="omission"in t?hr(t.omission):o}e=Le(e);var p=e.length;if(Gi(e)){var v=Ar(e);p=v.length}if(s>=p)return e;var m=s-Wi(o);if(m<1)return o;var x=v?li(v,0,m).join(""):e.slice(0,m);if(u===r)return x+o;if(v&&(m+=x.length-m),xo(u)){if(e.slice(m).search(u)){var N,F=x;for(u.global||(u=Ma(u.source,Le(dr.exec(u))+"g")),u.lastIndex=0;N=u.exec(F);)var j=N.index;x=x.slice(0,j===r?m:j)}}else if(e.indexOf(hr(u),m)!=m){var H=x.lastIndexOf(u);H>-1&&(x=x.slice(0,H))}return x+o}function Bv(e){return e=Le(e),e&&ht.test(e)?e.replace(ri,bf):e}var Gv=ts(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),Po=du("toUpperCase");function fh(e,t,s){return e=Le(e),t=s?r:t,t===r?vf(e)?If(e):of(e):e.match(t)||[]}var ph=we(function(e,t){try{return zt(e,r,t)}catch(s){return Eo(s)?s:new ce(s)}}),Wv=Yr(function(e,t){return vr(t,function(s){s=zr(s),Wr(e,s,wo(e[s],e))}),e});function Jv(e){var t=e==null?0:e.length,s=re();return e=t?it(e,function(o){if(typeof o[1]!="function")throw new yr(g);return[s(o[0]),o[1]]}):[],we(function(o){for(var u=-1;++u<t;){var p=e[u];if(zt(p[0],this,o))return zt(p[1],this,o)}})}function Yv(e){return bp(_r(e,G))}function Co(e){return function(){return e}}function Zv(e,t){return e==null||e!==e?t:e}var Xv=vu(),Qv=vu(!0);function ar(e){return e}function Ao(e){return Bc(typeof e=="function"?e:_r(e,G))}function ey(e){return Wc(_r(e,G))}function ty(e,t){return Jc(e,_r(t,G))}var ry=we(function(e,t){return function(s){return xs(s,e,t)}}),iy=we(function(e,t){return function(s){return xs(e,s,t)}});function Oo(e,t,s){var o=qt(t),u=An(t,o);s==null&&!(ot(t)&&(u.length||!o.length))&&(s=t,t=e,e=this,u=An(t,qt(t)));var p=!(ot(s)&&"chain"in s)||!!s.chain,v=Xr(e);return vr(u,function(m){var x=t[m];e[m]=x,v&&(e.prototype[m]=function(){var N=this.__chain__;if(p||N){var F=e(this.__wrapped__),j=F.__actions__=ir(this.__actions__);return j.push({func:x,args:arguments,thisArg:e}),F.__chain__=N,F}return x.apply(e,ni([this.value()],arguments))})}),e}function sy(){return Pe._===this&&(Pe._=Tf),this}function To(){}function ny(e){return e=ve(e),we(function(t){return Yc(t,e)})}var ay=ao(it),oy=ao(yc),cy=ao(Ra);function dh(e){return po(e)?Na(zr(e)):Mp(e)}function uy(e){return function(t){return e==null?r:Oi(e,t)}}var hy=mu(),ly=mu(!0);function Ro(){return[]}function No(){return!1}function fy(){return{}}function py(){return""}function dy(){return!0}function gy(e,t){if(e=ve(e),e<1||e>J)return[];var s=k,o=Vt(e,k);t=re(t),e-=k;for(var u=$a(o,t);++s<e;)t(s);return u}function vy(e){return fe(e)?it(e,zr):lr(e)?[e]:ir(Du(Le(e)))}function yy(e){var t=++Af;return Le(e)+t}var my=Dn(function(e,t){return e+t},0),_y=oo("ceil"),wy=Dn(function(e,t){return e/t},1),by=oo("floor");function Ey(e){return e&&e.length?Cn(e,ar,Ba):r}function xy(e,t){return e&&e.length?Cn(e,re(t,2),Ba):r}function Iy(e){return wc(e,ar)}function Sy(e,t){return wc(e,re(t,2))}function Py(e){return e&&e.length?Cn(e,ar,Ya):r}function Cy(e,t){return e&&e.length?Cn(e,re(t,2),Ya):r}var Ay=Dn(function(e,t){return e*t},1),Oy=oo("round"),Ty=Dn(function(e,t){return e-t},0);function Ry(e){return e&&e.length?Da(e,ar):0}function Ny(e,t){return e&&e.length?Da(e,re(t,2)):0}return f.after=e0,f.ary=Vu,f.assign=U0,f.assignIn=nh,f.assignInWith=Gn,f.assignWith=k0,f.at=H0,f.before=Bu,f.bind=wo,f.bindAll=Wv,f.bindKey=Gu,f.castArray=f0,f.chain=ku,f.chunk=bd,f.compact=Ed,f.concat=xd,f.cond=Jv,f.conforms=Yv,f.constant=Co,f.countBy=Rg,f.create=K0,f.curry=Wu,f.curryRight=Ju,f.debounce=Yu,f.defaults=V0,f.defaultsDeep=B0,f.defer=t0,f.delay=r0,f.difference=Id,f.differenceBy=Sd,f.differenceWith=Pd,f.drop=Cd,f.dropRight=Ad,f.dropRightWhile=Od,f.dropWhile=Td,f.fill=Rd,f.filter=Fg,f.flatMap=Lg,f.flatMapDeep=jg,f.flatMapDepth=Mg,f.flatten=Mu,f.flattenDeep=Nd,f.flattenDepth=Fd,f.flip=i0,f.flow=Xv,f.flowRight=Qv,f.fromPairs=Dd,f.functions=Q0,f.functionsIn=ev,f.groupBy=zg,f.initial=Ld,f.intersection=jd,f.intersectionBy=Md,f.intersectionWith=zd,f.invert=rv,f.invertBy=iv,f.invokeMap=Ug,f.iteratee=Ao,f.keyBy=kg,f.keys=qt,f.keysIn=nr,f.map=Un,f.mapKeys=nv,f.mapValues=av,f.matches=ey,f.matchesProperty=ty,f.memoize=Hn,f.merge=ov,f.mergeWith=ah,f.method=ry,f.methodOf=iy,f.mixin=Oo,f.negate=Kn,f.nthArg=ny,f.omit=cv,f.omitBy=uv,f.once=s0,f.orderBy=Hg,f.over=ay,f.overArgs=n0,f.overEvery=oy,f.overSome=cy,f.partial=bo,f.partialRight=Zu,f.partition=Kg,f.pick=hv,f.pickBy=oh,f.property=dh,f.propertyOf=uy,f.pull=Hd,f.pullAll=qu,f.pullAllBy=Kd,f.pullAllWith=Vd,f.pullAt=Bd,f.range=hy,f.rangeRight=ly,f.rearg=a0,f.reject=Gg,f.remove=Gd,f.rest=o0,f.reverse=mo,f.sampleSize=Jg,f.set=fv,f.setWith=pv,f.shuffle=Yg,f.slice=Wd,f.sortBy=Qg,f.sortedUniq=tg,f.sortedUniqBy=rg,f.split=Lv,f.spread=c0,f.tail=ig,f.take=sg,f.takeRight=ng,f.takeRightWhile=ag,f.takeWhile=og,f.tap=Eg,f.throttle=u0,f.thru=qn,f.toArray=rh,f.toPairs=ch,f.toPairsIn=uh,f.toPath=vy,f.toPlainObject=sh,f.transform=dv,f.unary=h0,f.union=cg,f.unionBy=ug,f.unionWith=hg,f.uniq=lg,f.uniqBy=fg,f.uniqWith=pg,f.unset=gv,f.unzip=_o,f.unzipWith=Uu,f.update=vv,f.updateWith=yv,f.values=ss,f.valuesIn=mv,f.without=dg,f.words=fh,f.wrap=l0,f.xor=gg,f.xorBy=vg,f.xorWith=yg,f.zip=mg,f.zipObject=_g,f.zipObjectDeep=wg,f.zipWith=bg,f.entries=ch,f.entriesIn=uh,f.extend=nh,f.extendWith=Gn,Oo(f,f),f.add=my,f.attempt=ph,f.camelCase=Ev,f.capitalize=hh,f.ceil=_y,f.clamp=_v,f.clone=p0,f.cloneDeep=g0,f.cloneDeepWith=v0,f.cloneWith=d0,f.conformsTo=y0,f.deburr=lh,f.defaultTo=Zv,f.divide=wy,f.endsWith=xv,f.eq=Tr,f.escape=Iv,f.escapeRegExp=Sv,f.every=Ng,f.find=Dg,f.findIndex=Lu,f.findKey=G0,f.findLast=$g,f.findLastIndex=ju,f.findLastKey=W0,f.floor=by,f.forEach=Hu,f.forEachRight=Ku,f.forIn=J0,f.forInRight=Y0,f.forOwn=Z0,f.forOwnRight=X0,f.get=Io,f.gt=m0,f.gte=_0,f.has=tv,f.hasIn=So,f.head=zu,f.identity=ar,f.includes=qg,f.indexOf=$d,f.inRange=wv,f.invoke=sv,f.isArguments=Ni,f.isArray=fe,f.isArrayBuffer=w0,f.isArrayLike=sr,f.isArrayLikeObject=bt,f.isBoolean=b0,f.isBuffer=fi,f.isDate=E0,f.isElement=x0,f.isEmpty=I0,f.isEqual=S0,f.isEqualWith=P0,f.isError=Eo,f.isFinite=C0,f.isFunction=Xr,f.isInteger=Xu,f.isLength=Vn,f.isMap=Qu,f.isMatch=A0,f.isMatchWith=O0,f.isNaN=T0,f.isNative=R0,f.isNil=F0,f.isNull=N0,f.isNumber=eh,f.isObject=ot,f.isObjectLike=vt,f.isPlainObject=Os,f.isRegExp=xo,f.isSafeInteger=D0,f.isSet=th,f.isString=Bn,f.isSymbol=lr,f.isTypedArray=is,f.isUndefined=$0,f.isWeakMap=L0,f.isWeakSet=j0,f.join=qd,f.kebabCase=Pv,f.last=br,f.lastIndexOf=Ud,f.lowerCase=Cv,f.lowerFirst=Av,f.lt=M0,f.lte=z0,f.max=Ey,f.maxBy=xy,f.mean=Iy,f.meanBy=Sy,f.min=Py,f.minBy=Cy,f.stubArray=Ro,f.stubFalse=No,f.stubObject=fy,f.stubString=py,f.stubTrue=dy,f.multiply=Ay,f.nth=kd,f.noConflict=sy,f.noop=To,f.now=kn,f.pad=Ov,f.padEnd=Tv,f.padStart=Rv,f.parseInt=Nv,f.random=bv,f.reduce=Vg,f.reduceRight=Bg,f.repeat=Fv,f.replace=Dv,f.result=lv,f.round=Oy,f.runInContext=E,f.sample=Wg,f.size=Zg,f.snakeCase=$v,f.some=Xg,f.sortedIndex=Jd,f.sortedIndexBy=Yd,f.sortedIndexOf=Zd,f.sortedLastIndex=Xd,f.sortedLastIndexBy=Qd,f.sortedLastIndexOf=eg,f.startCase=jv,f.startsWith=Mv,f.subtract=Ty,f.sum=Ry,f.sumBy=Ny,f.template=zv,f.times=gy,f.toFinite=Qr,f.toInteger=ve,f.toLength=ih,f.toLower=qv,f.toNumber=Er,f.toSafeInteger=q0,f.toString=Le,f.toUpper=Uv,f.trim=kv,f.trimEnd=Hv,f.trimStart=Kv,f.truncate=Vv,f.unescape=Bv,f.uniqueId=yy,f.upperCase=Gv,f.upperFirst=Po,f.each=Hu,f.eachRight=Ku,f.first=zu,Oo(f,function(){var e={};return jr(f,function(t,s){Me.call(f.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),f.VERSION=n,vr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),vr(["drop","take"],function(e,t){Se.prototype[e]=function(s){s=s===r?1:jt(ve(s),0);var o=this.__filtered__&&!t?new Se(this):this.clone();return o.__filtered__?o.__takeCount__=Vt(s,o.__takeCount__):o.__views__.push({size:Vt(s,k),type:e+(o.__dir__<0?"Right":"")}),o},Se.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),vr(["filter","map","takeWhile"],function(e,t){var s=t+1,o=s==C||s==ze;Se.prototype[e]=function(u){var p=this.clone();return p.__iteratees__.push({iteratee:re(u,3),type:s}),p.__filtered__=p.__filtered__||o,p}}),vr(["head","last"],function(e,t){var s="take"+(t?"Right":"");Se.prototype[e]=function(){return this[s](1).value()[0]}}),vr(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[s](1)}}),Se.prototype.compact=function(){return this.filter(ar)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=we(function(e,t){return typeof e=="function"?new Se(this):this.map(function(s){return xs(s,e,t)})}),Se.prototype.reject=function(e){return this.filter(Kn(re(e)))},Se.prototype.slice=function(e,t){e=ve(e);var s=this;return s.__filtered__&&(e>0||t<0)?new Se(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==r&&(t=ve(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(k)},jr(Se.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),o=/^(?:head|last)$/.test(t),u=f[o?"take"+(t=="last"?"Right":""):t],p=o||/^find/.test(t);u&&(f.prototype[t]=function(){var v=this.__wrapped__,m=o?[1]:arguments,x=v instanceof Se,N=m[0],F=x||fe(v),j=function(xe){var Ce=u.apply(f,ni([xe],m));return o&&H?Ce[0]:Ce};F&&s&&typeof N=="function"&&N.length!=1&&(x=F=!1);var H=this.__chain__,ee=!!this.__actions__.length,se=p&&!H,me=x&&!ee;if(!p&&F){v=me?v:new Se(this);var ne=e.apply(v,m);return ne.__actions__.push({func:qn,args:[j],thisArg:r}),new mr(ne,H)}return se&&me?e.apply(this,m):(ne=this.thru(j),se?o?ne.value()[0]:ne.value():ne)})}),vr(["pop","push","shift","sort","splice","unshift"],function(e){var t=fn[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",o=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var u=arguments;if(o&&!this.__chain__){var p=this.value();return t.apply(fe(p)?p:[],u)}return this[s](function(v){return t.apply(fe(v)?v:[],u)})}}),jr(Se.prototype,function(e,t){var s=f[t];if(s){var o=s.name+"";Me.call(Xi,o)||(Xi[o]=[]),Xi[o].push({name:t,func:s})}}),Xi[Fn(r,be).name]=[{name:"wrapper",func:r}],Se.prototype.clone=Bf,Se.prototype.reverse=Gf,Se.prototype.value=Wf,f.prototype.at=xg,f.prototype.chain=Ig,f.prototype.commit=Sg,f.prototype.next=Pg,f.prototype.plant=Ag,f.prototype.reverse=Og,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=Tg,f.prototype.first=f.prototype.head,vs&&(f.prototype[vs]=Cg),f},Ji=Sf();wt?((wt.exports=Ji)._=Ji,Be._=Ji):Pe._=Ji}).call(zs)})(Qo,Qo.exports);var cb=Object.defineProperty,ub=Object.defineProperties,hb=Object.getOwnPropertyDescriptors,cl=Object.getOwnPropertySymbols,lb=Object.prototype.hasOwnProperty,fb=Object.prototype.propertyIsEnumerable,ul=(h,i,r)=>i in h?cb(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,Jn=(h,i)=>{for(var r in i||(i={}))lb.call(i,r)&&ul(h,r,i[r]);if(cl)for(var r of cl(i))fb.call(i,r)&&ul(h,r,i[r]);return h},pb=(h,i)=>ub(h,hb(i));function Sr(h,i,r){let n;const a=ec(h);return i.rpcMap&&(n=i.rpcMap[a]),n||(n=`${ob}?chainId=eip155:${a}&projectId=${r}`),n}function ec(h){return h.includes("eip155")?Number(h.split(":")[1]):Number(h)}function Ql(h){return h.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)}function db(h,i){const r=Object.keys(i.namespaces).filter(a=>a.includes(h));if(!r.length)return[];const n=[];return r.forEach(a=>{const l=i.namespaces[a].accounts;n.push(...l)}),n}function gb(h={},i={}){const r=hl(h),n=hl(i);return Qo.exports.merge(r,n)}function hl(h){var i,r,n,a;const l={};if(!Xn(h))return l;for(const[g,y]of Object.entries(h)){const _=xl(g)?[g]:y.chains,S=y.methods||[],$=y.events||[],G=y.rpcMap||{},W=Qn(g);l[W]=pb(Jn(Jn({},l[W]),y),{chains:Do(_,(i=l[W])==null?void 0:i.chains),methods:Do(S,(r=l[W])==null?void 0:r.methods),events:Do($,(n=l[W])==null?void 0:n.events),rpcMap:Jn(Jn({},G),(a=l[W])==null?void 0:a.rpcMap)})}return l}function vb(h){return h.includes(":")?h.split(":")[2]:h}function yb(h){const i={};for(const[r,n]of Object.entries(h)){const a=n.methods||[],l=n.events||[],g=n.accounts||[],y=xl(r)?[r]:n.chains?n.chains:Ql(n.accounts);i[r]={chains:y,methods:a,events:l,accounts:g}}return i}const ef={},xt=h=>ef[h],Bo=(h,i)=>{ef[h]=i};class mb{constructor(i){this.name="polkadot",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const n=r||Sr(`${this.name}:${i}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Sr(i,this.namespace);return typeof n>"u"?void 0:new yi(new ji(n,xt("disableProviderPing")))}}class _b{constructor(i){this.name="eip155",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(i){switch(i.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(i);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(i.request.method)?await this.client.request(i):this.getHttpProvider().request(i.request)}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}setDefaultChain(i,r){const n=ec(i);if(!this.httpProviders[n]){const a=r||Sr(`${this.name}:${n}`,this.namespace,this.client.core.projectId);if(!a)throw new Error(`No RPC url provided for chainId: ${n}`);this.setHttpProvider(n,a)}this.chainId=n,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}createHttpProvider(i,r){const n=r||Sr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new yi(new ji(n,xt("disableProviderPing")))}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;const a=ec(r);i[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const i=this.chainId,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}async handleSwitchChain(i){var r,n;let a=i.request.params?(r=i.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const l=parseInt(a,16);if(this.isChainApproved(l))this.setDefaultChain(`${l}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:i.topic,request:{method:i.request.method,params:[{chainId:a}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${l}`);else throw new Error(`Failed to switch to chain 'eip155:${l}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(i){return this.namespace.chains.includes(`${this.name}:${i}`)}}class wb{constructor(i){this.name="solana",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const n=r||Sr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Sr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new yi(new ji(n,xt("disableProviderPing")))}}class bb{constructor(i){this.name="cosmos",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const n=r||Sr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Sr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new yi(new ji(n,xt("disableProviderPing")))}}class Eb{constructor(i){this.name="cip34",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const n=r||this.getCardanoRPCUrl(i);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{const n=this.getCardanoRPCUrl(r);i[r]=this.createHttpProvider(r,n)}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}getCardanoRPCUrl(i){const r=this.namespace.rpcMap;if(r)return r[i]}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||this.getCardanoRPCUrl(i);return typeof n>"u"?void 0:new yi(new ji(n,xt("disableProviderPing")))}}class xb{constructor(i){this.name="elrond",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const n=r||Sr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Sr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new yi(new ji(n,xt("disableProviderPing")))}}class Ib{constructor(i){this.name="multiversx",this.namespace=i.namespace,this.events=xt("events"),this.client=xt("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(!this.httpProviders[i]){const n=r||Sr(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,n)}this.chainId=i,this.events.emit(mi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var n;i[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const n=this.createHttpProvider(i,r);n&&(this.httpProviders[i]=n)}createHttpProvider(i,r){const n=r||Sr(i,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new yi(new ji(n,xt("disableProviderPing")))}}var Sb=Object.defineProperty,Pb=Object.defineProperties,Cb=Object.getOwnPropertyDescriptors,ll=Object.getOwnPropertySymbols,Ab=Object.prototype.hasOwnProperty,Ob=Object.prototype.propertyIsEnumerable,fl=(h,i,r)=>i in h?Sb(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,Yn=(h,i)=>{for(var r in i||(i={}))Ab.call(i,r)&&fl(h,r,i[r]);if(ll)for(var r of ll(i))Ob.call(i,r)&&fl(h,r,i[r]);return h},Go=(h,i)=>Pb(h,Cb(i));class gc{constructor(i){this.events=new uc,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=i,this.logger=typeof(i==null?void 0:i.logger)<"u"&&typeof(i==null?void 0:i.logger)!="string"?i.logger:Ae.pino(Ae.getDefaultLoggerOptions({level:(i==null?void 0:i.logger)||al})),this.disableProviderPing=(i==null?void 0:i.disableProviderPing)||!1}static async init(i){const r=new gc(i);return await r.initialize(),r}async request(i,r){const[n,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:Yn({},i),chainId:`${n}:${a}`,topic:this.session.topic})}sendAsync(i,r,n){this.request(i,n).then(a=>r(null,a)).catch(a=>r(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var i;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(i=this.session)==null?void 0:i.topic,reason:er("USER_DISCONNECTED")}),await this.cleanup()}async connect(i){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(i),await this.cleanupPendingPairings(),!i.skipPairing)return await this.pair(i.pairingTopic)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}removeListener(i,r){this.events.removeListener(i,r)}off(i,r){this.events.off(i,r)}get isWalletConnect(){return!0}async pair(i){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:a}=await this.client.connect({pairingTopic:i,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await a().then(l=>{this.session=l,this.namespaces||(this.namespaces=yb(l.namespaces),this.persist("namespaces",this.namespaces))}).catch(l=>{if(l.message!==Zl)throw l;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(i,r){try{if(!this.session)return;const[n,a]=this.validateChain(i);this.getProvider(n).setDefaultChain(a,r)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(i={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(us(r)){for(const n of r)i.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const i=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[i]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ib.init({logger:this.providerOpts.logger||al,relayUrl:this.providerOpts.relayUrl||sb,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const i=[...new Set(Object.keys(this.session.namespaces).map(r=>Qn(r)))];Bo("client",this.client),Bo("events",this.events),Bo("disableProviderPing",this.disableProviderPing),i.forEach(r=>{if(!this.session)return;const n=db(r,this.session),a=Ql(n),l=gb(this.namespaces,this.optionalNamespaces),g=Go(Yn({},l[r]),{accounts:n,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new _b({namespace:g});break;case"solana":this.rpcProviders[r]=new wb({namespace:g});break;case"cosmos":this.rpcProviders[r]=new bb({namespace:g});break;case"polkadot":this.rpcProviders[r]=new mb({namespace:g});break;case"cip34":this.rpcProviders[r]=new Eb({namespace:g});break;case"elrond":this.rpcProviders[r]=new xb({namespace:g});break;case"multiversx":this.rpcProviders[r]=new Ib({namespace:g});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",i=>{this.events.emit("session_ping",i)}),this.client.on("session_event",i=>{const{params:r}=i,{event:n}=r;if(n.name==="accountsChanged"){const a=n.data;a&&us(a)&&this.events.emit("accountsChanged",a.map(vb))}else n.name==="chainChanged"?this.onChainChanged(r.chainId):this.events.emit(n.name,n.data);this.events.emit("session_event",i)}),this.client.on("session_update",({topic:i,params:r})=>{var n;const{namespaces:a}=r,l=(n=this.client)==null?void 0:n.session.get(i);this.session=Go(Yn({},l),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:i,params:r})}),this.client.on("session_delete",async i=>{await this.cleanup(),this.events.emit("session_delete",i),this.events.emit("disconnect",Go(Yn({},er("USER_DISCONNECTED")),{data:i.topic}))}),this.on(mi.DEFAULT_CHAIN_CHANGED,i=>{this.onChainChanged(i,!0)})}getProvider(i){if(!this.rpcProviders[i])throw new Error(`Provider not found: ${i}`);return this.rpcProviders[i]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(i=>{var r;this.getProvider(i).updateNamespace((r=this.session)==null?void 0:r.namespaces[i])})}setNamespaces(i){const{namespaces:r,optionalNamespaces:n,sessionProperties:a}=i;r&&Object.keys(r).length&&(this.namespaces=r),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",n)}validateChain(i){const[r,n]=(i==null?void 0:i.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,n];if(r&&!Object.keys(this.namespaces||{}).map(g=>Qn(g)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&n)return[r,n];const a=Qn(Object.keys(this.namespaces)[0]),l=this.rpcProviders[a].getDefaultChain();return[a,l]}async requestAccounts(){const[i]=this.validateChain();return await this.getProvider(i).requestAccounts()}onChainChanged(i,r=!1){var n;if(!this.namespaces)return;const[a,l]=this.validateChain(i);r||this.getProvider(a).setDefaultChain(l),((n=this.namespaces[a])!=null?n:this.namespaces[`${a}:${l}`]).defaultChain=l,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",l)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(i,r){this.client.core.storage.setItem(`${ol}/${i}`,r)}async getFromStore(i){return await this.client.core.storage.getItem(`${ol}/${i}`)}}const Tb=gc,Rb="wc",Nb="ethereum_provider",Fb=`${Rb}@2:${Nb}:`,Db="https://rpc.walletconnect.com/v1/",tc=["eth_sendTransaction","personal_sign"],$b=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],rc=["chainChanged","accountsChanged"],Lb=["message","disconnect","connect"];var jb=Object.defineProperty,Mb=Object.defineProperties,zb=Object.getOwnPropertyDescriptors,pl=Object.getOwnPropertySymbols,qb=Object.prototype.hasOwnProperty,Ub=Object.prototype.propertyIsEnumerable,dl=(h,i,r)=>i in h?jb(h,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[i]=r,qs=(h,i)=>{for(var r in i||(i={}))qb.call(i,r)&&dl(h,r,i[r]);if(pl)for(var r of pl(i))Ub.call(i,r)&&dl(h,r,i[r]);return h},gl=(h,i)=>Mb(h,zb(i));function ia(h){return Number(h[0].split(":")[1])}function Wo(h){return`0x${h.toString(16)}`}function kb(h){const{chains:i,optionalChains:r,methods:n,optionalMethods:a,events:l,optionalEvents:g,rpcMap:y}=h;if(!us(i))throw new Error("Invalid chains");const _={chains:i,methods:n||tc,events:l||rc,rpcMap:qs({},i.length?{[ia(i)]:y[ia(i)]}:{})},S=l==null?void 0:l.filter(V=>!rc.includes(V)),$=n==null?void 0:n.filter(V=>!tc.includes(V));if(!r&&!g&&!a&&!(S!=null&&S.length)&&!($!=null&&$.length))return{required:i.length?_:void 0};const G=(S==null?void 0:S.length)&&($==null?void 0:$.length)||!r,W={chains:[...new Set(G?_.chains.concat(r||[]):r)],methods:[...new Set(_.methods.concat(a!=null&&a.length?a:$b))],events:[...new Set(_.events.concat(g||Lb))],rpcMap:y};return{required:i.length?_:void 0,optional:r.length?W:void 0}}class vc{constructor(){this.events=new kr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=Fb,this.on=(i,r)=>(this.events.on(i,r),this),this.once=(i,r)=>(this.events.once(i,r),this),this.removeListener=(i,r)=>(this.events.removeListener(i,r),this),this.off=(i,r)=>(this.events.off(i,r),this),this.parseAccount=i=>this.isCompatibleChainId(i)?this.parseAccountId(i).address:i,this.signer={},this.rpc={}}static async init(i){const r=new vc;return await r.initialize(i),r}async request(i){return await this.signer.request(i,this.formatChainId(this.chainId))}sendAsync(i,r){this.signer.sendAsync(i,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(i){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(i);const{required:r,optional:n}=kb(this.rpc);try{const a=await new Promise(async(g,y)=>{var _;this.rpc.showQrModal&&((_=this.modal)==null||_.subscribeModal(S=>{!S.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(gl(qs({namespaces:qs({},r&&{[this.namespace]:r})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:i==null?void 0:i.pairingTopic})).then(S=>{g(S)}).catch(S=>{y(new Error(S.message))})});if(!a)return;this.setChainIds(this.rpc.chains);const l=m1(a.namespaces,[this.namespace]);this.setAccounts(l),this.events.emit("connect",{chainId:Wo(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",i=>{const{params:r}=i,{event:n}=r;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",i)}),this.signer.on("chainChanged",i=>{const r=parseInt(i);this.chainId=r,this.events.emit("chainChanged",Wo(this.chainId)),this.persist()}),this.signer.on("session_update",i=>{this.events.emit("session_update",i)}),this.signer.on("session_delete",i=>{this.reset(),this.events.emit("session_delete",i),this.events.emit("disconnect",gl(qs({},er("USER_DISCONNECTED")),{data:i.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",i=>{var r,n;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(n=this.modal)==null||n.openModal({uri:i})),this.events.emit("display_uri",i)})}switchEthereumChain(i){this.request({method:"wallet_switchEthereumChain",params:[{chainId:i.toString(16)}]})}isCompatibleChainId(i){return typeof i=="string"?i.startsWith(`${this.namespace}:`):!1}formatChainId(i){return`${this.namespace}:${i}`}parseChainId(i){return Number(i.split(":")[1])}setChainIds(i){const r=i.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Wo(this.chainId)),this.persist())}setChainId(i){if(this.isCompatibleChainId(i)){const r=this.parseChainId(i);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(i){const[r,n,a]=i.split(":");return{chainId:`${r}:${n}`,address:a}}setAccounts(i){this.accounts=i.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(i){var r,n;const a=(r=i==null?void 0:i.chains)!=null?r:[],l=(n=i==null?void 0:i.optionalChains)!=null?n:[],g=a.concat(l);if(!g.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=a.length?(i==null?void 0:i.methods)||tc:[],_=a.length?(i==null?void 0:i.events)||rc:[],S=(i==null?void 0:i.optionalMethods)||[],$=(i==null?void 0:i.optionalEvents)||[],G=(i==null?void 0:i.rpcMap)||this.buildRpcMap(g,i.projectId),W=(i==null?void 0:i.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(V=>this.formatChainId(V)),optionalChains:l.map(V=>this.formatChainId(V)),methods:y,events:_,optionalMethods:S,optionalEvents:$,rpcMap:G,showQrModal:!!(i!=null&&i.showQrModal),qrModalOptions:W,projectId:i.projectId,metadata:i.metadata}}buildRpcMap(i,r){const n={};return i.forEach(a=>{n[a]=this.getRpcUrl(a,r)}),n}async initialize(i){if(this.rpc=this.getRpcConfig(i),this.chainId=this.rpc.chains.length?ia(this.rpc.chains):ia(this.rpc.optionalChains),this.signer=await Tb.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:i.disableProviderPing,relayUrl:i.relayUrl,storageOptions:i.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:n}=await _1(()=>import("./index-130460e2.js").then(a=>a.a),["assets/index-130460e2.js","assets/index-ccf0d2f7.js","assets/index-95faee4b.css"]);r=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(qs({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(i){if(!i)return;const{chains:r,optionalChains:n,rpcMap:a}=i;r&&us(r)&&(this.rpc.chains=r.map(l=>this.formatChainId(l)),r.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)})),n&&us(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(l=>this.formatChainId(l)),n.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)}))}getRpcUrl(i,r){var n;return((n=this.rpc.rpcMap)==null?void 0:n[i])||`${Db}?chainId=eip155:${i}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const i=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${i}`]?this.session.namespaces[`${this.namespace}:${i}`]:this.session.namespaces[this.namespace];this.setChainIds(i?[this.formatChainId(i)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(i){return typeof i=="string"||i instanceof String?[this.parseAccount(i)]:i.map(r=>this.parseAccount(r))}}const Xb=vc;export{Xb as EthereumProvider,Lb as OPTIONAL_EVENTS,$b as OPTIONAL_METHODS,rc as REQUIRED_EVENTS,tc as REQUIRED_METHODS,vc as default};
